!function(e){e.NodePointer=function(e,t,r){return{ParentNodeID:e,NodeID:t,ChildNodeID:r}},e.EndNode=function(e){var t=new Chance(0);return{ID:t.guid(),Name:"Survey End",SurveyStatus:e,Message:{ID:t.guid(),Messages:{}},RedirectToURL:!1,RedirectURL:"",AppendPanelParameters:!1}},e.TraversalNode=function(e,t){var r={};if(e&&Array.isArray(t)){if(0===t.length)return r;var n=t.map(function(e){var t=[];for(var r in e.Variables)t.push(e.Variables[r].Name);var n={};return n[e.ID]=t,n});r[e]=n}return r},e.PageBreak=function(){return{SurveyObjectType:6,SurveyObjectID:"4214165b-3eeb-423d-9011-"+(new Date).getMilliseconds(),SurveyObjectSubType:0,SurveyObjectName:"Page Break",Children:[],MetadataProperties:{},Tags:[],IconFlag:0,DisplayText:{}}},e.QuestionGroup=function(e){return{AnalysisText:null,GroupMaskingScriptID:null,ID:e,IsMasking:!1,Properties:{NumberOfItems:"1",ShowAs:"1"},Text:{},VariableSequence:[]}},e.QuestionAttribute=function(e){return{AnalysisText:{},AttributeMaskingScriptID:"",GroupSequence:[],ID:e,IsMasking:!1,Media:{},Sequencer:{ID:"",SequenceType:1,PickCount:0,MetadataProperties:{}},Text:{},Text2:{}}},e.QuestionVariable=function(e){return{OptionGroups:{},Options:{},VariableLevelSequence:[],ID:new Chance(0).guid(),Name:"v19",VariableType:e,ExportTag:"",Category:"",ShowInSurvey:!0,IsExclusive:!1,IsFixed:!1,IsMasking:!1,Properties:{ShowAs:"1",NumberOfItems:"3",Orientation:"Horizontal",OptionRowColCount:"2",IncrementScaleBy:"1"},ValidateOptions:!0,OptionMaskingScriptID:"",VariableMaskingScriptID:"",Text:{},AnalysisText:{},Media:{},Text2:{},Sequencer:{ID:"",SequenceType:1,PickCount:0,MetadataProperties:{}}}}}(window),function(e){"use strict";e.module("SurveyEngineCore").directive("eProgressBar",["$timeout",function(e){return{restrict:"E",scope:{showProgress:"=",callbacks:"=",progressType:"@"},transclude:!0,link:function(e,t,r){e.progressText="",e.progress=0,e.progressStyle={width:"0%"},e.updateCallbacks=e.callbacks||{},e.updateCallbacks.updateProgress=function(t){e.progress=t,e.progressStyle.width=t+"%"},e.updateCallbacks.updateText=function(t){e.progressText=t}},template:"<div ><div class='ques-count' ng-show='progressType == \"text\"'>{{progressText}}</div><div class='ques-count' ng-show='progressType == \"percentage\"'>{{progressStyle.width}}</div><div class='progress ques-bar' ng-show='progress'>   <div class='progress-bar ques-progress' ng-style='progressStyle'>   </div></div></div><div class='loading loader-pos' ng-show='showProgress'></div>"}}])}(angular),function(e){"use strict";e.module("SurveyEngineCore").directive("autoProgessBar",["$timeout",function(e){return{restrict:"E",scope:{max:"=",completed:"=",text:"="},link:function(e,t,r){e.getProgress=function(){return{width:100*e.completed/e.max+"%"}}},template:"   <div class='progress-bar' title='Auto Generate Progress : {{getProgress() | number:0 }}' style='width: {{completed*100/max}}%; height: 25px;'>   </div>   <div style='width: 100%; text-align: center; margin-top: 25px;'>       <span class='progress-text'>{{text}}</span>   </div>"}}])}(angular),function(angular){"use strict";function respondentService($q,Enums,CommunicationService,SurveyTreeService,TraversalListService){function getUniqueID(){return _SESSION_ID}function getOperatingSystem(){if(CommunicationService.PLATFORM==CommunicationService.ANDROID){var e=CommunicationService.GetOS(),t=e.split("-"),r=t[0],n=t[1].split(".");return getOSCode(r,n[0],n[1])}if(CommunicationService.PLATFORM==CommunicationService.WEB)return window.jsrcb.osCode}function Answer(){var e=Array.prototype.slice.call(arguments);this.QuestionID=e[3]||"",this.VariableName=e[2]||"",this.VariableType=e[1]||"",this.Values=e[0]||[],this.VariableType==Enums.VariableType.SingleChoice||this.VariableType==Enums.VariableType.MultipleChoice?this.DisplayedValues=e[0]||[]:this.DisplayedValues=[]}function codeLatLng(e,t){var r=$q.defer(),n={City:null,Region:null,Country:null};try{var a=new google.maps.Geocoder,i=new google.maps.LatLng(e,t);a.geocode({latLng:i},function(e,t){if(t==google.maps.GeocoderStatus.OK)if(e[1]){for(var a=0;a<e[0].address_components.length;a++)for(var i=0;i<e[0].address_components[a].types.length;i++){if("administrative_area_level_1"==e[0].address_components[a].types[i]){n.Region=e[0].address_components[a].long_name;break}if("administrative_area_level_2"==e[0].address_components[a].types[i]){n.City=e[0].address_components[a].long_name;break}if("country"==e[0].address_components[a].types[i]){n.Country=e[0].address_components[a].long_name;break}}r.resolve(n)}else console.log("No results found");else console.log("Geocoder failed due to: "+t)})}catch(e){r.reject()}return r.promise}function StopWatch(){var e,t,r=0,n=0;this.start=function(){t||(e=new Date,t=window.setInterval(function(){var t=new Date;n=t.getTime()-e.getTime()},31))},this.stop=function(){t&&(window.clearInterval(t),t=void 0,r+=n,n=0)},this.reset=function(){e=new Date,r=n=0},this.getElapsedMs=function(){return r+n},this.getElapsedTimeInSeconds=function(e){return parseInt((r+n)/1e3)+parseInt(e)}}function intersect(e,t){return e.filter(function(e){return t.hasItem(e)})}function union(e,t){for(var r=e.slice(),n=0;n<t.length;n++)r.hasItem(t[n])||r.push(t[n]);return r}function difference(e,t){return e.filter(function(e){return!t.hasItem(e)})}function unique(e){for(var t={},r=[],n=0,a=e.length;n<a;++n)t.hasOwnProperty(e[n])||(r.push(e[n]),t[e[n]]=1);return r}function pickXRandom(e,t,r){var n=new Chance(e),a=n.shuffle(t);return"number"==typeof r&&r<a.length&&(a.length=r),a}function getOSCode(e,t,r){var n=46,a={windows:{10:1,8.1:2,8:3,7:4,Vista:5,"Server 2003":6,XP:7,2000:8,ME:9,98:10,95:11,"NT 4.0":12,CE:13,3.11:14},android:{2.3:15,"3.0":16,3.1:16,3.2:16,"4.0":17,"4.1 ":18,4.2:18,4.3:18,4.4:19,"5.0":20,5.1:20,5.2:20,"6.0":21,"7.0":22,7.1:22},"mac os x":{10.6:31,10.7:32,10.8:33,10.9:34,"10.10":35,10.11:36,10.12:37},ios:{"3.0":23,"4.0":24,"5.0":25,"6.0":26,"7.0":27,"8.0":28,"9.0":29,"10.0":30},macos:{},"open bsd":38,"sun os":39,linux:40,qnx:41,unix:42,beos:43,"os/2":44,"search bot":45};for(var i in a)if(i.indexOf(e.toLowerCase())>-1){if("object"!=typeof a[i]){n=a[i];break}for(var o in a[i]){if(void 0==r&&o.indexOf(t.toLowerCase())>-1){n=a[i][o];break}if(o.indexOf((t+"."+r).toLowerCase())>-1){n=a[i][o];break}}}return n}function getLangCode(e){return e="string"==typeof e?e.toLowerCase():"",{af:1,"af-za":2,sq:3,"sq-al":4,"gsw-fr":5,"am-et":6,ar:7,"ar-dz":8,"ar-bh":9,"ar-eg":10,"ar-iq":11,"ar-jo":12,"ar-kw":13,"ar-lb":14,"ar-ly":15,"ar-ma":16,"ar-om":17,"ar-qa":18,"ar-sa":19,"ar-sy":20,"ar-tn":21,"ar-ae":22,"ar-ye":23,hy:24,"hy-am":25,"as-in":26,az:27,"az-cyrl-az":28,"az-latn-az":29,"ba-ru":30,eu:31,"eu-es":32,be:33,"be-by":34,"bn-bd":35,"bn-in":36,"bs-cyrl-ba":37,"bs-latn-ba":38,"br-fr":39,bg:40,"bg-bg":41,ca:42,"ca-es":43,"zh-hk":44,"zh-mo":45,"zh-cn":46,"zh-hans":47,"zh-sg":48,"zh-tw":49,"zh-hant":50,"co-fr":51,hr:52,"hr-hr":53,"hr-ba":54,cs:55,"cs-cz":56,da:57,"da-dk":58,"prs-af":59,div:60,"div-mv":61,nl:62,"nl-be":63,"nl-nl":64,en:65,"en-au":66,"en-bz":67,"en-ca":68,"en-029":69,"en-in":70,"en-ie":71,"en-jm":72,"en-my":73,"en-nz":74,"en-ph":75,"en-sg":76,"en-za":77,"en-tt":78,"en-gb":79,"en-us":80,"en-zw":81,et:82,"et-ee":83,fo:84,"fo-fo":85,"fil-ph":86,fi:87,"fi-fi":88,fr:89,"fr-be":90,"fr-ca":91,"fr-fr":92,"fr-lu":93,"fr-mc":94,"fr-ch":95,"fy-nl":96,gl:97,"gl-es":98,ka:99,"ka-ge":100,de:101,"de-at":102,"de-de":103,"de-li":104,"de-lu":105,"de-ch":106,el:107,"el-gr":108,"kl-gl":109,gu:110,"gu-in":111,"ha-latn-ng":112,he:113,"he-il":114,hi:115,"hi-in":116,hu:117,"hu-hu":118,is:119,"is-is":120,"ig-ng":121,id:122,"id-id":123,"iu-latn-ca":124,"iu-cans-ca":125,"ga-ie":126,"xh-za":127,"zu-za":128,it:129,"it-it":130,"it-ch":131,ja:132,"ja-jp":133,kn:134,"kn-in":135,kk:136,"kk-kz":137,"km-kh":138,"qut-gt":139,"rw-rw":140,sw:141,"sw-ke":142,kok:143,"kok-in":144,ko:145,"ko-kr":146,ky:147,"ky-kg":148,"lo-la":149,lv:150,"lv-lv":151,lt:152,"lt-lt":153,"wee-de":154,"lb-lu":155,mk:156,"mk-mk":157,ms:158,"ms-bn":159,"ms-my":160,"ml-in":161,"mt-mt":162,"mi-nz":163,"arn-cl":164,mr:165,"mr-in":166,"moh-ca":167,mn:168,"mn-mn":169,"mn-mong-cn":170,"ne-np":171,no:172,"nb-no":173,"nn-no":174,"oc-fr":175,"or-in":176,"ps-af":177,fa:178,"fa-ir":179,pl:180,"pl-pl":181,pt:182,"pt-br":183,"pt-pt":184,pa:185,"pa-in":186,"quz-bo":187,"quz-ec":188,"quz-pe":189,ro:190,"ro-ro":191,"rm-ch":192,ru:193,"ru-ru":194,"smn-fi":195,"smj-no":196,"smj-se":197,"se-fi":198,"se-no":199,"se-se":200,"sms-fi":201,"sma-no":202,"sma-se":203,sa:204,"sa-in":205,sr:206,"sr-cyrl-ba":207,"sr-cyrl-sp":208,"sr-latn-ba":209,"sr-latn-sp":210,"nso-za":211,"tn-za":212,"si-lk":213,sk:214,"sk-sk":215,sl:216,"sl-si":217,es:218,"es-ar":219,"es-bo":220,"es-cl":221,"es-co":222,"es-cr":223,"es-do":224,"es-ec":225,"es-sv":226,"es-gt":227,"es-hn":228,"es-mx":229,"es-ni":230,"es-pa":231,"es-py":232,"es-pe":233,"es-pr":234,"es-es":235,"es-us":236,"es-uy":237,"es-ve":238,sv:239,"sv-fi":240,"sv-se":241,syr:242,"syr-sy":243,"tg-cyrl-tj":244,"tzm-latn-dz":245,ta:246,"ta-in":247,tt:248,"tt-ru":249,te:250,"te-in":251,th:252,"th-th":253,"bo-cn":254,tr:255,"tr-tr":256,"tk-tm":257,"ug-cn":258,uk:259,"uk-ua":260,"wen-de":261,ur:262,"ur-pk":263,uz:264,"uz-cyrl-uz":265,"uz-latn-uz":266,vi:267,"vi-vn":268,"cy-gb":269,"wo-sn":270,"sah-ru":271,"ii-cn":272,"yo-ng":273}[e]}function allowLocalStorage(){return respondent.Answers.Channel.Values[0]==Enums.Channel.AnonymousLink||respondent.Answers.Channel.Values[0]==Enums.Channel.AnonymousEmailCampaignLink||respondent.Answers.Channel.Values[0]==Enums.Channel.AnonymousSMSCampaignLink||respondent.Answers.Channel.Values[0]==Enums.Channel.FacebookLink||respondent.Answers.Channel.Values[0]==Enums.Channel.TwitterLink||respondent.Answers.Channel.Values[0]==Enums.Channel.LinkedinLink||respondent.Answers.Channel.Values[0]==Enums.Channel.GooglePlusLink||respondent.Answers.Channel.Values[0]==Enums.Channel.PanelLink}function isInvalidVariableName(e){return void 0==e||null==e||""==e}var vm=this,respondent={},preResp={},_PossibleLoopIterations=[],_QueryAnswers=null,_PanelAnswers,_PanelMap,_SESSION_ID,_SurveyMode=Enums.SurveyMode.New,_GUID={ID:"52566c16-87d2-46ec-9d5a-4723879f8299",UniqueID:"26981f44-7337-4e26-9e54-5a55df288103",SubscriptionID:"07d0b94e-0ba6-41a1-92a8-fbe07f7ddd3f",ProjectGUID:"a61e4ce9-1aef-45f1-985a-bc8db8fc7505",CampaignID:"9101ff59-3258-4840-97f1-f49d605f03db",DistributionListID:"57bc041b-ce14-40b6-a149-6515a9355f1e",SampleID:"1f0fb4f1-df27-4670-8c74-2fc707c32338",Mode:"5f776e5e-8fba-47fa-b637-2e3ce3af0cdf",Clang:"de6bbb5e-d95d-4934-a22c-56fe904eef10",Channel:"32207bd9-f663-4f29-afbf-8351bd21de28",IsTest:"e8e5fbc2-f1be-4cb6-a7ec-faf069bb1e0d",CreatedOn:"99f8a570-dad0-4cbd-8688-358fce28fc98",CreatedBy:"1b8c6739-ea7b-45d8-b106-fb093a8ffe24",ModifiedOn:"589cf806-4b1f-48dd-b795-76f8ef1c54a8",ModifiedBy:"3c4bee96-19f7-4262-b134-f9b572ca8b60",SynchronizedOn:"f8bd5474-5b12-4744-9409-1952d06bca17",SynchronizedBy:"5fd190b1-928f-4cae-817f-d2cb6f825ccf",IsClosed:"c369d90a-5acf-42c3-b541-4a41422bb484",SurveyStatus:"04a55893-4529-41f2-8963-bed49ca341de",BackCheckStatus:"8d543353-a64e-4717-a8b8-345990ef253f",IsPublished:"c62783c0-b3c3-4f6c-ab1d-b545169ef022",InterviewStartTime:"3ec61dd7-e123-4c0f-a5d8-1f1b2b72474f",InterviewEndTime:"6c6af18e-5b6f-4b86-ac39-1f41dc735c2d",InterviewDuration:"6b588a21-69f9-4fb3-8d35-85aa271bf581",Latitude:"042419af-971b-4be5-88a4-5015b4ee2ce0",Longitude:"4e0e97a5-4046-435c-8a62-9741628b29e4",QuestionnaireVersion:"1ceecf13-317e-4db4-846f-381c502ccfbb",IPAddress:"60827025-0ed0-4794-9c66-8e829fdaa925",OperatingSystem:"b09c34d3-70a4-4d45-8d46-00a647a46fb5",ScreenSize:"043758dc-6b46-4896-a34f-1daeed33a57c",Browser:"7f562222-edd1-4028-90df-6d2fcf286c88",APKVersion:"2dbf43c9-0ba7-4771-be9e-3946a78e2de8",SurveyEngineVersion:"d4dc393f-96ca-4b7d-92d6-1cfcb88107ab",DeviceModel:"f480d090-61d6-4edd-b058-5c1d92241e37",DeviceUUID:"469744c3-e802-4f8e-821f-1570f65de00a",Country:"db3710d8-772d-4d73-8875-75bc310713cc",Region:"693fda89-35fa-46b7-8fdc-f8e4e8b1e6ad",City:"fcf54a26-2c76-4142-b912-23c68262e06f",Seed:"06f4e08a-f396-971a-3f9c-f1d72cdaf814"},currentIteration=null,respondentLocation=null,isOnReviewAtEndPage=!1,listeners=[],questionStopWatch=null,animationType="fadeInUpBig";CommunicationService.PLATFORM===CommunicationService.WEB?vm.Channel=Enums.Channel.AnonymousLink:CommunicationService.PLATFORM===CommunicationService.ANDROID&&(vm.Channel=Enums.Channel.OfflineAnonymous),vm.SystemVariables=_GUID,vm.StopWatch=new StopWatch,vm.StopWatchStart=function(){questionStopWatch=new StopWatch,questionStopWatch.start()},vm.GetElapsedTime=function(){return null!=questionStopWatch?(questionStopWatch.stop(),questionStopWatch.getElapsedMs(0)):-1},vm.IsTest=Enums.SurveyType.Live,vm.IsRespondentStoredLocally=function(e){return CommunicationService.PLATFORM===CommunicationService.WEB&&null!=localStorage.getItem("Respondent_"+e)&&(respondent=JSON.parse(localStorage.getItem("Respondent_"+e)),_SESSION_ID=respondent.Answers.UniqueID.Values[0],!0)},vm.InitRespondent=function(){var e=(new Chance).guid(),t=Array.prototype.slice.call(arguments);if(respondent={FlowList:[],Answers:{UniqueID:new Answer([e],Enums.VariableType.Text,"UniqueID",_GUID.UniqueID),SubscriptionID:new Answer([t[0].SubscriptionID],Enums.VariableType.Numeric,"SubscriptionID",_GUID.SubscriptionID),ProjectGUID:new Answer([t[0].ProjectGUID],Enums.VariableType.Text,"ProjectGUID",_GUID.ProjectGUID),Mode:new Answer([_SurveyMode],Enums.VariableType.SingleChoice,"Mode",_GUID.Mode),SurveyStatus:new Answer([Enums.SurveyStatus.Partial],Enums.VariableType.SingleChoice,"SurveyStatus",_GUID.SurveyStatus),CLang:new Answer([getLangCode(t[1])],Enums.VariableType.SingleChoice,"CLang",_GUID.Clang),IsTest:new Answer([vm.IsTest],Enums.VariableType.SingleChoice,"IsTest",_GUID.IsTest),IsClosed:new Answer([Enums.SurveyClosed.Open],Enums.VariableType.SingleChoice,"IsClosed",_GUID.IsClosed),BackCheckStatus:new Answer([Enums.BackCheckStatus.NotDone],Enums.VariableType.SingleChoice,"BackCheckStatus",_GUID.BackCheckStatus),IsPublished:new Answer([2],Enums.VariableType.SingleChoice,"IsPublished",_GUID.IsPublished),OperatingSystem:new Answer([getOperatingSystem()],Enums.VariableType.SingleChoice,"OperatingSystem",_GUID.OperatingSystem),ScreenSize:new Answer([window.jsrcb.screen],Enums.VariableType.Text,"ScreenSize",_GUID.ScreenSize),Channel:new Answer([vm.Channel],Enums.VariableType.SingleChoice,"Channel",_GUID.Channel),QuestionnaireVersion:new Answer([t[2]],Enums.VariableType.Numeric,"QuestionnaireVersion",_GUID.QuestionnaireVersion),SynchronizedBy:new Answer(["Anonymous"],Enums.VariableType.Text,"SynchronizedBy",_GUID.SynchronizedBy),ModifiedBy:new Answer(["Anonymous"],Enums.VariableType.Text,"ModifiedBy",_GUID.ModifiedBy),CreatedBy:new Answer(["Anonymous"],Enums.VariableType.Text,"CreatedBy",_GUID.CreatedBy),Browser:new Answer([window.jsrcb.browser],Enums.VariableType.Text,"Browser",_GUID.Browser),InterviewDuration:new Answer([0],Enums.VariableType.Numeric,"InterviewDuration",_GUID.InterviewDuration)}},t[0].RespID&&(respondent.Answers.ID=new Answer([t[0].RespID],Enums.VariableType.Numeric,"ID",_GUID.ID)),_SESSION_ID&&(respondent.Answers.UniqueID=new Answer([_SESSION_ID],Enums.VariableType.Text,"UniqueID",_GUID.UniqueID)),vm.AddQueryParamToRespondent(),vm.Channel==Enums.Channel.PanelLink&&_PanelAnswers&&_PanelMap)for(var r in _PanelAnswers)if(r in _PanelMap){var n=new Answer([_PanelAnswers[r]],Enums.VariableType.Text,_PanelMap[r][0],_PanelMap[r][1]);vm.SaveAnswer(n)}},window.r=function(){var variableName=arguments[0],callback=arguments[1],callbackParams=arguments[2],sectionID=arguments[3],operator=arguments[4],operand=arguments[5],isCurrentIteration=arguments[6],ans=new Answer;if(isInvalidVariableName(variableName))return ans;if(arguments.length>=4){var iterations=[];isCurrentIteration&&null!=currentIteration?iterations.push(currentIteration):iterations=TraversalListService.getLoopIterations(sectionID);for(var result=!1,i=0;i<iterations.length;i++){var aObj=ans,vName=variableName+"."+iterations[i];if(vm.GetAnswers().hasOwnProperty(vName)?(respondent.Answers[vName].__proto__=aObj.__proto__,aObj=respondent.Answers[vName]):aObj.VariableName=vName,"object"==typeof aObj&&!aObj.IsMasked&&"function"==typeof aObj[callback]){var cbResult;if(callbackParams){var params=callbackParams.split(",").map(function(e){return e.trim()});cbResult=aObj[callback].apply(aObj,params)}else cbResult=aObj[callback]();operator&&operand&&(cbResult=eval(cbResult+" "+operator+" "+operand)),result=result||cbResult}}return result}return vm.GetAnswers().hasOwnProperty(variableName)?(respondent.Answers[variableName].__proto__=ans.__proto__,ans=respondent.Answers[variableName]):(ans.VariableName=variableName,ans.IsMasked=!0),ans.QuestionID||(ans.QuestionID=SurveyTreeService.getQuestionID(variableName)),ans},vm.load=function(e){var t=$q.defer();return setTimeout(function(){CommunicationService.PLATFORM==CommunicationService.WEB&&null==respondent&&(respondent=JSON.parse(localStorage.getItem("Respondent_"+e))),t.resolve(respondent.FlowList)},0),t.promise},vm.CreateRespondent=function(){var e,t=$q.defer();return respondent.Answers.hasOwnProperty("ID")&&(e=respondent.Answers.ID.Values[0]),CommunicationService.CreateRespondent(respondent,_SESSION_ID,e).then(function(e){var r=e.split("?"),n=r[1],a=[];n&&(a=n.split("&").filter(function(e){return!(e.toLowerCase().indexOf("sessionid")>-1)||(_SESSION_ID=e.split("=")[1],!1)})),respondentLocation=r[0]+"?"+a.join("&");var i=respondent.Answers.ProjectGUID.Values[0];CommunicationService.PLATFORM===CommunicationService.WEB&&localStorage.setItem("Link_"+i,respondentLocation.toString()),t.resolve(respondentLocation)},function(e){t.reject(e)}),t.promise},vm.GetRespondent=function(e,t,r){var n=$q.defer();return CommunicationService.GetRespondent(e,t,r,getUniqueID()).then(function(e){for(var t in respondent.Answers)e.Answers.hasOwnProperty(t)||(e.Answers[t]=respondent.Answers[t]);if(respondent=e,respondent.FlowList=e.FlowList||[],allowLocalStorage()){var r=respondent.Answers.ProjectGUID.Values[0];localStorage.setItem("Respondent_"+r,JSON.stringify(respondent))}preResp=angular.copy(respondent),n.resolve(respondent)},function(e){n.reject(e)}),n.promise},vm.SaveRespondent=function(e){var t=$q.defer();return vm.StopWatch.stop(),vm.GetSurveyMode()!=Enums.SurveyMode.Review&&(respondent.Answers.hasOwnProperty("InterviewDuration")||(respondent.Answers.InterviewDuration=new Answer([0],Enums.VariableType.Numeric,"InterviewDuration",_GUID.InterviewDuration)),respondent.Answers.InterviewDuration.Values[0]=vm.StopWatch.getElapsedTimeInSeconds(respondent.Answers.InterviewDuration.Values[0])),CommunicationService.UpdateRespondent(respondent,vm.GetRespondentID(),e,getUniqueID()).then(function(){if(vm.StopWatch.reset(),allowLocalStorage()){var e=respondent.Answers.ProjectGUID.Values[0];localStorage.setItem("Respondent_"+e,JSON.stringify(respondent))}t.resolve()},function(e){t.reject(e)}),t.promise},vm.SetRespondentEndVariables=function(e){respondent.Answers.SurveyStatus=new Answer([e],Enums.VariableType.SingleChoice,"SurveyStatus",_GUID.SurveyStatus),respondent.Answers.IsClosed=new Answer([Enums.SurveyClosed.Closed],Enums.VariableType.SingleChoice,"IsClosed",_GUID.IsClosed)},vm.SetSessionID=function(e){_SESSION_ID=e},vm.CloseRespondent=function(e){var t=$q.defer();return e&&(vm.SetRespondentEndVariables(e),vm.GetSurveyMode()!=Enums.SurveyMode.Review&&(respondent.Answers.hasOwnProperty("InterviewDuration")||(respondent.Answers.InterviewDuration=new Answer([0],Enums.VariableType.Numeric,"InterviewDuration",_GUID.InterviewDuration)),respondent.Answers.InterviewDuration.Values[0]=vm.StopWatch.getElapsedTimeInSeconds(respondent.Answers.InterviewDuration.Values[0]))),CommunicationService.UpdateRespondent(respondent,vm.GetRespondentID(),"CloseSurvey",getUniqueID()).then(function(){if(allowLocalStorage()){var e=respondent.Answers.ProjectGUID.Values[0];localStorage.setItem("Respondent_"+e,JSON.stringify(respondent))}t.resolve()},function(){t.reject()}),t.promise},vm.RollbackRespondent=function(){respondent=angular.copy(preResp)},vm.CreateSystemVariable=function(e,t,r){var n=vm.GetAnswerObject();n.QuestionID=_GUID[e],n.Values=t,n.VariableType=r,n.VariableName=e,vm.SaveAnswer(n)},vm.GetSeed=function(){return respondent.Answers.hasOwnProperty("Seed")&&Array.isArray(respondent.Answers.Seed.Values)?parseInt(respondent.Answers.Seed.Values[0]):parseInt(vm.GetRespondentID())},vm.SetSeed=function(e){e||(e=vm.GetRespondentID()),respondent.Answers.Seed=new Answer([e],Enums.VariableType.Numeric,"Seed",_GUID.Seed)},vm.SetFingerPrintID=function(){CommunicationService.PLATFORM===CommunicationService.WEB&&require(["Fingerprint2"],function(){"function"==typeof Fingerprint2&&(new Fingerprint2).get(function(e,t){respondent.Answers.DeviceUUID=new Answer([e],Enums.VariableType.Text,"DeviceUUID",_GUID.DeviceUUID)})})},vm.GetRespondentID=function(){return _SurveyMode===Enums.SurveyMode.Preview?2:parseInt(respondent.Answers.ID.Values[0])},vm.SetRespondentID=function(e){respondent.Answers.ID=new Answer([e],Enums.VariableType.Numeric,"ID",_GUID.ID)},vm.GetSurveyStatus=function(){return respondent.Answers.SurveyStatus.Values[0]},vm.SetBackCheck=function(e){respondent.Answers.BackCheckStatus=new Answer([e],Enums.VariableType.SingleChoice,"BackCheckStatus",_GUID.BackCheckStatus)},vm.SetSurveyMode=function(e){respondent.hasOwnProperty("Answers")&&(respondent.Answers.Mode.Values[0]=e),_SurveyMode=e},vm.GetSurveyMode=function(){return _SurveyMode},vm.SetSurveyLanguage=function(){respondent.Answers.CLang=new Answer([getLangCode(arguments[0])],Enums.VariableType.SingleChoice,"CLang",_GUID.Clang)},vm.GetLanguageCode=function(e){return getLangCode(e)},vm.SetLatLong=function(e,t){respondent.Answers.Latitude=new Answer([e],Enums.VariableType.Numeric,"Latitude",_GUID.Latitude),respondent.Answers.Longitude=new Answer([t],Enums.VariableType.Numeric,"Longitude",_GUID.Longitude)},vm.SetCityCountry=function(e,t){codeLatLng(e,t).then(function(e){null!=e.Country&&(respondent.Answers.Country=new Answer([e.Country],Enums.VariableType.Text,"Country",_GUID.Country)),null!=e.Region&&(respondent.Answers.Region=new Answer([e.Region],Enums.VariableType.Text,"Region",_GUID.Region)),null!=e.City&&(respondent.Answers.City=new Answer([e.City],Enums.VariableType.Text,"City",_GUID.City))})},vm.SetDisplayedValues=function(e,t,r,n){if(respondent.Answers&&""!=e&&!isOnReviewAtEndPage&&0!=n.length){if(void 0==respondent.Answers[e]){var a=vm.GetAnswerObject();a.VariableName=e,a.VariableType=t,r&&(a.QuestionID=r.split("|")[0]),vm.SaveAnswer(a)}respondent.Answers[e].Values=intersect(respondent.Answers[e].Values,n).filter(function(t){return respondent.Answers[e].Values.hasItem(t)}),respondent.Answers[e].DisplayedValues=n}},vm.GetDisplayedValues=function(e){return respondent.Answers&&respondent.Answers.hasOwnProperty(e)&&respondent.Answers[e].hasOwnProperty("DisplayedValues")?respondent.Answers[e].DisplayedValues:[]},vm.GetAnswerObject=function(){var e=Array.prototype.slice.call(arguments),t=new Answer(e[0],e[1],e[2],e[3]),r=vm.GetDisplayedValues(t.VariableName);return r.length>0&&(t.DisplayedValues=r),t},vm.AddListener=function(e){listeners.push(e)},vm.DestroyListeners=function(){listeners.map(function(e){"function"==typeof e&&e()}),listeners=[]},vm.SaveAnswer=function(e){""!=e.VariableName&&(e.IsMasked=!1,e.QuestionID&&(e.QuestionID=e.QuestionID.split("|")[0]),respondent.Answers[e.VariableName]=angular.copy(e))},vm.GetAnswers=function(){return respondent.Answers},vm.SetAnswers=function(e,t,r,n){""!=e&&(r&&(respondent.Answers[e].QuestionID=r.split("|")[0]),respondent.Answers[e].VariableType=t,respondent.Answers[e].Values=angular.copy(n),respondent.Answers[e].IsMasked=!1)},vm.GetVariableAnswers=function(e){return respondent.Answers&&respondent.Answers[e]?angular.copy(respondent.Answers[e].Values):[]},vm.GetVariableType=function(e){return respondent.Answers[e]?respondent.Answers[e].VariableType:null},vm.SetQueryAnswers=function(e){_QueryAnswers=e},vm.SetPossibleLoopIterations=function(e){_PossibleLoopIterations=e},vm.GetPossibleLoopIterations=function(e){return _PossibleLoopIterations||[]},vm.SetMaskingBit=function(e,t){""!=e&&"object"==typeof respondent.Answers[e]&&(respondent.Answers[e].IsMasked=t)},vm.SetCurrentIteration=function(e){currentIteration=e},vm.GetCurrentIteration=function(){return currentIteration},vm.SetPanelAnswers=function(e){_PanelAnswers=e},vm.SetPanelMapping=function(e){_PanelMap=e},vm.SetOnReviewAtEndPage=function(e){isOnReviewAtEndPage=e},vm.Union=union,vm.Intersect=intersect,vm.AddQueryParamToRespondent=function(){if(null!=_QueryAnswers&&Array.isArray(_QueryAnswers))for(var e=0;e<_QueryAnswers.length;e++)respondent.Answers[_QueryAnswers[e].VariableName]=_QueryAnswers[e]},vm.IsOffline=function(){return CommunicationService.PLATFORM==CommunicationService.ANDROID},vm.GetAnimation=function(){return animationType},vm.SetAnimation=function(e){animationType=e},Answer.prototype.SetValue=function(){var e=Array.prototype.slice.call(arguments),t=e[0],r=e[1],n=e.splice(2);isInvalidVariableName(this.VariableName)||(respondent.Answers.hasOwnProperty(this.VariableName)||(respondent.Answers[this.VariableName]=this),n.length>0&&Array.isArray(n[0])?(this.Values=n[0].filter(function(e){return null!=e}),this.DisplayedValues=SurveyTreeService.getOrderedOptions(this.QuestionID,this.VariableName)):(this.Values=n.filter(function(e){return null!=e}),r!=Enums.VariableType.SingleChoice&&r!=Enums.VariableType.MultipleChoice||(this.DisplayedValues=SurveyTreeService.getOrderedOptions(this.QuestionID,this.VariableName))),this.VariableType=r,this.QuestionID=t,this.IsMasked=!1)},Answer.prototype.GetValue=function(){return respondent.Answers.hasOwnProperty(this.VariableName)&&Array.isArray(this.Values)&&this.Values.length>0?this.VariableType==Enums.VariableType.MultipleChoice?this.Values.slice():this.VariableType==Enums.VariableType.Numeric?parseFloat(this.Values[0]):this.Values[0]:null},Answer.prototype.SelectedValues=function(){var e=arguments[0]||[];return respondent.Answers.hasOwnProperty(this.VariableName)&&Array.isArray(this.Values)?intersect(union(this.Values,e),this.DisplayedValues):[]},Answer.prototype.UnSelectedValues=function(){var e=arguments[0]||[];return respondent.Answers.hasOwnProperty(this.VariableName)&&Array.isArray(this.Values)&&Array.isArray(this.DisplayedValues)?Array.isArray(e)&&e.length>0?intersect(e,difference(this.DisplayedValues,this.Values)):difference(this.DisplayedValues,this.Values):[]},Answer.prototype.AllDisplayedValues=function(){return Array.isArray(this.DisplayedValues)?this.DisplayedValues.slice():[]},Answer.prototype.NotDisplayedValues=function(){if(Array.isArray(this.Values)&&Array.isArray(this.DisplayedValues)){return difference(SurveyTreeService.getAllOptions(this.QuestionID,this.VariableName),this.DisplayedValues)}return[]},Answer.prototype.AllValues=function(){return SurveyTreeService.getAllOptions(this.QuestionID,this.VariableName)||[]},Answer.prototype.ItemSelected=function(){if(this.IsMasked)return!1;var e=Array.prototype.slice.call(arguments);return intersect(this.Values,this.DisplayedValues).hasItem(e[0])},Answer.prototype.AnyItemsSelected=function(){if(this.IsMasked)return!1;var e=Array.prototype.slice.call(arguments),t=intersect(this.Values,this.DisplayedValues);return e.reduce(function(e,r){return e||t.hasItem(r)},!1)},Answer.prototype.AllItemsSelected=function(){if(this.IsMasked)return!1;var e=Array.prototype.slice.call(arguments),t=intersect(this.Values,this.DisplayedValues);return e.reduce(function(e,r){return e&&t.hasItem(r)},!0)},Answer.prototype.SelectedCount=function(){if(this.IsMasked)return 0;var e=r(this.VariableName).GetValue();return Array.isArray(e)?e.length:0},Answer.prototype.ItemDisplayed=function(){if(this.IsMasked)return!1;var e=this;return Array.prototype.slice.call(arguments).reduce(function(t,r){return t&&e.DisplayedValues.hasItem(r)},!0)},Answer.prototype.AnyItemsDisplayed=function(){if(this.IsMasked)return!1;var e=this;return Array.prototype.slice.call(arguments).reduce(function(t,r){return t||e.DisplayedValues.hasItem(r)},!1)},Answer.prototype.AllItemsDisplayed=function(){if(this.IsMasked)return!1;var e=this;return Array.prototype.slice.call(arguments).reduce(function(t,r){return t&&e.DisplayedValues.hasItem(r)},!0)},Answer.prototype.Displayed=function(){return!this.IsMasked},Answer.prototype.NotDisplayed=function(){return!this.Displayed()},Answer.prototype.Answered=function(){if(this.IsMasked)return!1;if(Array.isArray(this.Values)&&this.Values.length>0){if(this.VariableType==Enums.VariableType.SingleChoice||this.VariableType==Enums.VariableType.MultipleChoice){return intersect(this.Values,this.DisplayedValues).length>0}return!0}return!1},Answer.prototype.NotAnswered=function(){return!this.Answered()},Answer.prototype.NumberGreaterThan=function(){return!this.IsMasked&&parseFloat(this.Values[0])>parseFloat(arguments[0])},Answer.prototype.NumberGreaterThanOrEqualTo=function(){return!this.IsMasked&&parseFloat(this.Values[0])>=parseFloat(arguments[0])},Answer.prototype.NumberLessThan=function(){return!this.IsMasked&&parseFloat(this.Values[0])<parseFloat(arguments[0])},Answer.prototype.NumberLessThanOrEqualTo=function(){return!this.IsMasked&&parseFloat(this.Values[0])<=parseFloat(arguments[0])},Answer.prototype.NumberEqualTo=function(){return!this.IsMasked&&parseFloat(this.Values[0])==parseFloat(arguments[0])},Answer.prototype.DateGreaterThan=function(){return!this.IsMasked&&arguments[0]>this.Values[0]},Answer.prototype.DateGreaterThanOrEqualTo=function(){if(this.IsMasked)return!1;var e=this;return Array.prototype.slice.call(arguments).reduce(function(t,r){return t&&e.Values.indexOf(r)},!1)},Answer.prototype.DateLessThan=function(){if(this.IsMasked)return!1;var e=this;return Array.prototype.slice.call(arguments).reduce(function(t,r){return t&&e.Values.indexOf(r)},!1)},Answer.prototype.DateLessThanOrEqualTo=function(){if(this.IsMasked)return!1;var e=this;return Array.prototype.slice.call(arguments).reduce(function(t,r){return t&&e.Values.indexOf(r)},!1)},Answer.prototype.DateEqualTo=function(){if(this.IsMasked)return!1;var e=this;return Array.prototype.slice.call(arguments).reduce(function(t,r){return t&&e.Values.indexOf(r)},!1)},Answer.prototype.TextEqualTo=function(){return!this.IsMasked&&(this.Values.length>0&&arguments[0].toLowerCase()===this.Values[0].toLowerCase())},Answer.prototype.TextContains=function(){return!this.IsMasked&&(this.Values.length>0&&this.Values[0].toLowerCase().indexOf(arguments[0].toLowerCase())>-1)},Answer.prototype.TextDoesNotContain=function(){return!!this.IsMasked||this.Values.length>0&&-1===this.Values[0].toLowerCase().indexOf(arguments[0].toLowerCase())},Answer.prototype.TextMatchesRegex=function(){if(this.IsMasked)return!1;var e=arguments[0],t=new RegExp(e);return!!(this.Values.length>0&&t.test(this.Values[0]))},Answer.prototype.Jump=function(e){return e},Answer.prototype.GetSelectedCasesText=function(){if(this.VariableType==Enums.VariableType.SingleChoice||this.VariableType==Enums.VariableType.MultipleChoice){var e=[],t=[];t=SurveyTreeService.isSurveyQuestion(this.QuestionID)?intersect(this.Values,this.DisplayedValues):this.Values;for(var r=0;r<t.length;r++)e.push(SurveyTreeService.getText(this.QuestionID,this.VariableName,t[r]));if(e.indexOf(null)>-1)return;return e.join(", ")}return""},Answer.prototype.GetUnselectedCasesText=function(){if(this.VariableType==Enums.VariableType.SingleChoice||this.VariableType==Enums.VariableType.MultipleChoice){var e=[],t=[];t=SurveyTreeService.isSurveyQuestion(this.QuestionID)?intersect(this.Values,this.DisplayedValues):this.Values;for(var r=0;r<this.DisplayedValues.length;r++)-1===t.hasItem(this.DisplayedValues[r])&&e.push(SurveyTreeService.getText(this.QuestionID,this.VariableName,this.DisplayedValues[r]));if(e.indexOf(null)>-1)return;return e.join(", ")}return""},Answer.prototype.GetChoicesText=function(){
for(var e=[],t=SurveyTreeService.getAllOptions(this.QuestionID,this.VariableName),r=0;r<t.length;r++)e.push(SurveyTreeService.getText(this.QuestionID,this.VariableName,t[r]));if(!(e.indexOf(null)>-1))return e.join(", ")},Answer.prototype.GetDisplayedChoicesText=function(){if(this.VariableType==Enums.VariableType.SingleChoice||this.VariableType==Enums.VariableType.MultipleChoice){for(var e=[],t=0;t<this.DisplayedValues.length;t++)e.push(SurveyTreeService.getText(this.QuestionID,this.VariableName,this.DisplayedValues[t]));if(e.indexOf(null)>-1)return;return e.join(", ")}return""},Answer.prototype.GetNotDisplayedChoicesText=function(){if(this.VariableType==Enums.VariableType.SingleChoice||this.VariableType==Enums.VariableType.MultipleChoice){for(var e=[],t=SurveyTreeService.getAllOptions(this.QuestionID,this.VariableName),r=0;r<t.length;r++)-1===this.DisplayedValues.indexOf(t[r])&&e.push(SurveyTreeService.getText(this.QuestionID,this.VariableName,this.DisplayedValues[r]));if(e.indexOf(null)>-1)return;return e.join(", ")}return""},Answer.prototype.GetLoopText=function(){var e=arguments[0];return e?r(this.VariableName).GetOptionText(e):""},Answer.prototype.GetLoopIteration=function(){return vm.GetCurrentIteration()},Answer.prototype.GetLoopCount=function(){return Array.isArray(this.Values)?this.Values.length:0},Answer.prototype.GetQuestionText=function(){var e=arguments[0]||this.QuestionID,t=SurveyTreeService.getText(e);if(null!==t)return t;setTimeout(function(){t=SurveyTreeService.getText(e)},0)},Answer.prototype.GetOptionText=function(){var e=arguments[0],t=arguments[1]||this,n=SurveyTreeService.getOtherVariable(t.QuestionID,t.VariableName,e);if(null!==n)return r(n).GetAnswerText();var a=SurveyTreeService.getText(t.QuestionID,t.VariableName,e);if(null!==a)return a;setTimeout(function(){a=SurveyTreeService.getText(t.QuestionID,t.VariableName,e)},0)},Answer.prototype.GetOtherOptionText=function(){var e=SurveyTreeService.getOtherVariable(this.QuestionID,this.VariableName,arguments[0]);return r(e).GetAnswerText()},Answer.prototype.GetAnswerText=function(){var e=arguments[0]||this;if(!Array.isArray(this.Values)||0==this.Values.length)return"";if(this.VariableType!=Enums.VariableType.SingleChoice&&this.VariableType!=Enums.VariableType.MultipleChoice)return this.Values[0];var t=SurveyTreeService.getText(this.QuestionID,this.VariableName,this.Values[0]);if(null!==t)return t;setTimeout(function(){t=SurveyTreeService.getText(e.QuestionID,e.VariableName,e.Values[0])},0)},Answer.prototype.ClearValue=function(){this.Values=[],this.VariableType!=Enums.VariableType.SingleChoice&&this.VariableType!=Enums.VariableType.MultipleChoice||(this.DisplayedValues=[])},Answer.prototype.Intersection=function(){var e=Array.prototype.slice.call(arguments);return Array.isArray(this.Values)&&0!=e.length?e.reduce(function(e,t){return Array.isArray(t)||(t=[t]),intersect(e,t)},this.Values):[]},Answer.prototype.Union=function(){var e=Array.prototype.slice.call(arguments);return Array.isArray(this.Values)&&0!=e.length?e.reduce(function(e,t){return Array.isArray(t)||(t=[t]),union(e,t)},this.Values):[]},Answer.prototype.Difference=function(){var e=Array.prototype.slice.call(arguments);return Array.isArray(this.Values)&&0!=e.length?e.reduce(function(e,t){return Array.isArray(t)||(t=[t]),difference(e,t)},this.Values):[]},Answer.prototype.Unique=function(){return Array.isArray(this.Values)?unique(this.Values):[]},Answer.prototype.GetRandomSet=function(){return Array.isArray(this.Values)?pickXRandom(vm.GetSeed(),this.Values,arguments[0]):[]},Answer.prototype.GetLatitude=function(){return CommunicationService.GetLatitude()},Answer.prototype.GetLongitude=function(){return CommunicationService.GetLongitude()},Object.defineProperty(Array.prototype,"hasItem",{enumerable:!1,writable:!0,value:function(){for(var e=arguments[0],t=0;t<this.length;t++)if(this[t]==e)return!0;return!1}}),Object.defineProperty(Array.prototype,"getIndexOf",{enumerable:!1,writable:!0,value:function(){for(var e=arguments[0],t=0;t<this.length;t++)if(this[t]==e)return t;return-1}}),function(e){var t="";if(screen.width){t+=(screen.width?screen.width:"")+" x "+(screen.height?screen.height:"")}var r,n,a,i=navigator.appVersion,o=navigator.userAgent,s=navigator.appName,l=""+parseFloat(navigator.appVersion),u=parseInt(navigator.appVersion,10);-1!=(n=o.indexOf("Opera"))&&(s="Opera",l=o.substring(n+6),-1!=(n=o.indexOf("Version"))&&(l=o.substring(n+8))),-1!=(n=o.indexOf("OPR"))?(s="Opera",l=o.substring(n+4)):-1!=(n=o.indexOf("Edge"))?(s="Microsoft Edge",l=o.substring(n+5)):-1!=(n=o.indexOf("MSIE"))?(s="Microsoft Internet Explorer",l=o.substring(n+5)):-1!=(n=o.indexOf("Chrome"))?(s="Chrome",l=o.substring(n+7)):-1!=(n=o.indexOf("Safari"))?(s="Safari",l=o.substring(n+7),-1!=(n=o.indexOf("Version"))&&(l=o.substring(n+8))):-1!=(n=o.indexOf("Firefox"))?(s="Firefox",l=o.substring(n+8)):-1!=o.indexOf("Trident/")?(s="Microsoft Internet Explorer",l=o.substring(o.indexOf("rv:")+3)):(r=o.lastIndexOf(" ")+1)<(n=o.lastIndexOf("/"))&&(s=o.substring(r,n),l=o.substring(n+1),s.toLowerCase()==s.toUpperCase()&&(s=navigator.appName)),-1!=(a=l.indexOf(";"))&&(l=l.substring(0,a)),-1!=(a=l.indexOf(" "))&&(l=l.substring(0,a)),-1!=(a=l.indexOf(")"))&&(l=l.substring(0,a)),u=parseInt(""+l,10),isNaN(u)&&(l=""+parseFloat(navigator.appVersion),u=parseInt(navigator.appVersion,10));var c=/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(i),d="-",p=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(var b in p){var g=p[b];if(g.r.test(o)){d=g.s;break}}var v="-",f="-",m="-";if(/Windows/.test(d)){v=/Windows (.*)/.exec(d)[1];var S=v.split(".");f=S[0],m=S[1],d="Windows"}switch(d){case"Mac OS X":v=/Mac OS X (10[\.\_\d]+)/.exec(o)[1];try{v=v.replace(/\_/g,".");var S=v.split(".");f=S[0],m=S[1]}catch(e){console.log(e)}break;case"Android":v=/Android ([\.\_\d]+)/.exec(o)[1];var S=v.split(".");f=S[0],m=S[1];break;case"iOS":v=/OS (\d+)_(\d+)_?(\d+)?/.exec(i),v=v[1]+"."+v[2]+"."+(0|v[3]);var S=v.split(".");f=S[0],m=S[1]}var h=getOSCode(d,f,m);e.jsrcb={screen:t,browser:s+" "+l,os:d+" "+v,osCode:h,isMobile:c}}(window)}angular.module("SurveyEngineCore").service("SurveyEngine.RespondentService",["$q","SurveyEngine.Enums","EngineCore.CommunicationService","EngineCore.SurveyTreeService","EngineCore.TraversalListService",respondentService])}(angular),function(e){"use strict";function t(e,t,n){function a(e,t,r,n,a,i,o,s,l,u,c,d,p,b,g,v,f,m,S,h,y,O,T,w,I,A,V,C,x,q,P,D){void 0!=e&&(ct.Settings.CSSProperties.BackgroundColor=e),void 0!=t&&(ct.Settings.CSSProperties.BackgroundImage=t),void 0!=r&&(ct.Settings.CSSProperties.ButtonsColor=r),void 0!=n&&(ct.Settings.CSSProperties.ButtonsTxtColor=n),void 0!=i&&(ct.Settings.CSSProperties.OptionTextColor=i),void 0!=a&&(ct.Settings.CSSProperties.QuestionTextColor=a),void 0!=o&&(ct.Settings.CSSProperties.SectionHeaderColor=o),void 0!=sectionHeaderTextColor&&(ct.Settings.CSSProperties.SectionHeaderTextColor=sectionHeaderTextColor),void 0!=s&&(ct.Settings.CSSProperties.SectionFooterColor=s),void 0!=l&&(ct.Settings.CSSProperties.TextColor=l),void 0!=u&&(ct.Settings.CSSProperties.QuesFont=u),void 0!=c&&(ct.Settings.CSSProperties.AnsFont=c),void 0!=d&&(ct.Settings.CSSProperties.BtnFont=d),void 0!=p&&(ct.Settings.CSSProperties.QuesFontSize=p),void 0!=b&&(ct.Settings.CSSProperties.AnsFontSize=b),void 0!=g&&(ct.Settings.CSSProperties.BtnFontSize=g),void 0!=v&&(ct.Settings.CSSProperties.ProgressBarBgColor=v),void 0!=f&&(ct.Settings.CSSProperties.ProgressColor=f),void 0!=m&&(ct.Settings.CSSProperties.ProgressTextColor=m),void 0!=S&&(ct.Settings.CSSProperties.AnswerSelectionColor=S),void 0!=h&&(ct.Settings.CSSProperties.AnswerSelectionBg=h),void 0!=y&&(ct.Settings.CSSProperties.SmileyColor=y),void 0!=O&&(ct.Settings.CSSProperties.ThemeTitle=O),void 0!=T&&(ct.Settings.CSSProperties.OptionBgColor=T),void 0!=w&&(ct.Settings.CSSProperties.OptionBorderColor=w),void 0!=I&&(ct.Settings.CSSProperties.StarColor=I),void 0!=A&&(ct.Settings.CSSProperties.StarSelectionColor=A),void 0!=V&&(ct.Settings.CSSProperties.SubmitTextColor=V),void 0!=C&&(ct.Settings.CSSProperties.SubmitBgColor=C),void 0!=x&&(ct.Settings.CSSProperties.NPSBackground=x),void 0!=q&&(ct.Settings.CSSProperties.NPSBorder=q),void 0!=P&&(ct.Settings.CSSProperties.NPSText=P),void 0!=D&&(ct.Settings.CSSProperties.NPSBorderWidth=D)}function i(){e.UpdateSurveyProperties(dt).then(function(){console.log("Survey Properties Updated")},function(e){console.log("Updating Properties failed")})}function o(){return ct.Settings.CSSProperties.BackgroundColor}function s(){return ct.Settings.CSSProperties.BackgroundImage}function l(){return ct.Settings.CSSProperties.SelectionColor}function u(){return ct.Settings.CSSProperties.ChoiceColor}function c(){return ct.Settings.CSSProperties.TextColor}function d(){return ct.Settings.CSSProperties.ButtonsColor}function p(){return ct.Settings.CSSProperties.ButtonsTxtColor}function b(){return ct.Settings.CSSProperties.OptionTextColor}function g(){return ct.Settings.CSSProperties.QuestionTextColor}function v(){return ct.Settings.CSSProperties.SectionHeaderColor}function f(){return ct.Settings.CSSProperties.SectionHeaderTextColor}function m(){return ct.Settings.CSSProperties.SectionFooterColor}function S(){return ct.Settings.CSSProperties.ProgressBarBgColor}function h(){return ct.Settings.CSSProperties.ProgressColor}function y(){return ct.Settings.CSSProperties.ProgressTextColor}function O(){return ct.Settings.CSSProperties.AnswerSelectionColor}function T(){return ct.Settings.CSSProperties.AnswerSelectionBg}function w(){return ct.Settings.CSSProperties.SmileyColor}function I(){return ct.Settings.CSSProperties.ThemeTitle}function A(){return ct.Settings.CSSProperties.OptionBgColor}function V(){return ct.Settings.CSSProperties.OptionBorderColor}function C(){return ct.Settings.CSSProperties.StarColor}function x(){return ct.Settings.CSSProperties.StarSelectionColor}function q(){return ct.Settings.CSSProperties.SubmitTextColor}function P(){return ct.Settings.CSSProperties.SubmitBgColor}function D(){return ct.Settings.CSSProperties.NPSBackground}function L(){return ct.Settings.CSSProperties.NPSBorder}function j(){return ct.Settings.CSSProperties.NPSText}function k(){return ct.Settings.CSSProperties.NPSBorderWidth}function G(e){st=e}function M(){return st}function N(e){lt=e}function E(){return lt}function Q(){var e={Bar:!0,Text:!1};return ct.ProgressBarType==n.ProgressBar.None&&(e.Bar=!1),ct.ProgressBarType==n.ProgressBar.WithText&&(e.Text=!0),e}function R(){return dt.ProgressText1[ae()]||dt.ProgressText1[ie()]}function B(){return dt.ProgressText2[ae()]||dt.ProgressText2[ie()]}function H(){return(ct.QueryParameter.Channel==n.Channel.AnonymousLink||ct.QueryParameter.Channel==n.Channel.AnonymousEmailCampaignLink||ct.QueryParameter.Channel==n.Channel.AnonymousSMSCampaignLink||ct.QueryParameter.Channel==n.Channel.FacebookLink||ct.QueryParameter.Channel==n.Channel.TwitterLink||ct.QueryParameter.Channel==n.Channel.LinkedinLink||ct.QueryParameter.Channel==n.Channel.GooglePlusLink||ct.QueryParameter.Channel==n.Channel.PanelLink)&&ct.QueryParameter.Mode!=n.SurveyMode.Preview&&ct.QueryParameter.Mode!=n.SurveyMode.Review&&ct.QueryParameter.Mode!=n.SurveyMode.View&&null!=localStorage.getItem(ct.QueryParameter.ProjectGUID)&&(null==dt&&(dt=JSON.parse(localStorage.getItem(ct.QueryParameter.ProjectGUID))),!0)}function F(){return dt.PreventMultipleSurveys}function U(r){var n=t.defer();return e.PLATFORM==e.WEB?e.IsSurveyActive(r).then(function(e){n.resolve(e)},function(e){n.reject(e)}):setTimeout(function(){n.resolve()}),n.promise}function _(){return e.PLATFORM===e.WEB&&dt.PasswordProtectAnonymousSurveys}function z(){return dt.SelectLanguage}function $(){return dt.CaptureOnlineGPS&&e.PLATFORM==e.WEB}function W(t,r){dt=t;var n=parseInt(dt.ActiveQuestionnaireVersion);r?(dt.ActiveQuestionnaireVersion=dt.ActiveQuestionnaireVersion+1,e.UpdateSurveyAPI(n+1)):e.PLATFORM===e.WEB&&(localStorage.setItem(ct.QueryParameter.ProjectGUID,JSON.stringify(t)),e.UpdateSurveyAPI(n)),ct.Settings=dt.SurveySettings,ct.IsBackButtonDisable=dt.DisableBackButton,void 0!=dt.QuestionsPerPage&&(ct.QuestionPerPage=dt.QuestionsPerPage),void 0!=dt.ShowRebusCloudLogo&&(ct.ShowRebusCloudLogo=dt.ShowRebusCloudLogo),ct.LogoPath=dt.LogoPath,ct.LogoPosition=dt.LogoPosition,ct.ArrowPosition=dt.ArrowPosition,ct.RedirectURL=dt.RedirectURL,void 0!=dt.ShowQuestionNo&&(ct.ShowQuestionNumber=dt.ShowQuestionNo),void 0!=dt.ProgressBarType&&(ct.ProgressBarType=dt.ProgressBarType),document.title=K()}function X(t){dt.ActiveQuestionnaireVersion=t,e.UpdateSurveyAPI(t)}function J(e){ct.Settings=e}function K(){return dt.SurveyTitle}function Y(){return dt.ActiveQuestionnaireVersion}function Z(){if(dt.EndOfSurveyMessage){var e=ae();return"object"==typeof dt.EndOfSurveyMessage.Messages&&dt.EndOfSurveyMessage.Messages.hasOwnProperty(e)?dt.EndOfSurveyMessage.Messages[e]:dt.EndOfSurveyMessage.Messages[ie()]}return"Survey End"}function ee(){if(dt.ClosedSurveyMessage){var e=ae();return"object"==typeof dt.ClosedSurveyMessage.Messages&&dt.ClosedSurveyMessage.Messages.hasOwnProperty(e)?dt.ClosedSurveyMessage.Messages[e]:dt.ClosedSurveyMessage.Messages[ie()]}return"This survey is inactive."}function te(){if(dt.FooterOfSurveyMessage){var e=ae();return"object"==typeof dt.FooterOfSurveyMessage.Messages&&dt.FooterOfSurveyMessage.Messages.hasOwnProperty(e)?dt.FooterOfSurveyMessage.Messages[e]:dt.FooterOfSurveyMessage.Messages[ie()]}return"Please add footer text"}function re(){return dt.Languages}function ne(){var e={};for(var t in dt.Languages)"object"==typeof dt.VisibleLanguages&&dt.VisibleLanguages.hasOwnProperty(t)?dt.VisibleLanguages[t]&&(e[t]=dt.Languages[t]):e[t]=dt.Languages[t];return e}function ae(){return ut||dt.DefaultLanguage}function ie(){return dt.DefaultLanguage}function oe(e){ut=e in dt.Languages?e:dt.DefaultLanguage}function se(){e.UpdateAPIPath(ct.QueryParameter.ProjectGUID,ct.QueryParameter.SubscriptionID)}function le(){return dt.AllowOnlineSurveyIfGPSUnavailable}function ue(r){var n=t.defer();return e.PLATFORM==e.WEB&&!r&&H()?n.resolve(JSON.parse(localStorage.getItem(ct.QueryParameter.ProjectGUID))):e.GetSurveyProperties().then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise}function ce(){return""!=ct.Settings.CSSProperties.QuesFont?ct.Settings.CSSProperties.QuesFont:""}function de(){return""!=ct.Settings.CSSProperties.AnsFont?ct.Settings.CSSProperties.AnsFont:""}function pe(){return""!=ct.Settings.CSSProperties.BtnFont?ct.Settings.CSSProperties.BtnFont:""}function be(){return""!=ct.Settings.CSSProperties.QuesFontSize?ct.Settings.CSSProperties.QuesFontSize:""}function ge(){return""!=ct.Settings.CSSProperties.AnsFontSize?ct.Settings.CSSProperties.AnsFontSize:""}function ve(){return""!=ct.Settings.CSSProperties.BtnFontSize?ct.Settings.CSSProperties.BtnFontSize:""}function L(){return""!=ct.Settings.CSSProperties.NPSBorder?ct.Settings.CSSProperties.NPSBorder:""}function fe(e){}function me(){var e=ct.Settings.CSSProperties;try{""!=e.BackgroundColor&&(Se("#page,.modal-body,.survey-bottomHdr","background-color: "+e.BackgroundColor),Se(".form-checkbox input:checked+.form-icon::before,.imgOption li .icon-check:before","border-color: "+e.BackgroundColor+"!important"),document.getElementById("page").removeAttribute("style"),Se(".message span","color: "+e.BackgroundColor+"!important")),""!=e.BackgroundImage&&Se("#page",'background-size: cover;background-repeat: no-repeat;background-image: url("'+e.BackgroundImage+'")'),""!=e.ButtonsColor&&Se(".prev-next,.captureMediaBtn,.btnOTP,.button.nav,.button.general,.footerLinks li a,.start-up-wrapper .prev-next","background-color: "+e.ButtonsColor+"!important;"),""!=e.ButtonsTxtColor&&(Se(".prev-next,.captureMediaBtn,.btnOTP,.button.nav,.button.general,.start-up-wrapper .prev-next","color: "+e.ButtonsTxtColor+"!important;"),Se(".captureMediaBtn","border-color: "+e.ButtonsTxtColor+"!important")),""!=e.OptionTextColor&&(Se(".fa.fa-star-o,.fa.fa-star,.option-checked .icon-check,.survey-title-text-color ,.icon.icon-forward,.endMsg,.rating-option .fa.back,.text,.rating-label,.btn.btn-primary,.none-div,#rebusText,.nps-box,.grid-txt,.sv-container","color: "+e.OptionTextColor+"!important"),Se(".survey-option-text,.dark-text #rankList1 li,.dragHere","color: "+e.OptionTextColor+"!important"),Se(".imgOption li .icon-check","color: "+ye(e.OptionTextColor)+"!important"),Se(".grid-text-color","color: "+e.OptionTextColor+"!important"),Se("#page .form-checkbox .form-icon,.darkBdr","border: 1px solid "+e.OptionTextColor+"!important"),Se("#page .form-radio .form-icon","border: 1px solid "+e.OptionTextColor+"!important"),Se("#page input","color: "+e.OptionTextColor+"!important"),Se("#page textarea","color: "+e.OptionTextColor+"!important"),Se(".choose-lang","color: "+e.OptionTextColor+"!important"),Se(".max-min","color: "+e.OptionTextColor+"!important"),Se("#page .input-txt","border: 1px solid "+he(e.OptionTextColor,.8)+"!important;outline:none;border-radius:3px;"),Se("#page .input-txt.border-red","border-bottom-color:red !important;outline:none;border-radius:3px;"),Se("#page .input-txt.color-green","color:green !important"),Se(".none-div","border: 1px solid "+he(e.OptionTextColor,.8)+"!important;outline:none;border-radius:2px;"),Se("span:last-child .none-div","border-right: 1px solid"+he(e.OptionTextColor,.8)+"!important;"),Se('#page .input-txt,#page input[type="number"],#page .dropdown',"border: 1px solid "+he(e.OptionTextColor,.8)+"!important;border-top-width:0px!important;border-left-width:0px!important;border-right-width:0px!important;;border-bottom-width:1px!important"),Se(".qGird-table .handsontable tr td:first-child,.qGrid-cell-border,#page .group-seperator,.max-diffTable td:nth-child(1)","border-right: 1px solid "+e.OptionTextColor+"!important"),Se(".qGrid-border-bot,.grid-var-header td","border-bottom: 1px solid "+e.OptionTextColor+"!important"),Se(".btn.btn-primary,.group-container","border-color: "+he(e.OptionTextColor,.8)+"!important"),Se(".bg","border:1px solid "+e.OptionTextColor+"!important"),Se(".form-radio input:checked + .form-icon","background-color:"+e.OptionTextColor+"!important"),Se(".on-hover:hover","color: "+ye(e.OptionTextColor)+"!important"),Se("#page .opt,.rz-bubble","color: "+e.OptionTextColor+"!important"),Se("#page .select-box .opt","color: #000!important"),Se(".none-div:hover,.btn.btn-primary","background-color: "+he(e.OptionTextColor,.2)+"!important"),Se("#page table tr:not(.no-hover-effect):hover ","background-color: "+he(e.OptionTextColor,.2)+"!important"),Se(".persistent.background,.rzslider .rz-pointer","background-color: "+e.OptionTextColor+"!important"),Se(".rzslider .rz-bubble.rz-limit","color: "+e.OptionTextColor+"!important"),Se(".rzslider .rz-bar","background-color:"+he(e.OptionTextColor,.4)+"!important;"),Se(".star-default","background-color:"+e.OptionTextColor+"!important;"),Se(".comp-name","background-color:"+he(e.OptionTextColor,.6)+"!important;color:"+e.OptionTextColor),Se('#page .input-txt.border-all,#page input[type="number"].border-all',"border: 1px solid "+he(e.OptionTextColor,.8)+"!important;border-top-width:1px!important;border-left-width:1px!important;border-right-width:1px!important;;border-bottom-width:1px!important;padding:5px;"),Se(".imgOption li .tick-wrapper","border-color: transparent "+e.OptionTextColor+" transparent transparent!important;"),Se(".input-wrapper .triangle span","border-top: 8px solid "+e.OptionTextColor+"!important;"),Se(".input-wrapper input,.input-wrapper input:focus","border-bottom-color:"+e.OptionTextColor+"!important;"),Se(" .stkv-us-secondary-color--fill-checked.is-checked","fill :"+e.OptionTextColor),Se(".otherInput","border-color :"+e.OptionTextColor+"!important;"),Se(".message","background-color:"+e.OptionTextColor+"!important"),Se(".message div","border-bottom-color:"+e.OptionTextColor+"!important"),Se(".no-answer .option-as-label,.noAnswer .option-as-label","border-color:"+he(e.OptionTextColor,.6)+"!important")),""!=e.SectionHeaderColor&&(Se(".section-header","color: "+ye(e.SectionHeaderColor)+"!important"),Se(".hdrLayout","background-color: "+e.SectionHeaderColor+"!important")),""!=e.SectionFooterColor&&Se(".survey-bottomHdr","background-color: "+e.SectionFooterColor+"!important"),""!=e.QuesFont&&Se('#page,#page option,#page input[type="text"]',"font-family: "+e.QuesFont+"!important"),""!=e.AnsFont&&Se(".option-as-label,#blinkingHint,textarea,.button.navend,.ratingCircle-txt,.nps-box","font-family: "+e.AnsFont+"!important"),""!=e.BtnFont&&Se(".prev-next","font-family: "+e.BtnFont+"!important"),""!=e.QuesFontSize&&Se('#page,#page option,#page input[type="text"]',"font-size: "+e.QuesFontSize+"px!important"),""!=e.AnsFontSize&&(Se('.option-as-label,#blinkingHint,#page input[type="text"],textarea,#page input[type="number"],.htCore',"font-size: "+e.AnsFontSize+"px!important"),Se('#page input[type="text"].otherOption',"font-size: "+.8*e.AnsFontSize+"px!important")),""!=e.BtnFontSize&&Se(".prev-next","font-size: "+e.BtnFontSize+"px!important"),""!=e.BackgroundColor&&Se(".rzslider .rz-pointer:after ","background-color: "+e.BackgroundColor+"!important"),""!=e.QuestionTextColor&&Se(".sq-text,.sq-name,.section-header","color: "+e.QuestionTextColor+"!important"),""!=e.ProgressBarBgColor&&Se(".ques-bar","background-color: "+e.ProgressBarBgColor+"!important"),""!=e.ProgressColor&&Se(".ques-progress","background-color: "+e.ProgressColor+"!important"),""!=e.ProgressTextColor&&Se(".ques-count","color: "+e.ProgressTextColor+"!important"),""!=e.AnswerSelectionBg&&(Se(".option-checked .bg","background-color: "+e.AnswerSelectionBg+"!important;opacity:1!important"),Se(".none-div-background","background-color: "+e.AnswerSelectionBg+"!important"),Se(".form-checkbox input:checked + .form-icon","border-color: "+e.AnswerSelectionBg+"!important"),Se(".form-checkbox input:checked + .form-icon","background-color:"+e.AnswerSelectionBg+"!important;opacity:0.7!important"),Se(".bg:hover,.imgContent:hover","background-color:"+he(e.AnswerSelectionBg,.2)+"!important;opacity:1!important"),Se(".option-checked .bg:hover","background-color:"+he(e.AnswerSelectionBg)+"!important;opacity:1!important")),""!=e.AnswerSelectionColor&&(Se(".option-checked .survey-option-text,.option-checked .icon-check,.nps-background,.none-div-background","color: "+e.AnswerSelectionColor+"!important"),Se(".option-checked .icon-check::before","border-color: "+e.AnswerSelectionColor+"!important")),""!=e.SmileyColor&&(Se(".smiley-img-hover circle:first-child","stroke: "+e.SmileyColor+"!important"),Se(".smiley-img-hover circle:nth-child(2),.smiley-img-hover circle:nth-child(3)","fill: "+e.SmileyColor+"!important"),Se(".smiley-img-hover path","stroke: "+e.SmileyColor+"!important"),Se(".nps-background","background-color: "+e.SmileyColor+"!important")),""!=e.OptionBgColor&&Se(".bg,.dragHere","background-color: "+e.OptionBgColor+"!important;opacity:1"),""!=e.OptionBorderColor&&Se(".option-as-label,.imgOption li .imgContent,.dragHere,.bg,textarea.border-all","border-color: "+e.OptionBorderColor+"!important"),""!=e.StarColor&&(Se(".stkv-us-secondary--fill","fill: "+e.StarColor+"!important"),Se(".smiley circle:first-child","stroke: "+e.StarColor),Se(".smiley circle:nth-child(2),.smiley circle:nth-child(3)","fill: "+e.StarColor),Se(".smiley path","stroke: "+e.StarColor),Se(".npsCircle circle","stroke: "+e.StarColor+"!important"),Se(".npsCircle + span,.nps-star span","color: "+e.StarColor+"!important")),""!=e.StarSelectionColor&&(Se(".stkv-us-secondary-color--fill-checked","fill: "+e.StarSelectionColor+"!important"),Se(".svg-filled + span","color: "+e.StarSelectionColor+"!important"),Se(".svg-filled.npsCircle circle","stroke: "+e.StarSelectionColor+"!important"),Se(".svg-filled.npsCircle circle","fill: "+e.StarSelectionColor+"!important"),Se(".nps-star:hover .stkv-us-secondary--fill","fill:"+he(e.StarSelectionColor,.4)+"!important;opacity:1!important"),Se(".ratingShape:hover .npsCircle circle","stroke:"+he(e.StarSelectionColor,.4)+"!important;")),""!=e.SectionHeaderTextColor&&Se(".btn.btn-link,.survey-title-text-color","color: "+e.SectionHeaderTextColor+"!important"),""!=e.SubmitTextColor&&Se(".button.navend","color: "+e.SubmitTextColor+"!important"),""!=e.SubmitBgColor&&Se(".button.navend","background-color: "+e.SubmitBgColor+"!important"),""!=e.NPSBackground&&(Se(".nps-box.nps-background","background-color: "+e.NPSBackground+"!important"),Se(".nps-box:hover","background-color: "+(e.NPSBackground,.2)+"!important")),""!=e.NPSBorder&&Se(".nps-box.nps-background","border-color: "+e.NPSBorder+"!important;z-index:inherit!important;"),""!=e.NPSText&&Se(".nps-box.nps-background","color: "+e.NPSText+"!important"),""!=e.NPSBorderWidth&&Se(".nps-box .bg,.nps-box.nps-background","border-width: "+e.NPSBorderWidth+"px!important")}catch(e){console.error(e)}}function Se(e,t){if(document.styleSheets&&0!=document.getElementsByTagName("head").length){var r,n;if(document.styleSheets.length>0)for(var a=0,i=document.styleSheets.length;a<i;a++)if(document.styleSheets[a].href&&-1!=document.styleSheets[a].href.indexOf("engine.css")){r=document.styleSheets[a];var o=document.styleSheets[a].media;n=typeof o;break}if(void 0===r){var s=document.createElement("style");for(s.type="text/css",document.getElementsByTagName("head")[0].appendChild(s),a=0;a<document.styleSheets.length;a++)document.styleSheets[a].disabled||(r=document.styleSheets[a]);n=typeof r.media}if("string"===n){for(var a=0,i=r.rules.length;a<i;a++)if(r.rules[a].selectorText&&r.rules[a].selectorText.toLowerCase()==e.toLowerCase())return void(r.rules[a].style.cssText=t);r.addRule(e,t)}else if("object"===n){for(var l=r.cssRules?r.cssRules.length:0,a=0;a<l;a++)if(r.cssRules[a].selectorText&&r.cssRules[a].selectorText.toLowerCase()==e.toLowerCase())return void(r.cssRules[a].style.cssText+=t);r.insertRule(e+"{"+t+"}",l)}}}function he(e,t){if(e&&e.indexOf("#")>-1){var r=e.replace("#","");r=r.match(new RegExp("(.{"+r.length/3+"})","g"));for(var n=0;n<r.length;n++)r[n]=parseInt(1==r[n].length?r[n]+r[n]:r[n],16);return void 0!==t&&r.push(t),"rgba("+r.join(",")+")"}}function ye(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);if(null!=t){if("00"!=t[1])var r=parseInt(t[1],16);else var r=0;if("00"!=t[2])var n=parseInt(t[2],16);else var n=0;if("00"!=t[3])var a=parseInt(t[3],16);else var a=0;return Math.floor((r+n+a)/3)>125?"#000":"#fff"}return"#f4f4f4"}function Oe(t){t==e.ANDROID&&(e.PLATFORM=e.ANDROID),e.InitPlatform()}function Te(){dt.ShowRebusCloudLogo=ct.ShowRebusCloudLogo,i()}function we(){dt.LogoPath=ct.LogoPath,""!=ct.RedirectURL&&(dt.RedirectURL=ct.RedirectURL),i()}function Ie(){dt.LogoPosition=ct.LogoPosition,i()}function Ae(){dt.ArrowPosition=ct.ArrowPosition,i()}function Ve(){dt.LogoPath="",i()}function Ce(){dt.ProgressBarType=ct.ProgressBarType,i()}function xe(){return dt.PanelParameters||{}}function qe(){return dt.EnableReview||!1}function Ce(){dt.ProgressBarType=ct.ProgressBarType,i()}function Pe(){return dt.IsAutoSubmit||window.IsAutoSubmit||!1}function De(){return dt.EnableJumpOnReview||!1}function Le(e){var t;return n.BackCheckStatus.Accepted==e?t=dt.JumpOnReview.Accepted:n.BackCheckStatus.Rejected==e&&(t=dt.JumpOnReview.Rejected),"object"==typeof t?{ID:t.JumpID,Type:t.JumpType}:null}function je(){return dt.IsEnableSubmitButton}function ke(){return dt.ShowProgressBar}function Ge(){return dt.OnLanguageChange.IsEnabled||!1}function Me(){var e=dt.OnLanguageChange.TargetVariableName,t=dt.OnLanguageChange.Callback,n=dt.OnLanguageChange.Parameters,a=r(e);"function"==typeof a[t]&&(n=n.split(",").map(function(e){return e.trim()}),a[t].apply(a,n))}function Ne(){var e=dt.OnSurveyEnd.ApiPath||"";return dt.OnSurveyEnd.Parameters&&(e+=Qe(dt.OnSurveyEnd.Parameters)),e}function Ee(){var e=dt.OnSurveyLaunch.ApiPath||"";return dt.OnSurveyLaunch.Parameters&&(e+=Qe(dt.OnSurveyLaunch.Parameters)),e}function Qe(e){var t="/";e=e.split(",");for(var n in e)t+=r(e[n]).GetValue(),e[parseInt(n)+1]&&(t+="/");return t}function Re(){return dt.ShowLanguageDropdown}function Be(){return dt.ShowLogoOnEndPage}function He(){return dt.ShowSurveyByRebusCloud}function Fe(){return dt.ShowProgressBarText}function Ue(){return dt.ShowFooterLink}function _e(){return dt.Placeholders}function ze(){return dt.Errors}function $e(){return dt.Hints}function We(){return dt.Buttons}function Xe(){return dt.FooterLinkText}function Je(){return dt.FooterLinkURL}function Ke(){return dt.IsStartupPageEnabled||!1}function Ye(){return dt.IsStartupMediaEnabled||!1}function Ze(){return dt.StartupPageMediaType||!1}function et(){return dt.StartUpPage}function tt(){return dt.IsLogoBasedOnLanguage}function rt(){if(!tt())for(var e in re())dt.Logos[e]=dt.LogoPath||dt.Logos[e];return dt.Logos||{}}function nt(e,t){if(dt.Logos)if(tt())dt.Logos[e]=t;else for(var r in re())dt.Logos[r]=t}function at(){if(dt.Logos||(dt.Logos={}),!tt())for(var e in re())dt.Logos[e]=dt.LogoPath||dt.Logos[e];return dt.Logos[ae()]||""}function it(){return dt.Buttons.Submitted[ae()]||dt.Buttons.Submitted[ie()]}function ot(){var e=r("ProjectGUID").GetValue();return"40b3974e-6deb-093a-8baf-37c341654656"==e||"9d810f1b-a166-176a-beb3-937683a06fd7"==e||"81918673-78ab-8971-1201-55a04426d2a9"==e}var st,lt,ut,ct=this,dt=null;ct.QueryParameter={},ct.QuestionPerPage=2,ct.LogoPath="",ct.ShowRebusCloudLogo=!0,ct.ShowQuestionNumber=!0,ct.ProgressBarType=n.ProgressBar.None,ct.LogoPosition="bottomMiddle",ct.ArrowPosition="topBottom",ct.ScreenSize="",ct.RedirectURL="",ct.Settings={},ct.ApplyChanges=me,ct.SetProperties=a,ct.GetBackgroundColor=o,ct.GetBackgroundImage=s,ct.GetSelectionColor=l,ct.GetTextColor=c,ct.GetChoiceColor=u,ct.GetButtonColor=d,ct.GetButtonTxtColor=p,ct.GetOptionTextColor=b,ct.GetOptionSelectionColor=O,ct.GetOptionSelectionBg=T,ct.GetQuestionTextColor=g,ct.SetNextButtonText=G,ct.GetNextButtonText=M,ct.SetBackButtonText=N,ct.GetBackButtonText=E,ct.GetSurveyProperties=ue,ct.SetSurveyProperties=W,ct.GetSectionHeaderColor=v,ct.GetSectionHeaderTextColor=f,ct.GetSectionFooterColor=m,ct.GetQuesFontFamily=ce,ct.GetAnsFontFamily=de,ct.GetBtnFontFamily=pe,ct.GetQuesFontSize=be,ct.GetAnsFontSize=ge,ct.GetBtnFontSize=ve,ct.GetSubmitTextColor=q,ct.GetSubmitBgColor=P,ct.IsPropertiesStoredLocally=H,ct.IsMultipleSurveyPreventionEnabled=F,ct.IsSurveyActive=U,ct.IsPasswordProtectEnabled=_,ct.IsLanguageSelectorEnabled=z,ct.IsCaptureGPSEnabled=$,ct.GetSurveyEndText=Z,ct.GetSurveyClosedText=ee,ct.GetSurveyFooterText=te,ct.GetAllLanguages=re,ct.GetSurveyLanguage=ae,ct.SetSurveyLanguage=oe,ct.SetAPIPath=se,ct.IsAllowIfGPSUnavailable=le,ct.GetSurveyTitle=K,ct.GetDefaultLanguage=ie,ct.GetQuesVersion=Y,ct.UpdateSurveyProperties=i,ct.UpdateSurveySettings=J,ct.ChangeBackgroundURL=fe,ct.GetProgressBarProperties=Q,ct.SetPlatform=Oe,ct.ToggleRebuscloudLogo=Te,ct.ShowCompanyLogo=we,ct.ChangeLogoPosition=Ie,ct.ChangeArrowPosition=Ae,ct.RemoveSurveyLogo=Ve,ct.UpdateProgressBarType=Ce,ct.GetPanelVariables=xe,ct.IsEndReviewEnabled=qe,ct.UpdateQVersion=X,
ct.IsAutoSubmitEnabled=Pe,ct.IsBackCheckChangeJumpEnabled=De,ct.GetBackCheckJumpNode=Le,ct.IsSubmitButtonEnabled=je,ct.IsLanguageChangeActionEnabled=Ge,ct.ExecuteCallback=Me,ct.GetSurveyLaunchApiPath=Ee,ct.GetSurveyEndApiPath=Ne,ct.ShowProgressBar=ke,ct.GetLanguageSetting=Re,ct.IsThumbsUpAllowed=Be,ct.IsSurveyByRebusCloudAllowed=He,ct.IsShowProgressBarTextAllowed=Fe,ct.IsShowFooterLinkAllowed=Ue,ct.GetPlaceholders=_e,ct.GetButtons=We,ct.GetHints=$e,ct.GetErrors=ze,ct.GetFooterLinkTexts=Xe,ct.GetFooterLinkURLs=Je,ct.GetStartUpPageProperties=et,ct.IsStartupEnabled=Ke,ct.IsStartUpMediaEnabled=Ye,ct.GetStartUpMediaType=Ze,ct.IsLogoBasedOnLanguage=tt,ct.GetAllLogos=rt,ct.SetLogoForLang=nt,ct.GetLogoPath=at,ct.GetProgressBarBgColor=S,ct.GetProgressColor=h,ct.GetProgressTextColor=y,ct.GetSmileyColor=w,ct.GetThemeTitle=I,ct.GetAllVisibleLanguages=ne,ct.GetSubmittedButtonText=it,ct.GetOptionBgColor=A,ct.GetOptionBorderColor=V,ct.GetStarColor=C,ct.GetStarSelectionColor=x,ct.IsSurveyVW=ot,ct.GetProgressPrefix=R,ct.GetProgressSuffix=B,ct.GetNPSBackgroundColor=D,ct.GetNPSBorderColor=L,ct.GetNPSTextColor=j,ct.GetNPSBorderWidth=k}e.module("SurveyEngine").service("SurveyEngine.SurveySettings",["EngineCore.CommunicationService","$q","SurveyEngine.Enums",t])}(angular),function(e){"use strict";function t(t,r,n,a,i,o,s,l,u,c,d,p,b,g,v){function f(a,i,s){function v(){null!=I&&(a.HideFullScreen(),a.ShowFullScreen())}function f(){var e=I[0].width,t=I[0].height,r=w[0].clientHeight-50,n=w[0].clientWidth-30,a=e/t,i=parseInt(r*a),o=parseInt(n/a);o>r?I.css("width",i+"px"):I.css("height",o+"px"),i>n?I.css("height",o+"px"):I.css("width",i+"px")}function m(){i.html(a.GetTemplateUrl());var e=p(i.contents())(a);e.addClass("animated"),t.GetAnimation()&&e.addClass(t.GetAnimation()),S()}function S(){l(function(){for(var e=document.getElementsByClassName("sq-name"),t=0;t<e.length;t++){var r=document.getElementsByClassName("sq-name")[t],n=document.getElementsByClassName("sv-container")[t];r&&n&&(r=r.clientWidth,n.style.marginLeft=r+"px")}h()},200)}function h(){if(!n.QuestionPerPage||1==n.QuestionPerPage){var e=document.getElementById("surveyParent"),t=document.getElementsByClassName("card")[0];if(e&&t){var r=e.offsetHeight,a=t.offsetHeight,i=r-a;t.style.marginTop=i>20?i/2-10+"px":"0px"}}}function y(){document.activeElement&&document.activeElement.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})}function O(){a.qObject.IsMandatory=r.Mandatory.NotMandatory}var T,w=null,I=null;a.GetTemplateUrl=function(){var e="";switch(a.qObject&&a.qObject.QuestionType){case r.QuestionType.SingleChoice:e=a.qObject.Properties.hasOwnProperty("Gamify")&&"true"==a.qObject.Properties.Gamify?d.get("singleChoiceGamify.html"):d.get("singleChoice.html");break;case r.QuestionType.MultipleChoice:e=d.get("singleChoice.html");break;case r.QuestionType.Text:e=d.get("text.html");break;case r.QuestionType.Numeric:e=d.get("numeric.html");break;case r.QuestionType.DateTime:e=d.get("datetime.html");break;case r.QuestionType.ComplexGrid:case r.QuestionType.SimpleGrid:case r.QuestionType.TextGrid:case r.QuestionType.NumericGrid:case r.QuestionType.ConstantSumGrid:case r.QuestionType.Distribution:case r.QuestionType.Distribution2:case r.QuestionType.Slider:e=d.get("GridQuestion.html");break;case r.QuestionType.MaxDiff:e=d.get("MaxDiffQuestion.html");break;case r.QuestionType.NPS:e=d.get("nps.html");break;case r.QuestionType.Display:a.path="",a.qObject.Properties.MediaPath&&(a.path=o.trustAsResourceUrl(a.qObject.Properties.MediaPath)),e=d.get("displayText.html");break;case r.QuestionType.Rank:case r.QuestionType.RankAndSort:e=d.get("RankQuestion.html");break;case r.QuestionType.Smiley:case r.QuestionType.LikeDislike:case r.QuestionType.Stars:e=d.get("RatingQuestion.html");break;case r.QuestionType.MultimediaCapture:e=d.get("CaptureQuestion.html");break;case r.QuestionType.HeatMap:case r.QuestionType.HeatZone:e=d.get("HeatMapQuestion.html");break;case r.QuestionType.AutocodeText:e=d.get("AutocodeQuestion.html");break;case r.QuestionType.OTP:e=d.get("otp.html")}return e},a.ShowFullScreen=function(){var t=e.element(i),r=t.find("img");e.forEach(r,function(t){I=e.element(t),I.hasClass("rank-img-expand")&&(I.attr("src",a.qObject.Properties.MediaPath),w=I.parent(),w.css("display","block"),f(),e.element(c).on("resize",v))})},a.HideFullScreen=function(){null!=w&&w.css("display","none"),null!=I&&(I.css("height",""),I.css("width",""),e.element(c).off("resize",v))},a.qObject.QuestionType!=r.QuestionType.NumericGrid&&a.qObject.QuestionType!=r.QuestionType.TextGrid&&a.qObject.QuestionType!=r.QuestionType.Distribution||a.qObject.Properties.MobileFriendly||(a.qObject.Properties.MobileFriendly="true"),function(){var e=a.qObject.QuestionType==r.QuestionType.SimpleGrid||a.qObject.QuestionType==r.QuestionType.ComplexGrid||a.qObject.QuestionType==r.QuestionType.TextGrid||a.qObject.QuestionType==r.QuestionType.NumericGrid||a.qObject.QuestionType==r.QuestionType.ConstantSumGrid||a.qObject.QuestionType==r.QuestionType.Slider||a.qObject.QuestionType==r.QuestionType.Distribution2,t=a.qObject.Properties.hasOwnProperty("Gamify")&&"true"==a.qObject.Properties.Gamify,n=a.qObject.QuestionType==r.QuestionType.HeatMap||a.qObject.QuestionType==r.QuestionType.HeatZone;if(e&&!a.isMobileFriendlyEnabled())require(["handsontable"],function(e){l(function(){m()})});else if(n)require(["fabric"],function(){l(function(){m()})});else if(t)require(["winwheel"],function(){l(function(){m()})});else if(a.qObject.Properties.MediaType==r.MediaType.Picture&&a.qObject.Properties.MediaPath){var i=new Image;i.onload=function(){m()},i.onerror=function(){m()},i.src=a.qObject.Properties.MediaPath}else m()}(),l(function(){if(window.jsrcb.isMobile){var t=document.getElementsByClassName("input-txt");e.forEach(t,function(e){e.addEventListener("focus",a.focusListener),e.addEventListener("blur",a.blurListener)})}}),a.focusListener=function(){var e=document.getElementsByClassName("card")[0];if("eccaad3e-59b1-6af8-1407-4a3baf54c153"==n.QueryParameter.ProjectGUID||"667c7173-1f74-3df1-a120-300ed209a6f9"==n.QueryParameter.ProjectGUID||"f76d3305-cd28-097f-7201-d7548565b28e"==n.QueryParameter.ProjectGUID){var t=document.getElementById("surveyParent"),r=document.getElementById("survey-bottomHdr").offsetHeight,a=document.getElementsByClassName("footerRTE")[0];t&&(t.style.height=t.offsetHeight-r-120+"px"),e&&(e.style.marginTop="0px"),a&&(a.style.display="none")}else{var i=document.getElementById("survey-bottomHdr");i&&(i.style.display="none"),e&&(e.style.marginTop="0px")}l(function(){y()})},window.onresize=function(e){window.jsrcb.isMobile&&(e.preventDefault(),window.jsrcb.isKeypadOpen=!window.jsrcb.isKeypadOpen,!document.activeElement||"INPUT"!==document.activeElement.tagName&&"TEXTAREA"!==document.activeElement.tagName?a.blurListener():window.jsrcb.isKeypadOpen?a.focusListener():a.blurListener())},a.blurListener=function(){l(function(){if("eccaad3e-59b1-6af8-1407-4a3baf54c153"==n.QueryParameter.ProjectGUID||"667c7173-1f74-3df1-a120-300ed209a6f9"==n.QueryParameter.ProjectGUID||"f76d3305-cd28-097f-7201-d7548565b28e"==n.QueryParameter.ProjectGUID){var e=document.getElementById("surveyParent"),t=document.getElementsByClassName("footerRTE")[0];t&&(t.style.display="block");var r=document.getElementById("survey-bottomHdr").offsetHeight;e&&(e.style.height=e.offsetHeight+r+120+"px")}else{var a=document.getElementById("survey-bottomHdr");a&&(a.style.display="block")}h()},100)},a.$on("table-drawn",function(){h()}),a.$on("VideoLoaded",function(e,t){t.addEventListener("ended",O,!1),h()}),a.$on("adjust-question-height",function(e,t){h()}),a.$on("ResourceLoaded",function(t,i){if("true"==a.qObject.Properties.AutoDisappear&&a.qObject.Properties.DisappearTime&&(a.timeRemaining=parseInt(a.qObject.Properties.DisappearTime),!isNaN(a.timeRemaining))){l(function(){b.blockNavigation=!1;var t=document.getElementById("survey-bottomHdr");t&&(t.style.zIndex=9999);var n=document.getElementById("header_top");n&&(n.style.zIndex=0),a.HideFullScreen(),u.cancel(T),e.element(c).off("resize",v),g.RunPostValidation(r.ValidationType.Valid)},1e3*a.timeRemaining),T=u(function(){a.timeRemaining--},1e3),a.ShowFullScreen(),b.blockNavigation=!0;var o=document.getElementById("survey-bottomHdr");o&&(o.style.zIndex=-99999);var s=document.getElementById("header_top");s&&(s.style.zIndex=-99999)}h(),n.IsSurveyVW()&&require(["handsontable"],function(e){})})}function m(o,u,c,d){function p(){}function f(e,t,n,a){function i(){if(0==n.length&&0==t.length)l=!1;else if(n.length>0&&t.length>0&&t[0]==n[0]){l=!0;for(var a in o.qObject.Variables)if(o.qObject.Variables[a].Name==e){o.qObject.Variables[a].VariableType==r.VariableType.SingleChoice&&(l=!o.qObject.Variables[a].Options[t[0]].IsOther),p();break}}}function s(){if(0==n.length&&0==t.length)l=!1;else if(n.length>0&&0==t.length)l=!0;else if(n.length>0&&t.length>0)for(var a in o.qObject.Variables)if(o.qObject.Variables[a].Name==e){o.qObject.Variables[a].VariableType==r.VariableType.MultipleChoice&&o.qObject.Variables[a].Options[t[0]].IsOther&&p();break}}var l=!1;switch(o.qObject.QuestionType){case r.QuestionType.Stars:case r.QuestionType.LikeDislike:case r.QuestionType.SingleChoice:i();break;case r.QuestionType.MultipleChoice:s();break;case r.QuestionType.DateTime:case r.QuestionType.Numeric:case r.QuestionType.Text:l=(0!=n.length||0!=t.length)&&n.length>0;break;case r.QuestionType.SimpleGrid:case r.QuestionType.Distribution:W()?a==r.VariableType.SingleChoice?i():a==r.VariableType.MultipleChoice&&s():p();break;case r.QuestionType.Distribution2:1==Object.keys(o.qObject.Attributes).length&&(l=!0);break;case r.QuestionType.NPS:var u=o.qObject.Variables[o.qObject.QuestionLevelSequence[1].ID].Name;l=e==u}return l}function m(e){var e,n,a=o.qObject.Variables[o.qObject.QuestionLevelSequence[0].ID],i=o.qObject.Variables[o.qObject.QuestionLevelSequence[1].ID],s=[],l={};e==r.VariableType.Numeric||e==r.VariableType.Text?(s=t.GetVariableAnswers(i.Name),e=r.VariableType.SingleChoice,n=i.Name):e==r.VariableType.SingleChoice&&(e=a.VariableType,n=a.Name),l=t.GetAnswerObject([],e,n,o.qObject.ID),t.SaveAnswer(l),u.$broadcast("clearAnswer",{Answers:s,VariableName:n})}function S(){var e={};document.querySelector("#start-recording").disabled=!0,de=3==o.qObject.Properties.MediaType?"video/webm":"audio/ogg; codecs=opus",document.querySelector("#stop-recording").disabled=!1,e=3==o.qObject.Properties.MediaType?{audio:!0,video:!0}:{audio:!0},Ie(e)}function h(){document.querySelector("#stop-recording").disabled=!0,ce.stop(),document.querySelector("#start-recording").disabled=!1,ue&&ue.pause(),le&&le.pause()}function y(e){var r,n=new FormData,a=parseInt(o.qObject.Properties.MediaType),i=o.qObject.ID.replace("|","-"),l=t.GetRespondentID(),u=A();if(e)r="string"==typeof e?I(e):e,n.append("file",r,A());else if(o.isMobileDevice&&2==o.platform){var d=document.getElementById("file").files[0];n.append("file",d,A())}s.SaveMedia(n,l,a,i).then(function(t){o.StopButtonText="Stop";var r=o.qObject.Variables[Object.keys(o.qObject.Variables)[0]],n=u;Oe.SaveAnswer(r.Name,r.VariableType,[n],!0),o.receivedMedia=c.trustAsResourceUrl(t.data)||e,o.editMode=!1,z(),o.DataAvailable=!0},function(e){console.log(e)})}function O(){o.editMode=!0}function T(e,r){for(var n in o.qObject.Variables){var a=o.qObject.Variables[n];if(a.Name!=e){var i=t.GetVariableAnswers(a.Name);if(i.length){var s=i.getIndexOf(r);if(s>-1){i.splice(s,1);var l=t.GetAnswerObject(i,a.VariableType,a.Name,o.qObject.ID);t.SaveAnswer(l)}}}}}function w(e,r){var n=t.GetVariableAnswers(e);if(n.length)for(var a in n){var i=r.indexOf(n[a]);i>-1&&r.splice(i,1)}return r}function I(e){for(var t=100==new Blob([new Uint8Array(100)]).size,r=e.split(",")[1],n="undefined"==typeof atob?window.atob(r):atob(r),a=new ArrayBuffer(n.length),i=new Uint8Array(a),o=0;o<n.length;o++)i[o]=n.charCodeAt(o);t||(i=a);var s=new Blob([i],{type:"image/jpg"});return s.slice=s.slice||s.webkitSlice,s}function A(){var e="",t=o.qObject.ID.replace("|","-");switch(parseInt(o.qObject.Properties.MediaType)){case 1:e=t+".jpg";break;case 2:e=t+".mp3";break;case 3:e=t+".webm"}return e}function V(){var t=document.getElementsByClassName("input-txt");if(e.forEach(t,function(e){e.removeEventListener("focus",o.focusListener),e.removeEventListener("blur",o.blurListener)}),u.$$listeners){var r=u.$$listeners;for(var n in r)"$destroy"!=n&&(r[n]=[])}}function C(){var e=[];if(o.qObject.QuestionType===r.QuestionType.HeatMap)for(var t=1;t<o.qObject.QuestionLevelSequence.length;t++)e.push(o.qObject.QuestionLevelSequence[t].ID);else if(W())e=x();else for(var t=0;t<o.qObject.QuestionLevelSequence.length;t++)switch(o.qObject.QuestionLevelSequence[t].ObjectType){case r.ObjectType.AttributeHeader:for(var n=o.qObject.QuestionLevelSequence[t].ID,a=0;a<o.qObject.AttributeHeaders[n].AttributeSequence.length;a++){var i=o.qObject.AttributeHeaders[n].AttributeSequence[a];if(o.qObject.Attributes[i].ShowInSurvey)for(var s=0;s<o.qObject.Attributes[i].GroupSequence.length;s++)for(var l=o.qObject.Attributes[i].GroupSequence[s],u=0;u<o.qObject.Groups[l].VariableSequence.length;u++)e.push(o.qObject.Groups[l].VariableSequence[u])}break;case r.ObjectType.Attribute:var i=o.qObject.QuestionLevelSequence[t].ID;if(o.qObject.Attributes[i].ShowInSurvey)for(var a=0;a<o.qObject.Attributes[i].GroupSequence.length;a++)for(var l=o.qObject.Attributes[i].GroupSequence[a],s=0;s<o.qObject.Groups[l].VariableSequence.length;s++)e.push(o.qObject.Groups[l].VariableSequence[s])}return e}function x(){var e=[];if(o.qObject.QuestionType==r.QuestionType.TextGrid||o.qObject.QuestionType==r.QuestionType.NumericGrid)for(var t=K(),n=0;n<o.qObject.QuestionLevelSequence.length;n++){var a=o.qObject.QuestionLevelSequence[n];if(a.ObjectType==r.ObjectType.Attribute){var i=o.qObject.QuestionLevelSequence[n].ID;if(o.qObject.Attributes[i].ShowInSurvey){var s=o.qObject.Groups[o.qObject.Attributes[i].GroupSequence[0]];e.push(s.VariableSequence[t])}}}else for(var l=0;l<o.qObject.Attributes[o.AttributePointer].GroupSequence.length;l++)for(var u=o.qObject.Attributes[o.AttributePointer].GroupSequence[l],c=0;c<o.qObject.Groups[u].VariableSequence.length;c++)e.push(o.qObject.Groups[u].VariableSequence[c]);return e}function q(e){return e.reduce(function(e,r){var n=o.qObject.Variables[r].Name,a=t.GetVariableAnswers(n);return e&&a&&a.length>=parseInt(o.qObject.Properties.MinChoices)},!0)}function P(e){function n(e){return o.qObject.Variables[e].VariableType==r.VariableType.SingleChoice||o.qObject.Variables[e].VariableType==r.VariableType.MultipleChoice}return e.reduce(function(e,r){var a=t.GetVariableAnswers(o.qObject.Variables[r].Name);return e&&a&&a.length>0&&a.reduce(function(e,a){if(n(r)&&o.qObject.Variables[r].Options[a].IsOther){var i=o.qObject.Variables[r].Options[a].OtherVariableID,s=Oe.GetOtherVariableName(i),l=t.GetVariableAnswers(s);return e&&J(l)&&l.length>0}return e&&J(a)},e)},!0)}function D(e){if(o.qObject.QuestionType==r.QuestionType.Rank&&o.qObject.Properties.ShowAs==r.ShowAsProperty.DragAndDrop||o.qObject.QuestionType==r.QuestionType.RankAndSort){var n=0;for(var a in o.qObject.Variables)if(-1!=e.indexOf(a)){var i=o.qObject.Variables[a].Name,s=t.GetVariableAnswers(i);s&&0!=s.length&&n++}if(o.qObject.Properties.MaxRankableItems){var l=L();if(n==parseInt(o.qObject.Properties.MaxRankableItems)*l)return!0}return n==o.qObject.QuestionLevelSequence.length}var n=0;for(var a in o.qObject.Variables)if(-1!=e.indexOf(a)){var i=o.qObject.Variables[a].Name,s=t.GetVariableAnswers(i);if(s&&0!=s.length&&n++,s&&0==s.length&&!o.qObject.Properties.MinRankableItems)return o.RankMessage="All items are not ranked",!1;if(s&&0!=s.length&&s[0]>o.qObject.QuestionLevelSequence.length)return o.ErrorAttribute=o.VariableParentMapping[o.qObject.Variables[a].ID],o.RankMessage="Incorrect value entered",!1}return!o.qObject.Properties.MinRankableItems||(n>=parseInt(o.qObject.Properties.MinRankableItems)||(o.RankMessage="You need to rank atleast "+o.qObject.Properties.MinRankableItems+" items",!1))}function L(){var e=o.qObject.QuestionLevelSequence[0].ID;return o.qObject.Attributes[e].GroupSequence.length}function j(e){var n=[];for(var a in o.qObject.Variables)if(-1!=e.indexOf(a)&&o.qObject.Variables[a].VariableType==r.VariableType.Numeric){var i=o.qObject.Variables[a].Name,s=t.GetVariableAnswers(i);void 0!=s[0]&&n.push(s[0])}if(!(n.length>1))return!0;for(var l=n.sort(),u=0;u<n.length-1;u++)if(l[u+1]==l[u])return o.RankMessage="Rank cannot be repeated",!1;if(o.qObject.Properties.MinRankableItems&&n.length==parseInt(o.qObject.Properties.MinRankableItems)){if(l.map(function(e){return e<=parseInt(o.qObject.Properties.MinRankableItems)}).indexOf(!1)>-1)return o.RankMessage="Rank should be within 1 to "+o.qObject.Properties.MinRankableItems,!1}return u==n.length-1||void 0}function k(e){var r=0;for(var n in o.qObject.Variables)if(-1!=e.indexOf(n)){var a=o.qObject.Variables[n].Name,i=t.GetVariableAnswers(a);i&&0!=i.length&&r++}return 2==r}function G(e){var r=0;for(var n in o.qObject.Variables)if(-1!=e.indexOf(n)){var a=o.qObject.Variables[n].Name,i=t.GetVariableAnswers(a);i&&0!=i.length&&r++}return r>=2}function M(e){var r=0;for(var n in o.qObject.Variables)if(-1!=e.indexOf(n)){var a=o.qObject.Variables[n].Name,i=t.GetVariableAnswers(a);i&&0!=i.length&&r++}return r>=1}function N(e){var t=[];for(var n in e){for(var a in e[n].Options)1==e[n].Options[a].IsOther&&t.push(e[n].Options[a].OtherVariableID);if(o.qObject.QuestionType==r.QuestionType.AutocodeText&&t.length>0)break}return t}function E(){Te=!1;var t="";switch(o.qObject.QuestionType){case r.QuestionType.SimpleGrid:case r.QuestionType.Distribution:t="true"!=o.qObject.Properties.MobileFriendly?B():R();break;case r.QuestionType.TextGrid:case r.QuestionType.NumericGrid:t=Q();break;default:return}if(t){var n=e.element(document.getElementById("mobileGridPage"));n.empty(),n.append(t),d(n.contents())(o)}}function Q(){o.ShowMandatoryStar=!1;var e="",r=o.qObject.Groups[o.qObject.MasterAttribute.GroupSequence[0]],n=o.qObject.Variables[r.VariableSequence[o.ColumnIndexPointer]],a=n.Text[o.language]||n.Text[o.DefaultLanguage],s=n.Media[o.language]||n.Media[o.DefaultLanguage],l=!1;a=i(a)(o);var e="<div id='mobile-grid-attr' class='animated "+t.GetAnimation()+"'><div style='padding-bottom: 10px'><img ng-if="+l+" src='"+s+"' style='max-height:100px;max-width:100px;'/><span class='survey-option-text'>"+a+"</span></div>";s&&(l=!0),e+="<ul>";for(var u in o.qObject.QuestionLevelSequence){e+="<li>";var c=o.qObject.QuestionLevelSequence[u].ID,d=o.qObject.Attributes[c],p=d.Text[o.language]||d.Text[o.DefaultLanguage];if(p=i(p)(o)){if(e+="<div class='display-inline-block width-50 grid-txt'>"+p,d.IsOther){var b=o.qObject.Variables[d.OtherVariableID].Name;o.OtherAttributeAnswer[d.ID]=t.GetVariableAnswers(b),e+='<input type="text" class="input-txt" placeholder="'+(oe.Other[o.language]||oe.Other[o.DefaultLanguage])+'" ng-blur="SaveOtherAttributeValue(\''+d.ID+"','"+d.OtherVariableID+"')\" ng-model=\"OtherAttributeAnswer['"+d.ID+"']\">"}e+="</div>"}e+="<div class='display-inline-block width-50'>";for(var g in d.GroupSequence){var v=o.qObject.Groups[d.GroupSequence[g]],f=o.qObject.Variables[v.VariableSequence[o.ColumnIndexPointer]];e+="<survey-variable variable='"+JSON.stringify(f)+"'><div>",4==f.VariableType?(f.Properties.Prefix&&(e+="<span class='survey-option-text display-inline-block'>{{variable.Properties.Prefix}}</span>"),e+="<input ng-class='{\"border-all\":variable.Properties.ShowFullBorder, \"border-red\":(SelectedValues.single < variable.Properties.Min || SelectedValues.single > variable.Properties.Max) && SelectedValues.single }' placeholder={{Placeholder}} class='input-txt focusableInput' type='number' ng-model='SelectedValues.single' ng-init='addVariable("+o.ColumnIndexPointer+")' ng-blur='addVariable("+o.ColumnIndexPointer+")'  ng-change='SetDecimalPlaces(SelectedValues.single);OnBlurSave(SelectedValues.single)'>",f.Properties.Suffix&&(e+="<span  class='survey-option-text display-inline-block'>{{variable.Properties.Suffix}}</span>")):12==f.Properties.ShowAs?e+="<input ng-class='{\"border-all\":variable.Properties.ShowFullBorder, \"border-red\":SelectedValues.single.length < variable.Properties.Min && SelectedValues.single }' variableName='{{variable.Name}}' placeholder='{{Placeholder}}' class='focusableInput darkBdr input-txt full-width' type='text' maxlength='{{variable.Properties.Max}}' ng-model='SelectedValues.single' ng-blur='OnBlurSave(SelectedValues.single)'/>":e+="<textarea ng-class='{\"border-all\":variable.Properties.ShowFullBorder, \"border-red\":SelectedValues.single.length < variable.Properties.Min && SelectedValues.single }' variableName='{{variable.Name}}' placeholder='{{Placeholder}}' class='focusableInput input-txt darkBdr input-text-area' maxlength='{{variable.Properties.Max}}' ng-model='SelectedValues.single' ng-blur='OnBlurSave(SelectedValues.single)'></textarea>",e+="</div></survey-variable>"}e+="</div></li>"}return"ColumnTotal"==o.qObject.Properties.Total&&(e+="<li><div class='display-inline-block width-50 grid-txt'>Total</div><div  class='display-inline-block width-50'> <input type='number' readonly class='input-txt' ng-class='{\"color-green\":Total.conditionMet["+o.ColumnIndexPointer+"]}'  ng-model='Total.sum["+o.ColumnIndexPointer+"]'></div></li>"),e+="</ul>"}function R(){H(o.qObject.Variables);var e=K();a.setAttributePosition(e+1),a.setMaxAttributes(o.qObject.QuestionLevelSequence.length),o.ShowMandatoryStar=!1;var n=o.qObject.Attributes[o.AttributePointer];if(void 0!=n){o.r=window.r;var s=n.Text[o.language]||n.Text[o.DefaultLanguage],l=n.Media[o.language]||n.Media[o.DefaultLanguage],u=!1;l&&(u=!0),s=i(s)(o);var c="<div id='mobile-grid-attr' class='animated "+t.GetAnimation()+"'><div style='padding-bottom: 10px'><img ng-if="+u+" src='"+l+"' style='max-height:100px;max-width:100px;'/><span class='survey-option-text'>"+s+"</span></div>";if(n.IsOther){var d=o.qObject.Variables[n.OtherVariableID].Name;o.OtherAttributeAnswer[n.ID]=t.GetVariableAnswers(d),c+='<input type="text" class="input-txt disply-inline" placeholder="'+(oe.Other[o.language]||oe.Other[o.DefaultLanguage])+'" ng-blur="SaveOtherAttributeValue(\''+n.ID+"','"+n.OtherVariableID+"')\" ng-model=\"OtherAttributeAnswer['"+n.ID+"']\">"}for(var p=0;p<n.GroupSequence.length;p++)for(var b=0;b<o.qObject.Groups[n.GroupSequence[p]].VariableSequence.length;b++){var g=o.qObject.Variables[o.qObject.Groups[n.GroupSequence[p]].VariableSequence[b]];if(g.Properties.Orientation="Auto",c+="<survey-variable variable='qObject.Variables[qObject.Groups[qObject.Attributes[AttributePointer].GroupSequence["+p+"]].VariableSequence["+b+"]]'><i id='blinkingHint' ng-if='HideHint != \"true\" && variable.VariableType == 2' class='survey-option-text font-bold'>Choose as many as you like....</i>",o.qObject.QuestionType==r.QuestionType.SimpleGrid)c+="<survey-options></survey-options>";else if(o.qObject.QuestionType==r.QuestionType.Distribution){"8"==o.qObject.Properties.ShapeType?c+='<div class="display-inline-block fixedTable"><div  style="width:100%;border-spacing:2px;">':c+='<div class="display-inline-block fixedTable"><div  style="display:table-caption!important;width:100%;border-spacing:2px;">';for(var v in g.VariableLevelSequence){var f=g.VariableLevelSequence[v];g.Options[f.ID].IsExclusive||(c+='<div  style="display:table-cell"><survey-stars ng-class="'+g.VariableLevelSequence.length+" >= 8 ? 'smiley-big' : 'smiley-small'\" ng-click=\"SaveAnswer("+g.Options[f.ID].Code+')" class="pos-rel" ng-mouseenter="setHoverID('+f.ID+')" ng-mouseleave="removeHoverID()"  exclusive-id="{{RatingQuestionConfig.ExclusiveID}}" option-id="'+f.ID+'" style="margin-right:5px;"></survey-stars></div>')}c+="</div>","true"==o.qObject.Properties.ShowLabels&&(c+='<div class="padding-5 rating-label"><span class="text-left display-inline-block" style="width:31%;vertical-align:top">',(o.qObject.LeftLabel[o.language]||o.qObject.LeftLabel[o.DefaultLanguage])&&(c+="<i>"+(o.qObject.LeftLabel[o.language]||o.qObject.LeftLabel[o.DefaultLanguage])+"</i>"),c+="</span>",c+='<span class="text-center display-inline-block" style="width: 36%;vertical-align: top;margin-left: 1%;">',(o.qObject.MidLabel[o.language]||o.qObject.MidLabel[o.DefaultLanguage])&&(c+="<i>"+(o.qObject.MidLabel[o.language]||o.qObject.MidLabel[o.DefaultLanguage])+"</i>"),c+='</span><span class="text-right display-inline-block" style="width:31%;vertical-align:top"> ',(o.qObject.RightLabel[o.language]||o.qObject.RightLabel[o.DefaultLanguage])&&(c+="<i>"+(o.qObject.RightLabel[o.language]||o.qObject.RightLabel[o.DefaultLanguage])+"</i>"),c+="</span></div>"),c+='<div ng-if="RatingQuestionConfig.ExclusiveID" class="noAnswer"><survey-option option-id="{{RatingQuestionConfig.ExclusiveID}}"></survey-option>',c+="</div>"}c+="</survey-variable>"}return c+="</div>"}}function B(){o.ShowMandatoryStar=!1,o.r=window.r;var e="<div id='mobile-grid-attr' class='animated "+t.GetAnimation()+"'>";for(var n in o.qObject.QuestionLevelSequence){if(o.qObject.QuestionLevelSequence[n].ObjectType!=r.ObjectType.Attribute)return;var a=o.qObject.QuestionLevelSequence[n].ID,s=o.qObject.Attributes[a];if(void 0!=s){var l=s.Text[o.language]||s.Text[o.DefaultLanguage],u=s.Media[o.language]||s.Media[o.DefaultLanguage],c=!1;if(u&&(c=!0),l=i(l)(o),e+="<div style='padding-bottom: 10px'><img ng-if="+c+" src='"+u+"' style='max-height:100px;max-width:100px;'/><span class='survey-option-text'>"+l+"</span></div>",s.IsOther){var d=o.qObject.Variables[s.OtherVariableID].Name;o.OtherAttributeAnswer[s.ID]=t.GetVariableAnswers(d),e+='<input type="text" class="input-txt disply-inline" placeholder="'+(oe.Other[o.language]||oe.Other[o.DefaultLanguage])+'" ng-blur="SaveOtherAttributeValue(\''+s.ID+"','"+s.OtherVariableID+"')\" ng-model=\"OtherAttributeAnswer['"+s.ID+"']\">"}for(var p=0;p<s.GroupSequence.length;p++)for(var b=0;b<o.qObject.Groups[s.GroupSequence[p]].VariableSequence.length;b++){var g=o.qObject.Variables[o.qObject.Groups[s.GroupSequence[p]].VariableSequence[b]];g.Properties.Orientation="Auto",e+="<survey-variable variable='qObject.Variables[qObject.Groups[qObject.Attributes[\""+s.ID+'"].GroupSequence['+p+"]].VariableSequence["+b+"]]'><i id='blinkingHint' ng-if='HideHint != \"true\" && variable.VariableType == 2' class='survey-option-text font-bold'>Choose as many as you like....</i>",e+='<div class="display-inline-block pull-left" ng-class="{\'noAnswerShape\':RatingQuestionConfig.ExclusiveID}"><div  style="display:table!important;width:100%;border-spacing:2px;">';for(var n in g.VariableLevelSequence){var v=g.VariableLevelSequence[n];g.Options[v.ID].IsExclusive||(e+='<div  style="display:table-cell"><survey-stars ng-class="'+g.VariableLevelSequence.length+" >= 8 ? 'smiley-big' : 'smiley-small'\" ng-click=\"SaveAnswer("+g.Options[v.ID].Code+')" class="pos-rel" ng-mouseenter="setHoverID('+v.ID+')" ng-mouseleave="removeHoverID()" exclusive-id="{{RatingQuestionConfig.ExclusiveID}}" option-id="'+v.ID+'"></survey-stars></div>')}e+="</div>","true"==o.qObject.Properties.ShowLabels&&(e+='<div class="padding-5 rating-label"><span class="text-left display-inline-block" style="width:31%;vertical-align:top">',(o.qObject.LeftLabel[o.language]||o.qObject.LeftLabel[o.DefaultLanguage])&&(e+="<i>"+(o.qObject.LeftLabel[o.language]||o.qObject.LeftLabel[o.DefaultLanguage])+"</i>"),e+="</span>",e+='<span class="text-center display-inline-block" style="width:36%;vertical-align:top;margin-left:1%">',(o.qObject.MidLabel[o.language]||o.qObject.MidLabel[o.DefaultLanguage])&&(e+="<i>"+(o.qObject.MidLabel[o.language]||o.qObject.MidLabel[o.DefaultLanguage])+"</i>"),e+='</span><span class="text-right display-inline-block" style="width:31%;vertical-align:top"> ',(o.qObject.RightLabel[o.language]||o.qObject.RightLabel[o.DefaultLanguage])&&(e+="<i>"+(o.qObject.RightLabel[o.language]||o.qObject.RightLabel[o.DefaultLanguage])+"</i>"),e+="</span></div>"),e+="</div>",e+='<div ng-if="RatingQuestionConfig.ExclusiveID" class=" no-answer ratingNoAns pull-left"><survey-option option-id="{{RatingQuestionConfig.ExclusiveID}}"></survey-option></div><span class="clearfix"></span>',e+="</survey-variable>"}}}return e+="</div>",e+="</div>"}function H(n){var a=[],i=[];for(var o in n){if(0==a.length)for(var s in n[o].Options)n[o].Options[s].IsExclusiveAcrossRows&&a.push(s);n[o].VariableType!=r.VariableType.SingleChoice&&n[o].VariableType!=r.VariableType.MultipleChoice||i.push(o)}for(var o in n){if(0==se.length&&n[o].VariableLevelSequence.length){se=e.copy(n[o].VariableLevelSequence);break}n[o].VariableLevelSequence=e.copy(se)}for(var l=0;l<i.length;l++)for(var u=t.GetVariableAnswers(n[i[l]].Name),c=0;c<u.length;c++)if(a.hasItem(u[c]))for(var o in n)if(o!=i[l]){for(var d=0;d<n[o].VariableLevelSequence.length;d++)if(n[o].VariableLevelSequence[d].ID==u[c]){n[o].VariableLevelSequence.splice(d,1);break}for(var p in n[o].OptionGroups){var b=n[o].OptionGroups[p].indexOf(u[c]);if(b>-1){n[o].VariableLevelSequence.splice(b,1);break}}}}function F(e,t){var n=o.qObject.Variables[t].Name;v.IsNotNullOrEmpty(o.OtherAttributeAnswer[e])?o.SaveAnswer(n,r.VariableType.Text,o.OtherAttributeAnswer[e],!0):(o.OtherAttributeAnswer[e]=[],o.SaveAnswer(n,r.VariableType.Text,o.OtherAttributeAnswer[e],!0))}function U(){o.VariableParentMapping={};for(var e in o.qObject.Attributes)for(var t=0;t<o.qObject.Attributes[e].GroupSequence.length;t++)for(var r=o.qObject.Attributes[e].GroupSequence[t],n=0;n<o.qObject.Groups[r].VariableSequence.length;n++)o.VariableParentMapping[o.qObject.Groups[r].VariableSequence[n]]=e}function _(){o.receivedMedia&&(3==o.qObject.Properties.MediaType?(le=document.querySelector("#captureVideo"),le.play()):(ue=document.querySelector("#captureAudio"),ue.play()))}function z(){3==o.qObject.Properties.MediaType?(le=document.querySelector("#captureVideo"),le.src=o.receivedMedia,le.load()):2==o.qObject.Properties.MediaType&&(ue=document.querySelector("#captureAudio"),ue.src=o.receivedMedia,ue.load())}function $(){function e(e,t,n){if(e&&W()&&X())return Y(!0),E(),void o.$emit("OnNextClickProcessed");e?g.RunPostValidation(r.ValidationType.Valid):t?o.FirstClick?(n&&v.ShowError(t,n,o.qObject.ID),o.FirstClick=!1):g.RunPostValidation(r.ValidationType.Valid):(n&&v.ShowError(t,n,o.qObject.ID),v.ShakeMe(),g.RunPostValidation(r.ValidationType.InValid))}var t=!1,a=N(o.qObject.Variables),i=function(){var e=[];switch(o.qObject.QuestionType){case r.QuestionType.ComplexGrid:case r.QuestionType.TextGrid:case r.QuestionType.NumericGrid:case r.QuestionType.ConstantSumGrid:case r.QuestionType.Distribution:case r.QuestionType.Distribution2:case r.QuestionType.Slider:case r.QuestionType.MaxDiff:case r.QuestionType.Rank:case r.QuestionType.RankAndSort:case r.QuestionType.HeatMap:case r.QuestionType.SimpleGrid:e=C();break;case r.QuestionType.AutocodeText:e.push(o.qObject.QuestionLevelSequence[0].ID);break;default:for(var t in o.qObject.Variables)e.push(o.qObject.Variables[t].ID)}return e}().filter(function(e){return-1==a.indexOf(e)&&e!=o.qObject.Properties.RecordingVariable&&e!=o.qObject.Properties.TimerVariable}),s=v.IsDataValid;o.qObject.QuestionType==r.QuestionType.OTP&&(ne(),s&=ie()),t=function(e){var t=!1;switch(o.qObject.QuestionType){case r.QuestionType.RankAndSort:t=D(e);break;case r.QuestionType.Rank:o.qObject.Properties.ShowAs!=r.ShowAsProperty.DragAndDrop&&(t=D(e)&&j(e));break;case r.QuestionType.MaxDiff:t=k(e);break;case r.QuestionType.HeatMap:t=G(e);break;case r.QuestionType.Text:case r.QuestionType.Numeric:t=M(e);break;default:o.qObject.Properties.MinChoices?t=q(e):(t=P(e),o.qObject.Properties.ShowAs==r.ShowAsProperty.ConstantSum&&"None"!=o.qObject.Properties.Total&&(t&=o.validateTotal()),o.qObject.QuestionType==r.QuestionType.OTP&&(t=t&&v.VerifiedQuestionOTPMap[o.qObject.ID]))}return t}(i),o.AnswerInvalid=t;var l=n.GetErrors(),u=""
;o.qObject.Properties.ShowAs==r.ShowAsProperty.ConstantSum&&"None"!=o.qObject.Properties.Total?e(t,!1):o.qObject.QuestionType==r.QuestionType.MultipleChoice&&o.qObject.Properties.MinChoices?(u=(l.MinCategory[o.language]||l.MinCategory[o.DefaultLanguage]).replace("_",o.qObject.Properties.MinChoices),e(t,!1,u)):o.qObject.IsMandatory==r.Mandatory.WarnAndContinue?(u=l.WarnAndContinue[o.language]||l.WarnAndContinue[o.DefaultLanguage],e(t,!0,u)):o.qObject.IsMandatory==r.Mandatory.Mandatory?(u=l.Mandatory[o.language]||l.Mandatory[o.DefaultLanguage],e(t,!1,u)):e(s)}function W(){return(o.qObject.QuestionType==r.QuestionType.SimpleGrid||o.qObject.QuestionType==r.QuestionType.NumericGrid||o.qObject.QuestionType==r.QuestionType.TextGrid||o.qObject.QuestionType==r.QuestionType.Distribution)&&"true"==o.qObject.Properties.MobileFriendly}function X(){var e=K();return-1!=e&&(o.qObject.QuestionType==r.QuestionType.SimpleGrid||o.qObject.QuestionType==r.QuestionType.Distribution?e!=o.qObject.QuestionLevelSequence.length-1:e!=o.qObject.Groups[o.qObject.MasterAttribute.GroupSequence[0]].VariableSequence.length-1)}function J(e){return null!=e&&void 0!=e}function K(){var e=-1;return o.qObject.QuestionType==r.QuestionType.SimpleGrid||o.qObject.QuestionType==r.QuestionType.Distribution?e=o.qObject.QuestionLevelSequence.map(function(e){return e.ID}).indexOf(o.AttributePointer):o.qObject.QuestionType!=r.QuestionType.TextGrid&&o.qObject.QuestionType!=r.QuestionType.NumericGrid||(e=o.ColumnIndexPointer),e}function Y(e){var t=K();o.qObject.QuestionType==r.QuestionType.SimpleGrid||o.qObject.QuestionType==r.QuestionType.Distribution?e&&X()?o.AttributePointer=o.qObject.QuestionLevelSequence[t+1].ID:t>=0&&(o.AttributePointer=o.qObject.QuestionLevelSequence[t-1].ID):o.qObject.QuestionType!=r.QuestionType.TextGrid&&o.qObject.QuestionType!=r.QuestionType.NumericGrid||(e&&X()?o.ColumnIndexPointer=t+1:t>=0&&(o.ColumnIndexPointer=t-1))}function Z(e,t){o.ErrorConfig.Message=t,o.ErrorConfig.Style=e?{"background-color":"#e65c00"}:{"background-color":"#990000"},o.ErrorConfig.CaretStyle=e?{"border-bottom":"5px solid #e65c00"}:{"border-bottom":"5px solid #990000"},o.ErrorConfig.ShowError=!0}function ee(){o.ErrorConfig.ShowError=!1}function te(e){e&&(e.keyCode>=48&&e.keyCode<=57||e.keyCode>=96&&e.keyCode<=105)&&document.getElementById(parseInt(e.currentTarget.id)+1).focus()}function re(){o.SendClicked=!0;var e=o.qObject.Variables[o.qObject.QuestionLevelSequence[0].ID].Name,n=t.GetVariableAnswers(e)[0],a=t.GetVariableAnswers("ID")[0];if(n&&a){var i=t.IsTest===r.SurveyType.Live?"live":"test";s.SendOTP(n,a,i).then(function(){o.otpMessage="OTP sent successfully!"},function(e){o.otpMessage=e.data?e.data.Message+"!":e.Message+"!"})}}function ne(){var e=o.EnteredOTP.join(""),n=o.qObject.Variables[o.qObject.QuestionLevelSequence[0].ID].Name,a=t.GetVariableAnswers(n)[0],i=t.GetVariableAnswers("ID")[0];a&&i&&o.EnteredOTP.length>0&&(v.VerifyOTP(a,i,e)?(v.VerifiedQuestionOTPMap[o.qObject.ID]=!0,ae(!0),o.otpMessage="OTP valid, click next to continue!"):(v.VerifiedQuestionOTPMap[o.qObject.ID]=!1,ae(!1),o.otpMessage="Invalid OTP, enter correct OTP or try resend OTP!"),v.QuestionOTPMap[o.qObject.ID]=o.EnteredOTP);var s=t.GetSurveyMode();s!=r.SurveyMode.New&&s!=r.SurveyMode.Resume&&(v.VerifiedQuestionOTPMap[o.qObject.ID]=!0,v.QuestionOTPMap[o.qObject.ID]=o.EnteredOTP,o.otpMessage="OTP valid, click next to continue!")}function ae(e){var n=o.qObject.Variables[o.qObject.QuestionLevelSequence[1].ID];if(n){var a=e?n.Options[n.VariableLevelSequence[0].ID].Code:n.Options[n.VariableLevelSequence[1].ID].Code,i=t.GetAnswerObject([a],r.VariableType.SingleChoice,n.Name,o.qObject.ID);t.SaveAnswer(i)}}function ie(){return!o.EnteredOTP.filter(function(e,t){return""!=e}).length||v.VerifiedQuestionOTPMap[o.qObject.ID]}if(null==o.qObject||void 0==o.qObject)return void console.error("question object cannot be null or undefined");var oe=(n.GetHints(),n.GetPlaceholders()),se=[];o.ShowQuestionNumber=n.ShowQuestionNumber,o.ShowMandatoryStar=!1,o.AnswerInvalid=!1,o.IsImage=!1,o.IsAudio=!1,o.IsVideo=!1,o.Total={sum:[],conditionMet:[]},o.EnteredOTP=v.QuestionOTPMap[o.qObject.ID]||[],o.OtherAttributeAnswer={},o.FirstClick=!0,o.GenerateMobileGridHtml=E,o.SaveImage=y,o.EditMedia=O,o.editMode=!1,o.receivedMedia="",o.isMobileDevice=window.jsrcb.isMobile,o.platform=s.PLATFORM,o.rowVariables={},o.StartRecording=S,o.StopRecording=h,o.PlayRecording=_,o.SaveOtherAttributeValue=F,o.isMobileFriendlyEnabled=W,o.ShiftFocus=te,o.SendOTP=re,o.VerifyOTP=ne,o.VerifiedQuestionOTPMap=v.VerifiedQuestionOTPMap,o.DataAvailable=!1,o.StopButtonText="Save data";var le,ue,ce,de,pe={};if(o.ErrorConfig={ShowError:!1,Message:"",Style:{}},v.AddErrorCallback(Z,o.qObject.ID),v.AddHideErrorCallback(ee,o.qObject.ID),o.qObject.QuestionType==r.QuestionType.SimpleGrid)for(var be in o.qObject.Attributes){var ge=o.qObject.Attributes[be];for(var ve in ge.GroupSequence){var fe=o.qObject.Groups[ge.GroupSequence[ve]];for(var me in fe.VariableSequence){var Se=o.qObject.Variables[fe.VariableSequence[me]];ge.IsExclusiveAcrossColumn&&(pe[Se.Name]=Se)}}}if(function(){U()}(),o.qObject.QuestionType!=r.QuestionType.SimpleGrid&&o.qObject.QuestionType!=r.QuestionType.Distribution||(o.AttributePointer=o.qObject.QuestionLevelSequence[0].ID),o.qObject.QuestionType!=r.QuestionType.TextGrid&&o.qObject.QuestionType!=r.QuestionType.NumericGrid||(o.ColumnIndexPointer=0),o.default?o.DefaultLanguage=o.default:o.DefaultLanguage=n.GetDefaultLanguage(),o.qObject.QuestionType==r.QuestionType.MultimediaCapture){var he=t.GetRespondentID(),ye=A();s.GetMedia(ye,he).then(function(e){o.isMobileDevice?e&&(o.receivedMedia=c.trustAsResourceUrl(e)):(o.receivedMedia=c.trustAsResourceUrl(e),z(),o.DataAvailable=!0)},function(e){console.log("media not found")})}var Oe=this;Oe.Language=o.language,Oe.DefaultLanguage=o.DefaultLanguage,Oe.qObject=o.qObject,Oe.shouldShiftFocus=!1,Oe.GetOtherVariableName=function(e){return o.qObject.Variables[e].Name},Oe.GetOtherVariableType=function(e){return o.qObject.Variables[e].VariableType},Oe.getVariableFromName=function(e){var t=null;for(var r in o.qObject.Variables)o.qObject.Variables.hasOwnProperty(r)&&o.qObject.Variables[r].Name===e&&(t=o.qObject.Variables[r]);return t};var Te=!1;if(Oe.SaveAnswer=function(e,a,i,s,c,d,g){function S(e,t){return t.filter(function(t){return!e.hasItem(t)}).concat(e.filter(function(e){return!t.hasItem(e)}))}var h=!1;v.HideError(o.qObject.ID),void 0==i||Array.isArray(i)||(i=[i]),(o.qObject.QuestionType==r.QuestionType.Numeric||o.qObject.QuestionType==r.QuestionType.Text)&&o.qObject.QuestionLevelSequence.length>1&&i.length>0&&m(a);var y=t.GetVariableAnswers(e);if(h=i.length>0&&f(e,S(y,i),i,a)&&!b.TOGGLE_BUTTON,a==r.VariableType.Text||a==r.VariableType.Numeric||a==r.VariableType.DateTime||s){var O=t.GetAnswerObject(i,a,e,o.qObject.ID);t.SaveAnswer(O),h=h&&!b.IS_BLUR_EVENT}else{if(Object.keys(pe).length>0&&pe.hasOwnProperty(e)){i=w(e,i);var I=t.GetVariableAnswers(e);u.$broadcast("updateAnswers",{message:e,AllowSingleAnswerInRow:pe,Answers:I})}if(c){var A=S(y,i);T(e,A[0]),u.$broadcast("updateAnswers",{message:e,ExclusiveAcrossRows:c,Answers:A})}var O=t.GetAnswerObject(i,a,e,o.qObject.ID);t.SaveAnswer(O)}n.IsAutoSubmitEnabled()&&i.length>0&&!g&&(h?Te||(Te=!0,l(function(){b.Next()},700)):p())},o.SaveAnswer=Oe.SaveAnswer,o.displayedText=o.qObject.Text[o.language]?o.qObject.Text[o.language]:o.qObject.Text[o.DefaultLanguage],o.qObject.Properties.MediaPath){var we=o.qObject.Properties.MediaType;o.imageWidth="300px",o.imageHeight="300px",we==r.MediaType.Picture.toString()?(o.isImage=!0,o.qObject.Properties.Width&&""!=o.qObject.Properties.Width&&(o.imageWidth=o.qObject.Properties.Width),o.qObject.Properties.Height&&""!=o.qObject.Properties.Height&&(o.imageHeight=o.qObject.Properties.Height)):we==r.MediaType.Audio.toString()?o.isAudio=!0:o.isVideo=!0}var Ie=function(e){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var t=function(e){console.log("Reeeejected!",e)},r=function(e){require(["MediaStreamRecorder"],function(){ce=new MediaStreamRecorder(e),ce.mimeType=de,ce.ondataavailable=function(e){o.StopButtonText="Saving data..",y(e)},3==o.qObject.Properties.MediaType?(le=document.querySelector("#captureVideo"),le.srcObject=e,le.play()):(ue=document.querySelector("#captureAudio"),ue.srcObject=e,ue.play()),ce.start()})};navigator.getUserMedia?navigator.getUserMedia(e,r,t):console.log("Capture Video Not Supported!")};g.AddResetMovementCallback(function(){Te=!1}),g.AddValidationCallback($),V(),g.AddBeforeBackMoveCallback(function(){var e=K();return o.isMobileFriendlyEnabled()&&e>0?(Y(!1),a.setAttrPointer(o.AttributePointer),E(),!1):(V(),!0)}),t.AddListener(o.$on("$destroy",function(){V()})),o.validateTotal=function(){var e=!0;for(var t in o.Total.sum){if(o.qObject.Properties.TotalOperator){switch(o.qObject.Properties.TotalOperator){case"=":o.Total.sum[t]!=o.qObject.Properties.TotalCount&&(e=!1);break;case"<":o.Total.sum[t]>=o.qObject.Properties.TotalCount&&(e=!1);break;case">":o.Total.sum[t]<=o.qObject.Properties.TotalCount&&(e=!1);break;case"<=":o.Total.sum[t]>o.qObject.Properties.TotalCount&&(e=!1);break;case">=":o.Total.sum[t]<o.qObject.Properties.TotalCount&&(e=!1)}if(0==e){o.Total.conditionMet[t]=e;break}}o.Total.conditionMet[t]=e}return e}}return{link:f,controller:["$scope","$rootScope","$sce","$compile",m],restrict:"E",scope:{qObject:"=",language:"@",default:"@",review:"=?"}}}e.module("SurveyEngine").directive("surveyQuestion",["SurveyEngine.RespondentService","SurveyEngine.Enums","SurveyEngine.SurveySettings","EngineCore.TraversalListService","$interpolate","$sce","EngineCore.CommunicationService","$timeout","$interval","$window","$templateCache","$compile","SurveyEngine.NavigatorService","SurveyEngine.PageRouteService","SurveyEngine.ValidatorService",t]),e.module("SurveyEngine").filter("trusted",["$sce",function(e){return function(t){return e.trustAsResourceUrl(t)}}])}(angular),function(e){"use strict";function t(e,t,r,n){function a(r,a,i,o){function s(){function e(e,t,r){var n,a="",o="";i.cell.push({row:r,col:0,className:"qGrid-cell qGrid-border-bot"});for(n in e)0!=n&&(i.data[r][n]=e[n],i.cell.push({row:r,col:n,className:"qGrid-cell qGrid-cell-head qGrid-cell-header qGrid-border-bot"+(i.borderCols.indexOf(n)>-1?" qGrid-cell-border":"")}),a="r"+r+"c"+n,o="r"+t+"c"+n,i.cellProperties[a]=i.cellProperties[o])}function t(e,t,a,i,o,s){var l=0,u="";i.data[a]=new Array(i.totalCols),i.data[a][l]=t.Text[r.language],i.cell.push({row:a,col:l,className:"qGrid-cell qGrid-cell-head qGrid-attribute-cell"+(o?" qGrid-attribute-ingroup":"")+(e.QuestionType==n.QuestionType.Distribution2?" simpleGrid":"")}),u="r"+a+"c"+l,i.cellProperties[u]={IsHeader:!0,CellType:n.ObjectType.Attribute,OptionCode:null,ID:t.ID,ParentID:s,ClassName:"qGrid-cell qGrid-cell-head qGrid-attribute-cell"+(o?" qGrid-attribute-ingroup":"")+(e.QuestionType==n.QuestionType.Distribution2?" simpleGrid":"")},l++;for(var c in t.GroupSequence){var d=e.Groups[t.GroupSequence[c]];for(var p in d.VariableSequence){var b=e.Variables[d.VariableSequence[p]];switch(b.VariableType){case n.VariableType.SingleChoice:case n.VariableType.MultipleChoice:if("2"==b.Properties.ShowAs)i.cell.push({row:a,col:l,className:"qGrid-cell qGrid-variable-cell"+(i.borderCols.indexOf(l)>-1?" qGrid-cell-border":"")}),u="r"+a+"c"+l,i.cellProperties[u]={IsHeader:!1,CellType:n.ObjectType.Variable,OptionCode:null,ID:b.ID},l++;else for(var g in b.VariableLevelSequence){var v=b.VariableLevelSequence[g],f=l;if(v.IsOption){var m=b.Options[v.ID];e.QuestionType==n.QuestionType.Distribution2&&m.IsExclusive&&(f=i.totalCols-1),i.cell.push({row:a,col:f,className:"qGrid-cell qGrid-option-cell"+(i.borderCols.indexOf(f)>-1?" qGrid-cell-border":"")+(t.Media[r.language]||t.Media[r.DefaultLanguage]?" image-attribute ":"")}),u="r"+a+"c"+f,i.cellProperties[u]={IsHeader:!1,CellType:n.ObjectType.Option,OptionCode:m.Code.toString(),OptionID:m.ID,ID:b.ID},l++}}break;case n.VariableType.Text:case n.VariableType.Numeric:case n.VariableType.DateTime:i.cell.push({row:a,col:l,className:"qGrid-cell qGrid-variable-cell"+(i.borderCols.indexOf(l)>-1?" qGrid-cell-border":"")}),u="r"+a+"c"+l,i.cellProperties[u]={IsHeader:!1,CellType:n.ObjectType.Variable,OptionCode:null,ID:b.ID},l++}}}if(i.enableRightText){var S=l;e.QuestionType==n.QuestionType.Distribution2&&i.isNoAnsAdded&&(S=i.totalCols-2),i.data[a][S]=t.Text2[r.language]||t.Text2[r.DefaultLanguage],i.cell.push({row:a,col:S,className:"qGrid-cell qGrid-cell-head qGrid-attribute-cell survey-option-text font-size-75 min-width-120 text-left-important"+(o?" qGrid-attribute-ingroup":"")})}i.isRowTotal&&(i.cell.push({row:a,col:l,className:"qGrid-cell qGrid-variable-cell survey-option-text"+(i.borderCols.indexOf(l)>-1?" qGrid-cell-border":"")}),u="r"+a+"c"+l,i.cellProperties[u]={IsHeader:!0,CellType:n.ObjectType.Variable,OptionCode:null,ID:null,IsConstantSum:!0})}var i={data:[],mergeCells:[],cellProperties:{},cell:[],borderCols:[],totalCols:1,totalRows:function(e){var t=0;for(var r in e.QuestionLevelSequence){var a=e.QuestionLevelSequence[r];if(a.ObjectType==n.ObjectType.AttributeHeader)for(var i in e.AttributeHeaders[a.ID].AttributeSequence)t++;t++}return t}(r.qObject),enableRightText:!1,repeatHeader:"true"==r.qObject.Properties.RepeatHeader,repeatPositions:[],isRowTotal:14==r.qObject.QuestionType&&"11"==r.qObject.Properties.ShowAs&&"RowTotal"==r.qObject.Properties.Total,isColTotal:14==r.qObject.QuestionType&&"11"==r.qObject.Properties.ShowAs&&"ColumnTotal"==r.qObject.Properties.Total},o={instance:null,cellMap:null},s=0,l=!1,c=0;if(i.repeatPositions=i.repeatHeader?u(i.totalRows):[],i.totalCols+=function(e,t){var r=0;for(var a in e.MasterAttribute.GroupSequence){var i=e.Groups[e.MasterAttribute.GroupSequence[a]];for(var o in i.VariableSequence){var s=e.Variables[i.VariableSequence[o]];switch(s.VariableType){case n.VariableType.SingleChoice:case n.VariableType.MultipleChoice:if("2"==s.Properties.ShowAs)r++;else for(var l in s.VariableLevelSequence){var u=s.VariableLevelSequence[l];u.IsOption&&r++}break;case n.VariableType.Text:case n.VariableType.Numeric:case n.VariableType.DateTime:r++}}t.borderCols.push(r)}if((e.QuestionType==n.QuestionType.Distribution2||t.isRowTotal)&&(t.enableRightText=!0,r++),e.QuestionType==n.QuestionType.Distribution2){var i=e.Groups[e.MasterAttribute.GroupSequence[0]],s=e.Variables[i.VariableSequence[0]];Object.keys(s.Options).map(function(e){!0===s.Options[e].IsExclusive&&(t.isNoAnsAdded=!0)})}return r}(r.qObject,i),r.qObject.QuestionType!=n.QuestionType.Slider?(s=function(e,t){var a=1,i=0,o=e.QuestionType==n.QuestionType.ComplexGrid,s="";for(var l in e.MasterAttribute.GroupSequence){var u=e.Groups[e.MasterAttribute.GroupSequence[l]],c=a,d=0,s="r"+d+"c"+a;t.cellProperties[s]={IsHeader:!0,CellType:n.ObjectType.Group,OptionCode:null,ID:u.ID,GroupIndex:l,ClassName:"qGrid-cell qGrid-cell-head qGrid-group-cell qGrid-cell-border"},void 0==t.data[d]&&(t.data[d]=new Array(t.totalCols)),o&&(t.data[d][a]=u.Text[r.language],t.cell.push({row:d,col:a,className:"qGrid-cell qGrid-cell-head qGrid-group-cell qGrid-cell-border"}),d++,void 0==t.data[d]&&(t.data[d]=new Array(t.totalCols)));for(var p in u.VariableSequence){var b=e.Variables[u.VariableSequence[p]];switch(b.VariableType){case n.VariableType.SingleChoice:case n.VariableType.MultipleChoice:if("2"==b.Properties.ShowAs)t.data[d][a]=b.Text[r.language],t.cell.push({row:d,col:a,className:"qGrid-cell qGrid-cell-head qGrid-cell-header qGrid-border-bot"+(t.borderCols.indexOf(a)>-1?" qGrid-cell-border":"")}),s="r"+d+"c"+a,t.cellProperties[s]={IsHeader:!0,CellType:n.ObjectType.Variable,OptionCode:null,ID:b.ID,ParentID:u.ID,ClassName:"qGrid-cell qGrid-cell-head qGrid-cell-header qGrid-border-bot"+(t.borderCols.indexOf(a)>-1?" qGrid-cell-border":"")},a++;else for(var g in b.VariableLevelSequence){var v=b.VariableLevelSequence[g];if(v.IsOption){var f=a,m=b.Options[v.ID];e.QuestionType==n.QuestionType.Distribution2&&m.IsExclusive&&(f=t.totalCols-1),t.data[d][f]=m.Text[r.language],t.cell.push({row:d,col:f,className:"qGrid-cell qGrid-cell-head qGrid-cell-header qGrid-border-bot"+(t.borderCols.indexOf(a)>-1?" qGrid-cell-border":"")}),s="r"+d+"c"+f,t.cellProperties[s]={IsHeader:!0,CellType:n.ObjectType.Option,OptionCode:m.Code.toString(),ID:b.ID,OptionID:m.ID,ParentID:u.ID,ClassName:"qGrid-cell qGrid-cell-head qGrid-cell-header qGrid-border-bot"+(t.borderCols.indexOf(f)>-1?" qGrid-cell-border":"")},a++}}break;case n.VariableType.Text:case n.VariableType.Numeric:case n.VariableType.DateTime:t.data[d][a]=b.Text[r.language],t.cell.push({row:d,col:a,className:"qGrid-cell qGrid-cell-head qGrid-cell-header qGrid-border-bot"+(t.borderCols.indexOf(a)>-1?" qGrid-cell-border":"")}),s="r"+d+"c"+a,t.cellProperties[s]={IsHeader:!0,CellType:n.ObjectType.Variable,OptionCode:null,ID:b.ID,ParentID:u.ID,ClassName:"qGrid-cell qGrid-cell-head qGrid-cell-header qGrid-border-bot"+(t.borderCols.indexOf(a)>-1?" qGrid-cell-border":"")},a++}}o&&t.mergeCells.push({row:0,col:c,rowspan:1,colspan:a-c}),i=d}return i}(r.qObject,i),c=s+1,i.cell.push({row:s,col:0,className:"qGrid-cell qGrid-border-bot"})):(s=-1,l=!0),i.enableRightText&&i.cell.push({row:s,col:i.isNoAnsAdded?i.totalCols-2:i.totalCols-1,className:"qGrid-cell qGrid-border-bot qGrid-cell-head"}),i.isRowTotal&&(i.cell.push({row:s,col:i.totalCols-1,className:"qGrid-cell qGrid-border-bot qGrid-cell-head"}),i.data[s]=new Array(1),i.data[s][i.totalCols-1]="Total"),function(a,i,o){for(var s in a.QuestionLevelSequence){var l=a.QuestionLevelSequence[s],u="";if(i.data[o]=new Array(i.totalCols),l.ObjectType==n.ObjectType.AttributeHeader){i.data[o][0]=a.AttributeHeaders[l.ID].Text[r.language],i.cell.push({row:o,col:0,className:"qGrid-cell qGrid-cell-head qGrid-attribute-head-cell"});for(var d in i.borderCols)i.cell.push({row:o,col:i.borderCols[d],className:"qGrid-cell qGrid-cell-head qGrid-cell-border"});u="r"+o+"c0",o++,-1!=i.repeatPositions.indexOf(o)&&(i.data[o]=new Array(i.totalCols),e(i.data[c-1],c-1,o),o++),i.cellProperties[u]={IsHeader:!0,CellType:l.ObjectType,OptionCode:null,ID:l.ID,ClassName:"qGrid-cell qGrid-cell-head qGrid-attribute-head-cell"};for(var p in a.AttributeHeaders[l.ID].AttributeSequence){var b=a.Attributes[a.AttributeHeaders[l.ID].AttributeSequence[p]];t(a,b,o++,i,!0,l.ID),-1!=i.repeatPositions.indexOf(o)&&(i.data[o]=new Array(i.totalCols),e(i.data[c-1],c-1,o),o++)}}else{var b=a.Attributes[l.ID];t(a,b,o++,i,!1),-1!=i.repeatPositions.indexOf(o)&&(i.data[o]=new Array(i.totalCols),e(i.data[c-1],c-1,o),o++)}}}(r.qObject,i,++s),i.isColTotal){var d=1,p=1,s=i.data.length,b="";i.data[s]=new Array(i.totalCols),i.data[s][p-1]="Total",i.cell.push({row:s,col:0,className:"qGrid-cell qGrid-border-top qGrid-cell-head qGrid-cell-header"});for(var d;d<i.totalCols;d++)i.cell.push({row:s,col:p,className:"qGrid-cell qGrid-variable-cell qGrid-border-top"+(d==i.totalCols-1?" qGrid-cell-border":"")}),b="r"+s+"c"+p,i.cellProperties[b]={IsHeader:!0,CellType:n.ObjectType.Variable,OptionCode:null,ID:null,IsConstantSum:!0},p++}var g={data:i.data,rowHeaders:!1,colHeaders:!1,fillHandle:!1,renderAllRows:!0,disableVisualSelection:!0,readOnly:!0,mergeCells:i.mergeCells,cell:i.cell,cells:function(e,t,a){var o={},s="r"+e+"c"+t,u=r.Table.Info.cellProperties[s];if(u)if(u.IsHeader)u.IsConstantSum?o.renderer=r.Table.Renderers.NumericTotalRenderer:(o.renderer=r.Table.Renderers.HeaderRenderer,o.cellInfo=u,o.cellKey=s,o.IsRowTotal=i.isRowTotal,o.IsColumnTotal=i.isColTotal);else{var c=r.qObject.Variables[u.ID],d=c.Name+"o"+u.OptionCode;switch(c.VariableType){case n.VariableType.SingleChoice:o.renderer=r.Table.Renderers.SingleChoiceRenderer,o.variable=c,o.elemKey=d,o.cellInfo=u;break;case n.VariableType.MultipleChoice:o.renderer=r.Table.Renderers.MultiChoiceRenderer,o.variable=c,o.elemKey=d,o.cellInfo=u;break;case n.VariableType.Text:o.renderer=r.Table.Renderers.TextboxRenderer;break;case n.VariableType.Numeric:o.renderer=r.Table.Renderers.NumericRenderer,o.variable=c,o.IsRowTotal=i.isRowTotal,o.IsColumnTotal=i.isColTotal,o.isSlider=l;break;case n.VariableType.DateTime:o.renderer=r.Table.Renderers.DateTimeRenderer}}return o}};if(void 0!=r.Table.Info&&(r.Table.Info.cellProperties=i.cellProperties),r.Table.Callbacks)for(var v in r.Table.Callbacks)g[v]=r.Table.Callbacks[v];o.instance=new Handsontable(a[0],g),r.IsTableCompiled=!1}function l(){function e(e,t,a,i,o){var s=0,l="";if(o){i.data[s]=new Array(i.totalCols),i.cell.push({row:s,col:a,className:"qGrid-cell qGrid-border-bot"}),s++;for(var u in t.GroupSequence){var c=e.Groups[t.GroupSequence[u]];for(var d in c.VariableSequence){var p=e.Variables[c.VariableSequence[d]];switch(p.VariableType){case n.VariableType.SingleChoice:case n.VariableType.MultipleChoice:if("2"==p.Properties.ShowAs)i.data[s]=new Array(i.totalCols),i.data[s][a]=p.Text[r.language],i.cell.push({row:s,col:a,className:"qGrid-cell qGrid-cell-head qGrid-cell-header qGrid-cell-border qGrid-attribute-cell"}),l="r"+s+"c"+a,i.cellProperties[l]={IsHeader:!0,CellType:n.ObjectType.Variable,OptionCode:null,ID:p.ID,ParentID:c.ID,ClassName:"qGrid-cell qGrid-cell-head qGrid-cell-header qGrid-cell-border qGrid-attribute-cell"},s++;else for(var b in p.VariableLevelSequence){var g=p.VariableLevelSequence[b];if(g.IsOption){var v=p.Options[g.ID];i.data[s]=new Array(i.totalCols),i.data[s][a]=v.Text[r.language],i.cell.push({row:s,col:a,className:"qGrid-cell qGrid-cell-head qGrid-cell-border qGrid-attribute-cell"}),l="r"+s+"c"+a,i.cellProperties[l]={IsHeader:!0,CellType:n.ObjectType.Option,OptionCode:v.Code,ID:p.ID,ParentID:c.ID,ClassName:"qGrid-cell qGrid-cell-head qGrid-cell-border qGrid-attribute-cell"},s++,-1!=i.repeatPositions.indexOf(s)&&(i.data[s]=new Array(i.totalCols),i.cell.push({row:s++,col:0,className:"qGrid-cell qGrid-border-bot"}))}}break;case n.VariableType.Text:case n.VariableType.Numeric:case n.VariableType.DateTime:i.data[s]=new Array(i.totalCols),i.data[s][a]=p.Text[r.language],i.cell.push({row:s,col:a,className:"qGrid-cell qGrid-cell-head qGrid-border-bot qGrid-cell-border qGrid-attribute-cell"}),l="r"+s+"c"+a,i.cellProperties[l]={IsHeader:!0,CellType:n.ObjectType.Variable,OptionCode:null,ID:p.ID,ParentID:c.ID,ClassName:"qGrid-cell qGrid-cell-head  qGrid-border-bot qGrid-cell-border qGrid-attribute-cell"},s++,-1!=i.repeatPositions.indexOf(s)&&(i.data[s]=new Array(i.totalCols),i.cell.push({row:s++,col:0,className:"qGrid-cell qGrid-border-bot"}))}}}}else{s=0,i.data[s][a]=t.Text[r.language],i.cell.push({row:s,col:a,className:"qGrid-cell qGrid-cell-header qGrid-cell-head  qGrid-border-bot"}),l="r"+s+"c"+a,i.cellProperties[l]={IsHeader:!0,CellType:n.ObjectType.Attribute,OptionCode:null,ID:t.ID,ClassName:"qGrid-cell qGrid-cell-head qGrid-cell-header qGrid-border-bot"},s++;for(var u in t.GroupSequence){var c=e.Groups[t.GroupSequence[u]];for(var d in c.VariableSequence){var p=e.Variables[c.VariableSequence[d]];switch(p.VariableType){case n.VariableType.SingleChoice:case n.VariableType.MultipleChoice:if("2"==p.Properties.ShowAs)i.cell.push({row:s,col:a,className:"qGrid-cell qGrid-variable-cell"}),l="r"+s+"c"+a,i.cellProperties[l]={IsHeader:!1,CellType:n.ObjectType.Variable,OptionCode:null,ID:p.ID},s++;else for(var b in p.VariableLevelSequence){var g=p.VariableLevelSequence[b];if(g.IsOption){var v=p.Options[g.ID];i.cell.push({row:s,col:a,className:"qGrid-cell qGrid-option-cell"+(t.Media[r.language]||t.Media[r.DefaultLanguage]?" image-attribute ":"")}),l="r"+s+"c"+a,i.cellProperties[l]={IsHeader:!1,CellType:n.ObjectType.Option,OptionCode:v.Code.toString(),OptionID:v.ID,ID:p.ID},s++,-1!=i.repeatPositions.indexOf(s)&&(i.data[s][a]=t.Text[r.language],i.cell.push({row:s,col:a,className:"qGrid-cell qGrid-cell-header qGrid-cell-head  qGrid-border-bot"}),l="r"+s+"c"+a,i.cellProperties[l]=i.cellProperties["r0c"+a],s++)}}break;case n.VariableType.Text:case n.VariableType.Numeric:case n.VariableType.DateTime:i.cell.push({row:s,col:a,className:"qGrid-cell qGrid-variable-cell"}),l="r"+s+"c"+a,i.cellProperties[l]={IsHeader:!1,CellType:n.ObjectType.Variable,OptionCode:null,ID:p.ID},s++,-1!=i.repeatPositions.indexOf(s)&&(i.data[s][a]=t.Text[r.language],i.cell.push({row:s,col:a,className:"qGrid-cell qGrid-cell-header qGrid-cell-head  qGrid-border-bot"}),l="r"+s+"c"+a,i.cellProperties[l]=i.cellProperties["r0c"+a],s++)}}}}}var t={data:[],mergeCells:[],cellProperties:{},cell:[],borderCols:[],totalCols:1,totalRows:function(e,t){var r=0;for(var a in t.GroupSequence){var i=e.Groups[t.GroupSequence[a]];for(var o in i.VariableSequence){var s=e.Variables[i.VariableSequence[o]];switch(s.VariableType){case n.VariableType.SingleChoice:case n.VariableType.MultipleChoice:if("2"==s.Properties.ShowAs)r++;else for(var l in s.VariableLevelSequence){var u=s.VariableLevelSequence[l];u.IsOption&&r++}break;case n.VariableType.Text:case n.VariableType.Numeric:case n.VariableType.DateTime:r++}}}return r}(r.qObject,r.qObject.MasterAttribute),repeatHeader:"true"==r.qObject.Properties.RepeatHeader,repeatPositions:[],enableRightText:!1},i={instance:null,cellMap:null},o=0;t.repeatPositions=t.repeatHeader?u(t.totalRows):[],t.totalCols+=function(e){var t=0;for(var r in e.QuestionLevelSequence){var a=e.QuestionLevelSequence[r];if(a.ObjectType==n.ObjectType.AttributeHeader)for(var i in e.AttributeHeaders[a.ID].AttributeSequence)t++;t++}return t}(r.qObject),e(r.qObject,r.qObject.MasterAttribute,o++,t,!0);for(var s in r.qObject.QuestionLevelSequence){var l=r.qObject.QuestionLevelSequence[s];if(l.ObjectType==n.ObjectType.AttributeHeader)for(var c in r.qObject.AttributeHeaders[l.ID].AttributeSequence){var d=r.qObject.Attributes[r.qObject.AttributeHeaders[l.ID].AttributeSequence[c]];e(r.qObject,d,o++,t,!1)}else{var d=r.qObject.Attributes[l.ID];e(r.qObject,d,o++,t,!1)}}var p={data:t.data,rowHeaders:!1,colHeaders:!1,fillHandle:!1,renderAllRows:!0,disableVisualSelection:!0,readOnly:!0,mergeCells:t.mergeCells,cell:t.cell,cells:function(e,t,a){var i={},o="r"+e+"c"+t,s=r.Table.Info.cellProperties[o];if(s)if(s.IsHeader)i.renderer=r.Table.Renderers.HeaderRenderer,i.cellInfo=s,i.cellKey=o;else{var l=r.qObject.Variables[s.ID],u=l.Name+"o"+s.OptionCode;switch(l.VariableType){case n.VariableType.SingleChoice:i.renderer=r.Table.Renderers.SingleChoiceRenderer,i.variable=l,i.elemKey=u,i.cellInfo=s;break;case n.VariableType.MultipleChoice:i.renderer=r.Table.Renderers.MultiChoiceRenderer,i.variable=l,i.elemKey=u,i.cellInfo=s;break;case n.VariableType.Text:i.renderer=r.Table.Renderers.TextboxRenderer;break;case n.VariableType.Numeric:i.renderer=r.Table.Renderers.NumericRenderer,i.variable=l;break;case n.VariableType.DateTime:i.renderer=r.Table.Renderers.DateTimeRenderer}}return i}};if(void 0!=r.Table.Info&&(r.Table.Info.cellProperties=t.cellProperties),r.Table.Callbacks)for(var b in r.Table.Callbacks)p[b]=r.Table.Callbacks[b];i.instance=new Handsontable(a[0],p),r.IsTableCompiled=!1}function u(e){var t=[];if(e>5)var r=c(e,2);for(var n in r)t[n]||(t[n]=0),t[n]+=0==n?r[n]+1:t[n-1]+r[n]+1;return t}function c(e,t){var r=[];if(Math.ceil(e/t)>5)r=c(e,++t);else for(var n=0;n<t-1;n++)r.push(Math.ceil(e/t));return r}t(function(){"true"==r.qObject.Properties.Transpose?l():s(),e.$broadcast("table-drawn")}),r.FirstAttribute=r.qObject.MasterAttribute.ID,r.$on("IsDirty",function(){a.empty(),"true"==r.qObject.Properties.Transpose?l():s()})}return{link:a,replace:!0,restrict:"E"}}e.module("SurveyEngine").directive("surveyTable",["$rootScope","$timeout","$compile","SurveyEngine.Enums",t])}(angular),function(e){"use strict";function t(e,t,r,n,a){function i(e,t,r,n){e.CalculateWidth=function(e){return 100/e+"%"},e.GetFirstKey=function(e){return Object.keys(e)[0]},e.$evalAsync(function(){t.find("tbody>tr")})}function o(a){function i(n,i,o,s,l,u){var c="r"+i+"c"+o,d=a.Table.Info.cellProperties[c];if(d)if(d.IsHeader&&a.qObject.QuestionType!=e.QuestionType.Distribution){if(d.IsConstantSum)r(n)(a);else if(d.IsHeader&&a.qObject.Attributes[d.ID]&&a.qObject.Attributes[d.ID].IsOther){var p=a.qObject.Attributes[d.ID],b=a.qObject.Variables[p.OtherVariableID].Name;a.OtherAttributeAnswer[p.ID]=t.GetVariableAnswers(b),r(n)(a)}}else a.ChildScopes[d.ID]&&r(n)(a.ChildScopes[d.ID])}function o(t,r){var i="",o="",s="",l=null,u="";switch(t.CellType){case e.ObjectType.Group:l=t.ID,u=a.qObject.Groups[l].Text[a.language]||a.qObject.Groups[l].Text[a.DefaultLanguage];break;case e.ObjectType.AttributeHeader:l=t.ID,u=a.qObject.AttributeHeaders[l].Text[a.language]||a.qObject.AttributeHeaders[l].Text[a.DefaultLanguage];break;case e.ObjectType.Attribute:l=t.ID,u=a.qObject.Attributes[l].Text[a.language]||a.qObject.Attributes[l].Text[a.DefaultLanguage],(a.qObject.Attributes[l].Media[a.language]||a.qObject.Attributes[l].Media[a.DefaultLanguage])&&(o='<div style="display:block;text-align:left!important"><img src="'+(a.qObject.Attributes[l].Media[a.language]||a.qObject.Attributes[l].Media[a.DefaultLanguage])+'?dt={{ticks}}" style="max-height:100px;max-width:100px;"/></div>'),a.qObject.Attributes[l].IsOther&&(s='<input class="input-txt darkBdr" type="text" ng-blur="SaveOtherAttributeValue(\''+l+"','"+a.qObject.Attributes[l].OtherVariableID+"')\" ng-model=\"OtherAttributeAnswer['"+l+"']\">");break;case e.ObjectType.Variable:l=t.ID,u=a.qObject.Variables[l].Text[a.language]||a.qObject.Variables[l].Text[a.DefaultLanguage],(a.qObject.Variables[l].Media[a.language]||a.qObject.Variables[l].Media[a.DefaultLanguage])&&(o='<img src="'+(a.qObject.Variables[l].Media[a.language]||a.qObject.Variables[l].Media[a.DefaultLanguage])+'?dt={{ticks}}" style="max-height:100px;max-width:100px;"/>');break;case e.ObjectType.Option:var c=a.qObject.Variables[t.ID],d=c.Options[t.OptionCode];l=t.ID+"@"+t.OptionCode,u=d.Text[a.language]||d.Text[a.DefaultLanguage]}return u=n(u)(a),i=(""!=o?o:"")+'<span class="survey-option-text" style="display: block; text-align: center;">'+u+"</span>",""!=s&&(i+=s),i}function s(t,r,n,i,o,s,l){Handsontable.renderers.TextRenderer.apply(this,arguments);var u=l.variable,c=(l.elemKey,l.cellInfo.OptionID);if(r.style["text-align"]="-webkit-center","2"==u.Properties.ShowAs){if(jsrcb.browser.indexOf("Microsoft Internet Explorer")>=0)var d='<div class="custom-dropdown" ng-mouseleave="hideDrp()" ng-mouseenter="toggleDrp()" ><button ng-if="SelectedTextAnswer" ng-bind="SelectedTextAnswer" class="dropbtn survey-option-text"></button><button ng-if="!SelectedTextAnswer" class="dropbtn survey-option-text">Select</button><div id="myDropdown" class="dropdown-content show" style="text-align: left;" ng-show="sd.show"><ul class="marginZero paddingZero">';else var d='<select class="survey-option-text on-blur dropdown-qtable" ng-model="SelectedValues.single" ng-change="SaveAnswer(SelectedValues.single)">';for(var p in u.VariableLevelSequence)if(u.VariableLevelSequence[p].IsOption){var b=u.Options[u.VariableLevelSequence[p].ID],g=b.Text[a.language]||b.Text[a.DefaultLanguage];jsrcb.browser.indexOf("Microsoft Internet Explorer")>=0?d+='<li class="custom-dropdown-list padding-5" style="list-style: none; font-size: 14px; margin-top: 0px!important" ng-click="SaveAnswer('+b.Code+'); hideDrp()">'+g+"</li>":d+='<option class="opt ng-scope" value="'+b.Code+'">'+g+"</option>"}jsrcb.browser.indexOf("Microsoft Internet Explorer")>=0?d+="</ul></div></div>":d+="</select>",r.innerHTML=d}else if(a.qObject.QuestionType==e.QuestionType.Distribution){var d="<survey-stars ng-if='!variable.Options["+c+"].IsExclusive' ng-click='SaveAnswer("+parseInt(c)+")' class='pos-rel' ng-mouseenter='setHoverID("+c+")'  ng-mouseleave='removeHoverID()' option-id='"+c+"'></survey-stars>";d+='<div ng-if="variable.Options['+c+'].IsExclusive" class="noAnswer"><survey-option option-id="{{RatingQuestionConfig.ExclusiveID}}"></survey-option>',r.innerHTML=d}else{var b=u.Options[l.cellInfo.OptionID],v="";if(b.Media[a.language]||b.Media[a.DefaultLanguage]){
var f=(b.Media[a.language]||b.Media[a.DefaultLanguage])+"?dt="+(new Date).getTime();v='<label class="imageInput"> <input type="radio" ng-click="SaveAnswer(SelectedValues.single)" ng-model="SelectedValues.single" name="'+u.Name+'" value="'+l.cellInfo.OptionCode+'" /> <div class="input-img-mask CaptureImg" style="height:70px;width:70px;"> <img src="'+f+'" style="max-height:70px;max-width:70px;"/> <div class="image-select-ovelay"></div> </div> </label>'}else v='<label  class="form-radio display-block pos-rel" ><input type="radio"  ng-change="SaveAnswer(SelectedValues.single)" ng-model="SelectedValues.single" name="'+u.Name+'" value="'+l.cellInfo.OptionCode+'"/>                <i class="form-icon"></i>                 <span class="survey-option-text" ng-if="showOptionLabel && variable.Options[OptionId].Text[Language] != undefined" bind-html-compile="variable.Options[OptionId].Text[Language]"></span>                <span class="survey-option-text" ng-if="showOptionLabel && variable.Options[OptionId].Text[Language] == undefined" bind-html-compile="variable.Options[OptionId].Text[DefaultLanguage]"></span></label>';r.innerHTML=v}}function l(e,t,r,n,i,o,s){Handsontable.renderers.TextRenderer.apply(this,arguments);var l=s.variable,u=s.elemKey,c=l.Options[s.cellInfo.OptionID];if(t.style["text-align"]="-webkit-center",c.Media[a.language]||c.Media[a.DefaultLanguage]){var d=(c.Media[a.language]||c.Media[a.DefaultLanguage])+"?dt="+(new Date).getTime();t.innerHTML='<label class="imageInput" style="display: block"><input id="'+u+'" type="checkbox" name="'+l.Name+'" style="margin:0" ng-change="MultiSelectOptionsinGrid('+s.cellInfo.OptionCode+')" ng-model="SelectedValues['+s.cellInfo.OptionCode+']"/><div class="input-img-mask CaptureImg" style="height:70px;width:70px;"><img style="max-height:70px;max-width:70px;" onError="this.onerror=null;this.src=\'./Project/app/Components/SE/assets/images/default.jpg\';" src="'+d+'" /><div class="image-select-ovelay"></div></div></label>'}else t.innerHTML='<label class="form-checkbox" ><label class="check"><input id="'+u+'" type="checkbox" name="'+l.Name+'" style="margin:0" ng-change="MultiSelectOptionsinGrid('+s.cellInfo.OptionCode+')" ng-model="SelectedValues['+s.cellInfo.OptionCode+']"/> <i class="form-icon"></i>  </label></label>'}function u(e,t,r,n,i,o,s){Handsontable.renderers.TextRenderer.apply(this,arguments),t.style["text-align"]="-webkit-center";var l=s.variable;a.IsRowTotal=s.IsRowTotal,s.isSlider?(t.classList.remove("qGrid-cell-border"),t.innerHTML='<div class="sg-container"><rzslider rz-slider-model="answerInput" rz-slider-options="{floor:'+l.Properties.Min+", ceil:"+l.Properties.Max+", step:"+l.Properties.IncrementScaleBy+", onChange:OnValueChange("+l.Name+",answerInput,"+l.Properties.Max+')}"></rzslider></div>'):s.IsRowTotal||0==s.IsRowTotal&&0==s.IsColumnTotal?t.innerHTML='<span ng-if="variable.Properties.Prefix != \'\'" class="font-size survey-option-text" style="display:inline-block;float:left;width:25%">'+l.Properties.Prefix+'</span><input ng-model="SelectedValues.single" ng-change="SetDecimalPlaces(SelectedValues.single)" ng-blur="OnBlurSave(SelectedValues.single);addVariable('+r+')" ng-init="addVariable('+r+')" class="input-txt survey-option-text paddingZero font-size" style="width: 50%;" ng-class="{\'floatLeft\':variable.Properties.Prefix != \'\' || variable.Properties.Suffix != \'\'}" type="number"/><span ng-if="variable.Properties.Suffix != \'\'" class="font-size survey-option-text" style="display:inline-block;float:right;width:23%">'+l.Properties.Suffix+'</span><span class="error font-size-sm" ng-if="!valid && ((variable.Properties.Min && SelectedValues.single < variable.Properties.Min) || (variable.Properties.Max && SelectedValues.single > variable.Properties.Max))">(Min: '+l.Properties.Min+", Max: "+l.Properties.Max+")</span>":t.innerHTML='<span ng-if="variable.Properties.Prefix != \'\'" class="font-size survey-option-text" style="display:inline-block;float:left;width:25%">'+l.Properties.Prefix+'</span><input ng-model="SelectedValues.single" ng-change="SetDecimalPlaces(SelectedValues.single)" ng-blur="OnBlurSave(SelectedValues.single);addVariable('+n+')" ng-init="addVariable('+n+')" class="input-txt survey-option-text paddingZero font-size" style="width: 50%;" ng-class="{\'floatLeft\':variable.Properties.Prefix != \'\' || variable.Properties.Suffix != \'\'}" type="number"/><span ng-if="variable.Properties.Suffix != \'\'" class="font-size survey-option-text" style="display:inline-block;float:right;width:23%">'+l.Properties.Suffix+"</span>"}function c(e,t,r,n,a,i,o){Handsontable.renderers.TextRenderer.apply(this,arguments),t.style["text-align"]="-webkit-center",t.innerHTML='<input ng-model="SelectedValues.single" ng-blur="OnBlurSave(SelectedValues.single)"   maxlength="{{variable.Properties.Max}}" style="width: 98%;" class="input-txt survey-option-text paddingZero" type="text"/>'}function d(e,t,r,n,a,i,o){Handsontable.renderers.DateRenderer.apply(this,arguments),t.style["text-align"]="-webkit-center",t.innerHTML='<input ng-model="answerInput" ng-blur="SaveAnswer(answerInput)" style="width: 90%" class="input-txt" type="date"/>'}function p(e,t,r,n,i,o,s){Handsontable.renderers.TextRenderer.apply(this,arguments),t.style["text-align"]="-webkit-center",a.IsRowTotal?t.innerHTML='<span style="visibility:hidden" class="font-size survey-option-text">$</span><input readonly ng-value="Total.sum['+r+']" style="width: 98%;" class="total-values input-txt survey-option-text paddingZero" type="number"/>':t.innerHTML='<span style="visibility:hidden" class="font-size survey-option-text">$</span><input readonly ng-class="{\'color-green\':Total.conditionMet['+n+']}" ng-value="Total.sum['+n+']" style="width: 98%;" class="total-values input-txt survey-option-text paddingZero" type="number"/>'}function b(e,t,r,n,a,i,s){Handsontable.renderers.TextRenderer.apply(this,arguments),t.style["text-align"]="-webkit-center",s.cellInfo.ClassName&&(t.className=s.cellInfo.ClassName),t.innerHTML=o(s.cellInfo,s.cellKey)}a.ChildScopes={},a.GridAnswer={Single:""},a.Table={Callbacks:{},Info:{},Renderers:{}},a.Table.Callbacks={afterRenderer:i},a.Table.Renderers={SingleChoiceRenderer:s,MultiChoiceRenderer:l,NumericRenderer:u,TextboxRenderer:c,HeaderRenderer:b,NumericTotalRenderer:p,DateTimeRenderer:d},a.r=window.r;a.GridData={head:[],row:[]},a.QuestionType=a.qObject.QuestionType,a.TotalBox=a.qObject.Properties.Total?a.qObject.Properties.Total:"None",a.ShowAs=a.qObject.Properties.ShowAs}return{link:i,controller:["$scope",o],restrict:"E",replace:!0,template:a.get("grid.v2.html")}}e.module("SurveyEngine").directive("surveyGrid",["SurveyEngine.Enums","SurveyEngine.RespondentService","$compile","$interpolate","$templateCache",t])}(angular),function(e){"use strict";function t(e,t,r){function n(e,t,r,n){e.answers=[];var a=n[1];e.SaveAnswer=function(t,r,n,i){e.answers=[],e.SelectedValues.single[t]=i;for(var o in e.SelectedValues.single)if(o!=t&&e.SelectedValues.single[o]==i){e.SelectedValues.single[o]=0;var s=[];a.SaveAnswer(e.qObject.Variables[o].Name,e.qObject.Variables[o].VariableType,s,!0,!0)}void 0==e.SelectedValues.single[t]&&null==e.SelectedValues.single[t]||(e.answers.push(e.SelectedValues.single[t]),a.SaveAnswer(r,n,e.answers,!0,!0))}}function a(r){r.ticks=(new Date).getTime(),r.SelectedValues={single:{}};var n=new Array(3);r.GridData={head:[],row:[]},r.SelectedValues={single:{}},r.PopulateAnswer=function(e){var n=t.GetVariableAnswers(e.Name);n&&0!=n.length&&(r.SelectedValues.single[e.ID]=n[0].toString())},r.GridData.head.push(n),function(){for(var t in r.qObject.QuestionLevelSequence){var a=r.qObject.QuestionLevelSequence[t];switch(a.ObjectType){case e.ObjectType.AttributeHeader:var i=new Array(3);i[1]={Id:a.ID,Property:"AttributeHeaders"};for(var o in r.qObject.AttributeHeaders[a.ID].AttributeSequence){var s=r.qObject.Attributes[r.qObject.AttributeHeaders[a.ID].AttributeSequence[o]],l=new Array(3);l[1]={Id:s.ID,Property:"Attributes",InGroup:!0,HeaderId:a.ID,IsLastVariable:!0};for(var u in s.GroupSequence){var c=r.qObject.Groups[s.GroupSequence[u]],d=r.qObject.Variables[c.VariableSequence[0]];r.PopulateAnswer(d);for(var p=0;p<2;p++){var b=d.Options[d.VariableLevelSequence[p].ID];0==t&&0==o&&(n[2*p]={Id:b.Code.toString(),Type:"text",Property:"none",Text:b.Text[r.language],Media:b.Media[r.language]}),l[2*p]={Id:b.Code.toString(),Type:"radio",Property:"none",parentId:d.ID}}}0==o&&r.GridData.row.push(i),0==o&&0==t&&(r.FirstAttribute=s.ID),r.GridData.row.push(l)}break;case e.ObjectType.Attribute:var s=r.qObject.Attributes[a.ID],l=new Array(3);l[1]={Id:s.ID,Property:"Attributes",InGroup:!1,HeaderId:null,IsLastVariable:!0};for(var u in s.GroupSequence){var c=r.qObject.Groups[s.GroupSequence[u]],d=r.qObject.Variables[c.VariableSequence[0]];r.PopulateAnswer(d);for(var p=0;p<2;p++){var b=d.Options[d.VariableLevelSequence[p].ID];0==t&&(n[2*p]={Id:b.Code.toString(),Type:"text",Property:"none",Text:b.Text[r.language],Media:b.Media[r.language]}),l[2*p]={Id:b.Code.toString(),Type:"radio",Property:"none",parentId:d.ID}}}r.GridData.row.push(l)}}}()}return{link:n,controller:["$scope",a],require:["surveyMaxdiff","^surveyQuestion"],restrict:"E",replace:!0,template:r.get("maxdiff.html")}}e.module("SurveyEngine").directive("surveyMaxdiff",["SurveyEngine.Enums","SurveyEngine.RespondentService","$templateCache",t])}(angular),function(e){"use strict";function t(e,t,r,n,a,i){function o(o,s,l,u,c){function d(e){document.getElementById(e).classList.add("hover")}function p(e){e&&e.classList.remove("hover")}function b(t){switch(B.qObject.QuestionType){case e.QuestionType.NPS:P(o.variable.Name,o.variable.VariableType,t);break;default:o.variable.VariableType==e.VariableType.MultipleChoice?o.multiSelectOption(!0,t):o.SaveAnswer(t)}}function g(t){switch(B.qObject.QuestionType){case e.QuestionType.NPS:n.TOGGLE_BUTTON=!0,P(o.variable.Name,o.variable.VariableType,t)}}function v(t){var a=Q.getElementsByClassName("date"),i=Q.getElementsByClassName("focusable"),s=Array.prototype.slice.call(i),l=Q.getElementsByClassName("hover")[0]||document.getElementById(o.SelectedValues.single)||0,u=s.indexOf(l),c=-1;switch(i.length>0&&t){case n.Direction.LEFT:c=u>-1?0==u?i.length-1:u-1:i.length-1;break;case n.Direction.RIGHT:c=u>-1?u+1==i.length?0:u+1:0}a.length>0&&a[0].focus(),c>-1&&(B.qObject.QuestionType==e.QuestionType.Stars&&r(function(){o.hover.hoverID=parseInt(i[c].getAttribute("option-id"))}),l&&l.classList.remove("hover"),i[c].classList.add("hover"))}function f(){var t=!1;B.shouldShiftFocus=!1;var r=Q.getElementsByClassName("hover")[0];if(r){var n=r.getAttribute("id");if(null!=n&&void 0!=n&&""!=n){var a=o.variable.Options[n];t=o.variable.Options[n].IsOther,o.variable.VariableType==e.VariableType.MultipleChoice&&(B.shouldShiftFocus=t),b(a.Code)}t&&h(),r.classList.remove("hover")}else if(o.variable.VariableType==e.VariableType.DateTime)O();else if(o.variable.Properties.ShowAs==e.ShowAsProperty.MultiLine){var i=Q.getElementsByTagName("textarea")[0];i&&m(i)}else y()}function m(e){e.style.height="initial";var t;e.rows=3,e.baseScrollHeight||(e.baseScrollHeight=e.scrollHeight),t=Math.ceil((e.scrollHeight-e.baseScrollHeight)/20),e.rows=3+t}function S(){var t=Q.getElementsByClassName("hover")[0];if(t){n.TOGGLE_BUTTON=!0;var r=t.getAttribute("id");if(null!=r&&void 0!=r&&""!=r){var a=o.variable.Options[r];B.qObject.QuestionType==e.QuestionType.NPS?o.answers.hasItem(a.Code)?(T(a.Code),t.classList.remove("nps-background")):P(o.variable.Name,o.variable.VariableType,a.Code):o.variable.VariableType!=e.VariableType.SingleChoice&&o.variable.VariableType!=e.VariableType.MultipleChoice||(o.answers.hasItem(a.Code)?(o.RemoveAnswer(a.Code),o.hover.hoverID=void 0):o.variable.VariableType==e.VariableType.MultipleChoice?o.multiSelectOption(!0,a.Code):o.SaveAnswer(a.Code),h())}}}function h(){r(function(){var e=Q.querySelectorAll(".focusableInput:not(.ng-hide)");e.length>0&&e[0].focus()})}function y(){r(function(){var e=Q.querySelectorAll(".focusableInput:not(.ng-hide)")[0];e&&(n.IS_BLUR_EVENT=!0,e.blur())})}function O(){r(function(){var e=Q.querySelectorAll(".date:not(.ng-hide)")[0];e&&(n.IS_BLUR_EVENT=!0,e.blur())})}function T(){o.answers.length=0,o.SelectedValues.hasOwnProperty("single")&&delete o.SelectedValues.single,B.SaveAnswer(o.variable.Name,o.variable.VariableType,o.answers,!1);var e=B.qObject.Variables[B.qObject.QuestionLevelSequence[1].ID];B.SaveAnswer(e.Name,e.VariableType,[],!1)}function w(e){var t,r=[];t=new Date(e),r[0]=t.getFullYear().toString(),r[1]=(t.getMonth()+1).toString(),r[2]=t.getDate().toString();for(var n in r)1==r[n].length&&(r[n]=0+r[n]);return r[0]+"-"+r[1]+"-"+r[2]}function I(e){var t;if(""!=e)return t=o.showFallBackDate?new Date(e):e,t.setHours(12),t.toISOString()}function A(e,t,r,n){t&&x(t)}function V(e){if(1==o.SelectedValues[e]){if(o.ExclusiveCodes.indexOf(e)>-1){for(var t in o.SelectedValues)t!=e&&(o.SelectedValues[t]=!1);o.RemoveAllAnswers()}else for(var r=0;r<o.ExclusiveCodes.length;r++)o.RemoveAnswer(o.ExclusiveCodes[r]),o.SelectedValues[o.ExclusiveCodes[r]]=!1;o.SaveAnswer(e)}else o.RemoveAnswer(e)}function C(e){o.SelectedValues.single=e,null==o.SelectedValues.single&&void 0==o.SelectedValues.single&&""==o.SelectedValues.single||o.SaveAnswer(o.SelectedValues.single)}function x(){var t=Array.prototype.slice.call(arguments),n=t[0],a=t[1]||o.variable.Name,s=t[2]||o.variable.VariableType,l=t[3],u=t[4],c=o.ExclusiveAcrossRowsCodes.length>0&&o.ExclusiveAcrossRowsCodes.indexOf(parseInt(n))>-1;if(n||s!=e.VariableType.SingleChoice&&s!=e.VariableType.MultipleChoice||(n=o.SelectedValues.single),s==e.VariableType.MultipleChoice||l||o.RemoveAllAnswers(),i.IsNotNullOrEmpty(n)||(i.IsDataValid=!0),l){var d=B.getVariableFromName(a);if(d){var p=Array.isArray(n)?n:[n];i.IsDataValid=i.ContainsValidData(d,p),i.IsDataValid?(o.valid=!0,B.SaveAnswer(a,s,p,l,c,o.ExclusiveAcrossRowsCodes)):(o.valid=!1,i.MakeBorderRed(o.variable.Name),i.ShakeMe())}}else if(i.IsNotNullOrEmpty(n)){switch(o.variable.VariableType){case e.VariableType.SingleChoice:o.SelectedValues.single=n,o.answers.length=0,o.answers.push(n),o.variable.Options[n]&&(o.filter.input=o.variable.Options[n].Text[o.Language]||o.variable.Options[n].Text[o.DefaultLanguage]),jsrcb.browser.indexOf("Microsoft Internet Explorer")>=0&&o.variable.VariableType==e.VariableType.SingleChoice&&o.variable.Options[n]&&(o.SelectedTextAnswer=o.variable.Options[n].Text[o.Language]),1==o.answers.length&&(r(E),L(n));break;case e.VariableType.MultipleChoice:o.answers.hasItem(n)||o.answers.push(n),o.answers.length>0&&r(E);break;case e.VariableType.Text:o.answers.length=0,o.answers.push(n);break;case e.VariableType.Numeric:o.answers.length=0,n="NoDecimal"==o.variable.Properties.Decimal?parseFloat(n).toFixed():parseFloat(n).toFixed(parseInt(o.variable.Properties.DecimalPlacesCount)),o.answers.push(n);break;case e.VariableType.DateTime:o.answers.length=0,o.answers.push(I(n))}i.IsDataValid=i.ContainsValidData(o.variable,o.answers),i.IsDataValid?(o.valid=!0,i.RemoveBorderRed(o.variable.Name),B.SaveAnswer(o.variable.Name,o.variable.VariableType,o.answers,l,c,o.ExclusiveAcrossRowsCodes,u)):(o.valid=!1,i.MakeBorderRed(o.variable.Name),i.ShakeMe())}o.sd.show=!1}function q(e){n.IS_BLUR_EVENT=!n.IS_BLUR_EVENT,x(e),n.IS_BLUR_EVENT=!1}function P(t,r,n){if(o.RemoveAllAnswers(),o.answers.length=0,o.answers.push(n),o.SelectedValues.single=n,o.NPSAnswer=n,i.ContainsValidData(o.variable,o.answers)){B.SaveAnswer(t,r,o.answers,!1);var a=B.qObject.Variables[B.qObject.QuestionLevelSequence[1].ID];n>=0&&n<=6?B.SaveAnswer(a.Name,a.VariableType,e.NPS.Detractor,!1):7==n||8==n?B.SaveAnswer(a.Name,a.VariableType,e.NPS.Passive,!1):B.SaveAnswer(a.Name,a.VariableType,e.NPS.Promoter,!1)}}function D(e,t,r){for(var n,a=t[0][e-1],i=0;i<a.VariableLevelSequence.length;i++)if(r.AnalysisText[o.Language]==a.Options[a.VariableLevelSequence[i].ID].Text[o.Language]){n=a.Options[a.VariableLevelSequence[i].ID].Code;break}t[0][e-1]&&o.SaveAnswer(n,t[0][e-1].Name,1,!0,!0)}function L(e){for(var t in o.variable.VariableLevelSequence){var r=parseInt(o.variable.VariableLevelSequence[t].ID);o.IsSelected[r]=!1,r==e&&(o.IsSelected[r]=!0)}}function j(){for(var r=[],a=0;a<o.variable.VariableLevelSequence.length;a++)if(o.variable.VariableLevelSequence[a].IsOption){var i=o.variable.VariableLevelSequence[a].ID,s=o.variable.Options[i].Code;r.push(s)}else for(var l=o.variable.VariableLevelSequence[a].ID,u=0;u<o.variable.OptionGroups[l].OptionSequence.length;u++){var i=o.variable.OptionGroups[l].OptionSequence[u],s=o.variable.Options[i].Code;r.push(s)}if(B.qObject.QuestionType==e.QuestionType.NPS){r=[];for(var c=B.qObject.Variables[B.qObject.QuestionLevelSequence[1].ID],a=0;a<c.VariableLevelSequence.length;a++){var i=c.VariableLevelSequence[a].ID,s=c.Options[i].Code;r.push(s)}t.SetDisplayedValues(c.Name,c.VariableType,B.qObject.ID,r),n.setListener=P}else n.setListener=x,t.SetDisplayedValues(o.variable.Name,o.variable.VariableType,B.qObject.ID,r);n.focusListener=v,n.submit=f,n.toggleSelection=S,n.numKeyListener=g}function k(e){if(1==o.variable.VariableType)e.Answers.getIndexOf(o.SelectedValues.single)>-1&&(o.SelectedValues.single="");else if(2==o.variable.VariableType){o.answers=[];for(var t in o.SelectedValues)e.Answers.getIndexOf(t)>-1&&(o.SelectedValues[t]=!1),o.SelectedValues[t]&&o.answers.push(t)}else 4!=o.variable.VariableType&&3!=o.variable.VariableType||(o.answerInput=void 0,o.SelectedValues.single=void 0)}function G(){o.answers.length=0,B.SaveAnswer(o.variable.Name,o.variable.VariableType,o.answers)}function M(){var r=o.answers;if(r&&r.length>0)switch(o.variable.VariableType){case 1:if(B.qObject.QuestionType==e.QuestionType.NPS)o.NPSAnswer=t.GetVariableAnswers(o.variable.Name);else if(B.qObject.QuestionType!=e.QuestionType.Stars&&B.qObject.QuestionType!=e.QuestionType.Distribution||"7"!=o.variable.Properties.ShapeType&&"7"!=B.qObject.Properties.ShapeType){o.SelectedValues.single=r[0].toString(),o.variable.Options[o.SelectedValues.single]&&(o.filter.input=o.variable.Options[o.SelectedValues.single].Text[o.Language]||o.variable.Options[o.SelectedValues.single].Text[o.DefaultLanguage]),jsrcb.browser.indexOf("Microsoft Internet Explorer")>=0&&(o.SelectedTextAnswer=o.variable.Options[r[0]].Text[o.Language]),B.qObject.QuestionType==e.QuestionType.Stars&&.5==B.qObject.Properties.IncrementBy&&(o.SelectedValues.single/=2);for(var n in o.variable.Options)if(r.hasItem(n)||1!=o.variable.Options[n].IsOther||o.maskOtherVariable(n),1==o.variable.Options[n].IsOther){var a=B.GetOtherVariableName(o.variable.Options[n].OtherVariableID),i=t.GetVariableAnswers(a),s=o.GetOtherVariableType(o.variable.Options[n].OtherVariableID);o.OtherAnswer.Value[o.variable.Options[n].Code]=s==e.VariableType.Numeric?parseInt(i):i}}else L(r[0]),o.SelectedValues.single=r[0].toString();break;case 2:if("multiselectbox"==o.displayType)for(var l in r)o.data.SelectedValues.push(r[l].toString());else for(var l in o.variable.Options)if(r.hasItem(l)?o.SelectedValues[l]=!0:1==o.variable.Options[l].IsOther&&o.maskOtherVariable(l),1==o.variable.Options[l].IsOther){var a=B.GetOtherVariableName(o.variable.Options[l].OtherVariableID),i=t.GetVariableAnswers(a);o.OtherAnswer.Value[o.variable.Options[l].Code]=i}break;case 4:o.answerInput=parseFloat(r[0]),o.SelectedValues.single=parseFloat(r[0]);break;case 5:if(o.showFallBackDate){var u=w(r[0]);o.dateAnswer.answerInput=u}else{var c=new Date(r[0]);o.answerInput=c}break;default:o.answerInput=r[0],o.SelectedValues.single=r[0]}else if(o.defaultOptionCode.length>0)switch(o.variable.VariableType){case 1:o.SelectedValues.single=o.defaultOptionCode[0].toString(),o.SaveAnswer(o.defaultOptionCode[0]);break;case 2:if("multiselectbox"==o.displayType)for(var l in o.defaultOptionCode)o.data.SelectedValues.push(o.defaultOptionCode[l].toString()),o.SaveAnswer(o.defaultOptionCode[l]);else for(var l in o.defaultOptionCode)o.SelectedValues[o.defaultOptionCode[l]]=!0,o.SaveAnswer(o.defaultOptionCode[l])}else B.qObject.Properties.DefaultValue&&o.variable.VariableType==e.VariableType.Numeric&&(o.SaveAnswer(parseFloat(B.qObject.Properties.DefaultValue),null,null,null,!0),o.SelectedValues.single=parseFloat(B.qObject.Properties.DefaultValue))}function N(){for(var e in o.variable.Options){var t=o.variable.Options[e];t.IsExclusive&&o.ExclusiveCodes.push(t.Code),t.IsDefault&&o.defaultOptionCode.push(t.Code),t.IsExclusiveAcrossRows&&o.ExclusiveAcrossRowsCodes.push(t.Code)}}function E(){var e=document.getElementById("blinkingHint"),t=document.getElementsByClassName("sq-container")[0];e&&(e.classList.contains("manyOption")||(e.classList.add("manyOption"),t.scrollIntoView()))}var Q=s[0];o.isMobileDevice=window.jsrcb.isMobile,o.Language="",o.valid=!0,o.showFallBackDate=!1,o.ExclusiveCodes=[],o.defaultOptionCode=[],o.ExclusiveAcrossRowsCodes=[],o.IsSelected=[],o.Hints=a.GetHints(),o.Placeholders=a.GetPlaceholders(),o.Buttons=a.GetButtons(),o.RatingQuestionConfig={},o.hover={},o.OtherVariableType={};var R=u[0],B=u[1];if(o.VerifiedQuestionOTPMap=i.VerifiedQuestionOTPMap,o.qID=B.qObject.ID,B){o.MultiSelectOptionsinGrid=V,o.SaveSingleChoiceGridAnswer=C;var H=o.variable.Properties.ShowAs;if(o.MaxChoices=parseInt(B.qObject.Properties.MaxChoices),o.MinChoices=parseInt(B.qObject.Properties.MinChoices),void 0!=H)switch(H.toString()){case e.ShowAsProperty.Radio.toString():o.displayType="radio";break;case e.ShowAsProperty.DropBox.toString():o.displayType="dropdown";break;case e.ShowAsProperty.SelectBox.toString():o.displayType="selectbox";break;case e.ShowAsProperty.MultiSelectBox.toString():o.displayType="multiselectbox";break;case e.ShowAsProperty.SingleSelectImage.toString():o.displayType="singleselectimage";break;case e.ShowAsProperty.MultipleSelectImage.toString():o.displayType="multipleselectimage";break;case e.ShowAsProperty.SingleSelectLonglist.toString():case e.ShowAsProperty.MultiSelectLonglist.toString():o.displayType="longlist"}if(o.variable.VariableType==e.VariableType.DateTime&&(o.variable.Properties.StartDate&&(o.variable.Properties.StartDate=new Date(new Date(o.variable.Properties.StartDate).setHours(12)),o.localStartDateString=o.variable.Properties.StartDate.toLocaleDateString()),o.variable.Properties.EndDate&&(o.variable.Properties.EndDate=new Date(new Date(o.variable.Properties.EndDate).setHours(12)),o.localEndDateString=o.variable.Properties.EndDate.toLocaleDateString())),j(),o.answers=t.GetVariableAnswers(o.variable.Name),o.SelectedValues={single:o.answers[0]},o.SaveAnswer=x,o.RemoveAllAnswers=G,o.findSpecialCodes=N,o.populateAnswers=M,o.SaveNPSAnswer=P,o.SaveRankAnswer=D,o.ShowSelectedSmiley=L,o.OnValueChange=A,o.OnBlurSave=q,R.ParentCtrl=u[1],o.Language=R.ParentCtrl.Language,o.DefaultLanguage=R.ParentCtrl.DefaultLanguage,o.TotalBox=o.$parent.TotalBox,o.answerInputDate="",o.Placeholder=function(){var t="";return o.variable.VariableType==e.VariableType.Numeric?o.variable.Properties.Min&&o.variable.Properties.Max&&(o.Placeholders.NumberBetween[o.Language]||o.Placeholders.NumberBetween[o.DefaultLanguage])?t=(o.Placeholders.NumberBetween[o.Language]||o.Placeholders.NumberBetween[o.DefaultLanguage])+" "+o.variable.Properties.Min+" - "+o.variable.Properties.Max:o.variable.Properties.Min&&(o.Placeholders.NumberMin[o.Language]||o.Placeholders.NumberMin[o.DefaultLanguage])?t=(o.Placeholders.NumberMin[o.Language]||o.Placeholders.NumberMin[o.DefaultLanguage])+" "+o.variable.Properties.Min:o.variable.Properties.Max&&(o.Placeholders.NumberMax[o.Language]||o.Placeholders.NumberMax[o.DefaultLanguage])&&(t=(o.Placeholders.NumberMax[o.Language]||o.Placeholders.NumberMax[o.DefaultLanguage])+" "+o.variable.Properties.Max):o.variable.VariableType==e.VariableType.Text&&(o.variable.Properties.RegexExample?t=o.variable.Properties.RegexExample:o.variable.Properties.Min&&o.variable.Properties.Max&&(o.Placeholders.TextBetween[o.Language]||o.Placeholders.TextBetween[o.DefaultLanguage])?(t=(o.Placeholders.TextBetween[o.Language]||o.Placeholders.TextBetween[o.DefaultLanguage]).replace("_",o.variable.Properties.Min),t=t.replace("_",o.variable.Properties.Max)):t=o.variable.Properties.Min&&(o.Placeholders.TextMin[o.Language]||o.Placeholders.TextMin[o.DefaultLanguage])?(o.Placeholders.TextMin[o.Language]||o.Placeholders.TextMin[o.DefaultLanguage]).replace("_",o.variable.Properties.Min):o.variable.Properties.Max&&(o.Placeholders.TextMax[o.Language]||o.Placeholders.TextMax[o.DefaultLanguage])?(o.Placeholders.TextMax[o.Language]||o.Placeholders.TextMax[o.DefaultLanguage]).replace("_",o.variable.Properties.Max):o.Placeholders.Text[o.Language]||o.Placeholders.Text[o.DefaultLanguage]),t}(),B.qObject.QuestionType==e.QuestionType.LikeDislike)for(var F in o.variable.Options){var U=o.variable.Options[F];"like"!=U.AnalysisText["en-us"].toLowerCase()&&"like"!=U.Text["en-us"].toLowerCase()||(o.likeOptionCode=U.Code),"dislike"!=U.AnalysisText["en-us"].toLowerCase()&&"dislike"!=U.Text["en-us"].toLowerCase()||(o.dislikeOptionCode=U.Code)}if(B.qObject.QuestionType==e.QuestionType.Stars||B.qObject.QuestionType==e.QuestionType.Distribution||B.qObject.QuestionType==e.QuestionType.NPS){B.qObject.Properties.ShapeType?o.RatingQuestionConfig.ShapeType=B.qObject.Properties.ShapeType:o.variable.Properties.ShapeType?o.RatingQuestionConfig.ShapeType=o.variable.Properties.ShapeType:B.qObject.QuestionType!=e.QuestionType.Stars&&B.qObject.QuestionType!=e.QuestionType.Distribution||(o.RatingQuestionConfig.ShapeType="1"),o.RatingQuestionConfig.ShowLabels=B.qObject.Properties.ShowLabels,o.RatingQuestionConfig.StarBeforeSelection=B.qObject.Properties.StarBeforeSelection,o.RatingQuestionConfig.StarAfterSelection=B.qObject.Properties.StarAfterSelection,o.RatingQuestionConfig.Properties=B.qObject.Properties;var _=o.variable.VariableLevelSequence.filter(function(e){return o.variable.Options[e.ID].IsExclusive});_.length&&(o.RatingQuestionConfig.ExclusiveID=_[0].ID),B.qObject.LeftLabel&&(o.RatingQuestionConfig.LeftLabel=B.qObject.LeftLabel[o.Language]||B.qObject.LeftLabel[o.DefaultLanguage],o.RatingQuestionConfig.MidLabel=B.qObject.MidLabel[o.Language]||B.qObject.MidLabel[o.DefaultLanguage],o.RatingQuestionConfig.RightLabel=B.qObject.RightLabel[o.Language]||B.qObject.RightLabel[o.DefaultLanguage])}o.setHoverID=function(e){o.hover.hoverID=parseInt(e)},o.removeHoverID=function(){o.hover.hoverID=void 0},3!=o.variable.VariableType&&4!=o.variable.VariableType||(o.HideOkButton=B.qObject.Properties.HideOkButton||"false"),2==B.qObject.QuestionType&&(o.HideHint=B.qObject.Properties.HideHint),r(function(){if(5==o.variable.VariableType){var e=document.getElementsByClassName("date");for(var t in e){"text"==e[t].type&&(o.showFallBackDate=!0)}}},0),r(o.findSpecialCodes,0),r(o.populateAnswers,0);for(var z=0;z<o.variable.VariableLevelSequence;z++)o.IsSelected=!1;o.dateAnswer={answerInput:""},o.sd={show:!1},o.toggleDrp=function(){o.sd.show=!0},o.hideDrp=function(){o.sd.show=!1},o.addVariable=function(e){void 0==o.$parent.rowVariables[e]&&(o.$parent.rowVariables[e]=[]),o.$parent.rowVariables[e].indexOf(o.variable.Name)<0&&o.$parent.rowVariables[e].push(o.variable.Name),o.$parent.Total.sum[e]=0;for(var r in o.$parent.rowVariables[e]){var n=t.GetVariableAnswers(o.$parent.rowVariables[e][r]);null!=n[0]&&(o.$parent.Total.sum[e]+=parseFloat(n[0]))}o.$parent.validateTotal()},o.RemoveAnswer=function(e){for(var t=0;t<o.answers.length;t++)o.answers[t]=parseInt(o.answers[t]);var r=o.answers.indexOf(e);r>-1&&(o.answers.splice(r,1),o.SelectedValues.hasOwnProperty("single")&&delete o.SelectedValues.single,o.SelectedValues.hasOwnProperty(e)&&(o.SelectedValues[e]=!1),o.IsSelected.hasOwnProperty(e)&&(o.IsSelected[e]=!1),o.maskOtherVariable(e),B.SaveAnswer(o.variable.Name,o.variable.VariableType,o.answers))},o.saveOtherValue=function(e){o.otherVariableType=o.GetOtherVariableType(e.OtherVariableID);var t=o.GetOtherVariableName(e.OtherVariableID);o.SaveAnswer(o.OtherAnswer.Value[e.Code],t,o.otherVariableType,!0)},o.GetVariableAnswers=function(e){return t.GetVariableAnswers(e)},o.GetOtherVariableName=function(e){return B.GetOtherVariableName(e)},o.GetOtherVariableType=function(e){return B.GetOtherVariableType(e)},j(),c(o,function(e){s.append(e)}),B.qObject.Properties.hasOwnProperty("MobileFriendly")||(B.qObject.Properties.MobileFriendly="false"),B.qObject.QuestionType!=e.QuestionType.SimpleGrid&&B.qObject.QuestionType!=e.QuestionType.ComplexGrid&&B.qObject.QuestionType!=e.QuestionType.NumericGrid&&B.qObject.QuestionType!=e.QuestionType.TextGrid&&B.qObject.QuestionType!=e.QuestionType.Distribution&&B.qObject.QuestionType!=e.QuestionType.Distribution2&&B.qObject.QuestionType!=e.QuestionType.Slider||"false"!=B.qObject.Properties.MobileFriendly||o.$parent.ChildScopes&&(o.$parent.ChildScopes[o.variable.ID]=o),r(function(){window.jsrcb.isMobile||o.variable.VariableType!=e.VariableType.Text&&o.variable.VariableType!=e.VariableType.Numeric&&o.variable.VariableType!=e.VariableType.DateTime||window.jsrcb.browser.includes("Microsoft Internet Explorer")||h()}),o.onmouseEnter=function(e){d(e.target.getAttribute("id"))},o.onmouseLeave=function(e){p(e.target)},o.moveNext=function(){n.Next()},o.multiSelectOption=function(e,t){if(e&&(o.SelectedValues.hasOwnProperty(t)?o.SelectedValues[t]=!o.SelectedValues[t]:o.SelectedValues[t]=!0),1==o.SelectedValues[t]){if(o.ExclusiveCodes.indexOf(t)>-1){for(var r in o.SelectedValues)r!=t&&(o.SelectedValues[r]=!1);o.RemoveAllAnswers()}else for(var n=0;n<o.ExclusiveCodes.length;n++)o.RemoveAnswer(o.ExclusiveCodes[n]),o.SelectedValues[o.ExclusiveCodes[n]]=!1;o.SaveAnswer(t)}else o.RemoveAnswer(t)},o.$watch("dateAnswer",function(t,r){r!=t&&o.variable.VariableType==e.VariableType.DateTime&&o.showFallBackDate&&x(t.answerInput)},!0),o.$on("updateAnswers",function(e,t){t.AllowSingleAnswerInRow&&Object.keys(t.AllowSingleAnswerInRow).length>0&&o.variable.Name==t.message&&k(t),t.message!=o.variable.Name&&t.ExclusiveAcrossRows&&k(t)}),o.$on("clearAnswer",function(e,t){o.variable.Name==t.VariableName&&r(function(){k(t)})})}else o.$destroy();o.maskOtherVariable=function(e,r){if(r=void 0===r||r,o.variable.Options[e].IsOther){var n=o.GetOtherVariableName(o.variable.Options[e].OtherVariableID);t.SetMaskingBit(n,r)}},r(function(){var e=Q.getElementsByTagName("textarea")[0];e&&(e.style.height=e.scrollHeight+"px"||"initial",e.baseScrollHeight=74,e.addEventListener("input",function(){m(this)}))})}function s(e){function n(t,r){e.OptionInfo.pageSequence=[];for(var n=t;n<=r;n++)e.OptionInfo.pageSequence.push(n);e.OptionInfo.firstVisiblePage=t,e.OptionInfo.lastVisiblePage=r}function a(){return e.OptionInfo.totalPages>e.OptionInfo.lastVisiblePage+10?e.OptionInfo.lastVisiblePage+10:e.OptionInfo.totalPages}function i(){return e.OptionInfo.currentPage-10<1?1:e.OptionInfo.currentPage-10}e.variable.Properties;e.data={SelectedValues:[]},e.variable.Properties.Min&&(e.variable.Properties.Min=parseInt(e.variable.Properties.Min),e.variable.Properties.Max=parseInt(e.variable.Properties.Max),e.variable.Properties.IncrementScaleBy=parseInt(e.variable.Properties.IncrementScaleBy)),e.OptionsList=[],e.OptionInfo={currentPage:1,pageSequence:[],showPagination:!1,optionsPerPage:30,totalPages:0,searchInput:""},e.OtherAnswer={Value:[]},e.Answer={},e.InputClicked=!1,e.filter={},e.filter.input="",e.ShowDropDown=function(){e.OptionsList=e.variable.VariableLevelSequence,e.InputClicked=!e.InputClicked,r(function(){e.$emit("adjust-question-height")})},e.HideDropDown=function(){e.InputClicked=!1},e.filterOptions=function(n){if(n)e.FilteredOptions=e.variable.VariableLevelSequence.filter(function(t){return e.variable.Options[t.ID].Text[e.DefaultLanguage].toLowerCase().startsWith(n.toLowerCase())});else{var a=t.GetVariableAnswers(e.variable.Name);a.length&&(e.FilteredOptions=e.variable.VariableLevelSequence.filter(function(t){return-1!=a.indexOf(e.variable.Options[t.ID].Code)}))}"dropdown"==e.displayType?e.OptionsList=e.FilteredOptions:(e.CalculatePages(e.FilteredOptions),e.onPageClick(1)),r(function(){
e.$emit("adjust-question-height")})},e.CalculatePages=function(t){t&&(e.OptionInfo.pageSequence=[],e.OptionInfo.totalPages=Math.ceil(t.length/e.OptionInfo.optionsPerPage),e.OptionInfo.totalPages>1?(e.OptionInfo.showPagination=!0,e.OptionInfo.totalPages>10?n(1,10):n(1,e.OptionInfo.totalPages)):e.OptionInfo.showPagination=!1)},e.onPageClick=function(t){if(e.FilteredOptions){e.OptionInfo.currentPage=t;var r=(e.OptionInfo.currentPage-1)*e.OptionInfo.optionsPerPage,n=e.OptionInfo.currentPage*e.OptionInfo.optionsPerPage;e.OptionsList=e.FilteredOptions.slice(r,n)}},e.onPrevClick=function(){1!=e.OptionInfo.currentPage&&(e.OptionInfo.currentPage-1<e.OptionInfo.firstVisiblePage&&n(i(),e.OptionInfo.currentPage-1),e.onPageClick(e.OptionInfo.currentPage-1))},e.onNextClick=function(){e.OptionInfo.currentPage!=e.OptionInfo.pageSequence.length&&(e.OptionInfo.currentPage+1>e.OptionInfo.lastVisiblePage&&n(e.OptionInfo.currentPage+1,a()),e.onPageClick(e.OptionInfo.currentPage+1))},e.OptionInfo.searchInput||r(function(){e.filterOptions(e.OptionInfo.searchInput)})}return{link:o,controller:["$scope",s],restrict:"E",require:["surveyVariable","?^surveyQuestion"],transclude:!0,scope:{variable:"=",properties:"=?"}}}e.module("SurveyEngine").directive("surveyVariable",["SurveyEngine.Enums","SurveyEngine.RespondentService","$timeout","SurveyEngine.NavigatorService","SurveyEngine.SurveySettings","SurveyEngine.ValidatorService",t])}(angular),function(e){"use strict";function t(t,r,n){function a(t,r,a,i){!function(){var a="";"selectbox"==t.displayType?a+='<select size="5" ng-model="SelectedValues.single" ng-change="SaveSingle(SelectedValues.single)"  class="dropdown survey-option-text"  style="border-bottom:0px!important;background:transparent"><option style="display:none" value="0">Select</option>':"dropdown"==t.displayType?a+='<select ng-model="SelectedValues.single" ng-change="SaveSingle(SelectedValues.single)"  class="dropdown survey-option-text select-box"><option style="display:none" value="0">Select</option>':a+='<select multiple size="5" ng-model="data.SelectedValues" class="dropdown survey-option-text" style="background:transparent">';for(var i in t.variable.VariableLevelSequence){var o=t.variable.VariableLevelSequence[i];if(o.IsOption){var s=t.variable.Options[o.ID].Code;"multiselectbox"==t.displayType?t.variable.Options[o.ID].Text[t.Language]?a+='<option class="opt pos-rel" ng-disabled="data.SelectedValues.indexOf(\''+s+'\') == -1 && data.SelectedValues.length == MaxChoices" ng-click="onSelect('+o.ID+')" value="'+s+'">'+t.variable.Options[o.ID].Text[t.Language]+"</option>":a+='<option class="opt pos-rel" ng-disabled="data.SelectedValues.indexOf(\''+s+'\') == -1 && data.SelectedValues.length == MaxChoices" ng-click="onSelect('+o.ID+')" value="'+s+'">'+t.variable.Options[o.ID].Text[t.DefaultLanguage]+"</option>":t.variable.Options[o.ID].Text[t.Language]?a+='<option class="opt" value="'+s+'">'+t.variable.Options[o.ID].Text[t.Language]+"</option>":a+='<option class="opt" value="'+s+'">'+t.variable.Options[o.ID].Text[t.DefaultLanguage]+"</option>"}else{a+='<optgroup class="opt" label="'+t.variable.OptionGroups[o.ID].Text[t.Language]+'">';for(var l in t.variable.OptionGroups[o.ID].OptionSequence){var s=t.variable.OptionGroups[o.ID].OptionSequence[l];"multiselectbox"==t.displayType?t.variable.Options[s].Text[t.Language]?a+='<option class="opt" ng-disabled="data.SelectedValues.indexOf(\''+s+'\') == -1 && data.SelectedValues.length == MaxChoices" ng-click="onSelect('+s+')"  value="'+s.toString()+'">'+t.variable.Options[s].Text[t.Language]+"</option>":a+='<option class="opt" ng-disabled="data.SelectedValues.indexOf(\''+s+'\') == -1 && data.SelectedValues.length == MaxChoices" ng-click="onSelect('+s+')"  value="'+s.toString()+'">'+t.variable.Options[s].Text[t.DefaultLanguage]+"</option>":t.variable.Options[s].Text[t.Language]?a+='<option class="opt" value="'+s.toString()+'">'+t.variable.Options[s].Text[t.Language]+"</option>":a+='<option class="opt" value="'+s.toString()+'">'+t.variable.Options[s].Text[t.DefaultLanguage]+"</option>"}a+="</optgroup>"}}a+="</select>";var u=n(e.element(a))(t);r.append(u)}()}function i(e){e.SelectedValues.single="0"}return{link:a,controller:["$scope",i],restrict:"E"}}e.module("SurveyEngine").directive("rcSelect",["SurveyEngine.RespondentService","SurveyEngine.SurveySettings","$compile",t])}(angular),function(e){"use strict";function t(t,r,n){function a(t,r,n,a){t.isGridOptions=n.isGridOptions,e.isUndefined(n.showOptionLabel)?t.showOptionLabel=!0:t.showOptionLabel="false"!=n.showOptionLabel,t.SaveSingle=function(e){null==e&&void 0==e&&""==e||t.SaveAnswer(e)},t.onSelect=function(e){var r=t.variable.Options[e];if(r.IsExclusive)t.data.SelectedValues=[],t.data.SelectedValues.push(r.Code.toString());else for(var n=0;n<t.ExclusiveCodes.length;n++)if(t.data.SelectedValues.indexOf(t.ExclusiveCodes[n].toString())>-1){var a=t.data.SelectedValues.indexOf(t.ExclusiveCodes[n].toString());t.data.SelectedValues.splice(a,1)}t.RemoveAllAnswers();for(var n in t.data.SelectedValues){var i=parseInt(t.data.SelectedValues[n]);t.SaveAnswer(i)}}}function i(e){}return{link:a,controller:["$scope",i],restrict:"E",template:n.get("surveyOptions.html")}}e.module("SurveyEngine").directive("surveyOptions",["SurveyEngine.Enums","$timeout","$templateCache",t])}(angular),function(e){"use strict";function t(e,r){function n(r,n,a,i){function o(e){return"string"==typeof e&&""===e.trim()?null:e}r.OptionLayout=e.Settings.InputButtonType?e.Settings.InputButtonType:1,r.OptionId=parseInt(a.optionId),function(){r.variable.Options[r.OptionId].IsOther&&(r.OtherVariableType[r.OptionId]=4==r.GetOtherVariableType(r.variable.Options[r.OptionId].OtherVariableID)?"number":"text")}(),r.SelectOption=function(e){1==parseInt(r.variable.VariableType)?r.SingleSelectOption():2==r.OptionLayout&&r.MuiltiSelectOption(!0,t)},r.SingleSelectOption=function(e){e&&e.preventDefault(),r.SelectedValues.single=r.variable.Options[r.OptionId].Code;for(var t in r.variable.Options)t!=r.OptionId&&r.variable.Options[t].IsOther&&r.maskOtherVariable(r.variable.Options[t].Code);r.variable.Options[r.SelectedValues.single].IsOther&&r.maskOtherVariable(r.SelectedValues.single,!1),null==r.SelectedValues.single&&void 0==r.SelectedValues.single&&""==r.SelectedValues.single||(r.SaveAnswer(r.SelectedValues.single,void 0,"","",r.variable.Options[r.OptionId].IsOther),r.variable.Options[r.OptionId].IsOther||r.HideDropDown())},r.MuiltiSelectOption=function(e,t,n){n&&n.stopPropagation(),r.multiSelectOption(e,t.Code)},r.$on("updateAnswers",function(e,t){if(t.message==r.variable.Name&&"checkbox"==r.variable.Properties.ShowAs){r.SelectedValues={};var n=r.GetVariableAnswers(r.variable.Name);for(var a in n)r.SelectedValues[n[a]]=!0}}),r.saveOtherValue=function(e){r.otherVariableType=r.GetOtherVariableType(e.OtherVariableID);var t=r.GetOtherVariableName(e.OtherVariableID);r.SaveAnswer(o(r.OtherAnswer.Value[e.Code]),t,r.otherVariableType,!0)}}function a(e){}return{link:n,controller:["$scope",a],restrict:"E",replace:!0,template:r.get("option.html")}}e.module("SurveyEngine").directive("surveyOption",["SurveyEngine.SurveySettings","$templateCache",t])}(angular),function(e){"use strict";function t(t,r,n,a,i){function o(r,o,s,l){function u(e,t){var r=document.getElementById("rankList");if(r.children.length>0)var n=r.children[0].lastChild;n&&n.remove()}r.GetTemplateUrl=function(){return r.qObject.QuestionType==t.QuestionType.Rank?n.get("rank.html"):n.get("rankSort.html")};for(var c=l[1],d=[],p=0;p<r.qObject.QuestionLevelSequence.length;p++)d.push(r.qObject.QuestionLevelSequence[p].ID);r.ExpandImage=function(e){r.ExpandedImage=!0,r.ExpandedImageSource=e.currentTarget.previousSibling.currentSrc;var t=(e.pageX,e.pageY),n=document.getElementById("ExpandedImageDiv"),a=document.getElementById("scrollable"),i=(a.scrollLeft,a.scrollTop);n.style.display="block",n.style.top=t+i-50+"px"},r.RemoveExpandedImage=function(){var e=document.getElementById("ExpandedImageDiv");r.ExpandedImageSource="",e.style.display="none"},r.BuildLists=function(n){require(["sortable"],function(a){switch("function"!=typeof window.Sortable&&(window.Sortable=a),n){case 0:var i=document.getElementById("rankList");if(r.AnsweredValues[0].length>0)for(var o=0;o<i.children.length;o++)r.List1Attributes.indexOf(i.children[o].innerText)>-1&&i.children[o].remove();new Sortable(i,{group:"words"});break;case 1:if(r.qObject.QuestionType==t.QuestionType.Rank){var s=document.getElementById("rankList1"),l=[],p=[];if(r.AnsweredValues[0].length>0){r.ShowList=!1;for(var o=0;o<r.AnsweredValues[0].length;o++){r.qObject.Attributes[d[r.AnsweredValues[0][o]-1]].Media[r.language]?(l.push(r.qObject.Attributes[d[r.AnsweredValues[0][o]-1]].Media[r.language]),p[o]=!0):l.push(r.qObject.Attributes[d[r.AnsweredValues[0][o]-1]].Text[r.language]);var b=r.qObject.Attributes[d[r.AnsweredValues[0][o]-1]].GroupSequence[0],g=r.qObject.Groups[b].VariableSequence[0];r.SortedList[0].push(r.qObject.Variables[g])}for(var o=0;o<l.length;o++){var v=document.createElement("li"),f="",m=document.createElement("span");m.innerText=o+1,m.className+=" rank-position",1==p[o]?(f=document.createElement("img"),f.src=l[o],f.style.maxWidth="100%",f.style.width="100px",f.style.height="auto"):(f=document.createElement("span"),f.innerText=l[o],f.className+="font-size-75",v.className+="padding-5 font-size pos-rel rank-text",v.style.cursor="move",v.style.backgroundColor="rgba(233,244,250,0.5)"),v.style["list-style"]="none",v.appendChild(f),v.appendChild(m),s.appendChild(v)}}else{for(var o=0;o<r.qObject.QuestionLevelSequence.length;o++){var S=r.qObject.Attributes[r.qObject.QuestionLevelSequence[o].ID],h=r.qObject.Groups[S.GroupSequence[0]],y=r.qObject.Variables[h.VariableSequence[0]];r.SortedList[0].push(y)}for(var o=0;o<r.SortedList[0].length;o++)c.SaveAnswer(r.SortedList[0][o].Name,4,o+1,!0,!0),c.SaveAnswer(r.RankVariables[0][o].Name,1,r.OriginalIndices[r.SortedList[0][o].Name],!0,!0)}new Sortable(s,{group:"words",scroll:!1,create:function(){var e=i.sortable("serialize");alert(e)},onUpdate:function(t){for(var n=t.oldIndex,a=t.newIndex,i=0;i<t.target.children.length;i++)if(t.target.children[i].innerText.substr(1,1).indexOf(".")>-1)t.target.children[i].innerText=i+1+"."+t.target.children[i].innerText.substr(2);else{var o=t.target.children[i].getElementsByClassName("rank-position");o.length>0&&t.target.children[i].removeChild(o[0]),e.element(t.target.children[i]).append(e.element("<span class='rank-position'>"+(i+1)+"</span>"))}var s=r.SortedList[0][n];r.SortedList[0].splice(n,1),r.SortedList[0].splice(a,0,s);for(var i=0;i<r.SortedList[0].length;i++)c.SaveAnswer(r.SortedList[0][i].Name,4,i+1,!0,!0),c.SaveAnswer(r.RankVariables[0][i].Name,1,r.OriginalIndices[r.SortedList[0][i].Name],!0,!0)},onAdd:function(t){for(var n,a=t.oldIndex,i=t.newIndex,o=0;o<t.target.children.length;o++)"Drag Here"==t.target.children[o].innerText&&t.target.children[o].remove();for(var o=0;o<t.target.children.length;o++)if(t.target.style.listStyle="none",t.target.children[o].childNodes)if(t.target.children[o].innerText.substr(1,1).indexOf(".")>-1)t.target.children[o].innerText=o+1+"."+t.target.children[o].innerText.substr(2);else{var s=t.target.children[o].getElementsByClassName("rank-position");s.length>0&&t.target.children[o].removeChild(s[0]),e.element(t.target.children[o]).append(e.element("<span class='rank-position' style='background-color: grey; padding: 5px; float: right; color: #fff;line-height: 10px;border-radius: 2px;margin-right: 0px;'>"+(o+1)+"</span>"));var l=t.target.children[o].getElementsByClassName("fa-ellipsis-v");l.length>0&&t.target.children[o].removeChild(l[0])}if(null!=r.MovedFromList)n=r.SortedList[r.MovedFromList][r.IndexInList],c.SaveAnswer(n.Name,4,[],!0,!0),c.SaveAnswer(r.RankVariables[r.MovedFromList][r.IndexInList].Name,1,[],!0,!0),r.SortedList[r.MovedFromList].splice(r.IndexInList,1),r.MovedFromList=null;else{n=r.NumericVariables[0][a];for(var o=0;o<r.NumericVariables.length;o++)r.NumericVariables[o].splice(a,1)}r.SortedList[0].splice(i,0,n);for(var o=0;o<r.SortedList[0].length;o++)c.SaveAnswer(r.SortedList[0][o].Name,4,o+1,!0,!0),c.SaveAnswer(r.RankVariables[0][o].Name,1,r.OriginalIndices[r.SortedList[0][o].Name],!0,!0)},onStart:function(e){r.MovedFromList=0,r.IndexInList=e.oldIndex}})}else{var s=document.getElementById("rankList1"),l=[];if(r.AnsweredValues[0].length>0){r.ShowList=!1;for(var o=0;o<r.AnsweredValues[0].length;o++){l.push(r.qObject.Attributes[d[r.AnsweredValues[0][o]-1]].Text["en-us"]);var b=r.qObject.Attributes[d[r.AnsweredValues[0][o]-1]].GroupSequence[0],g=r.qObject.Groups[b].VariableSequence[0];r.SortedList[0].push(r.qObject.Variables[g])}r.List1Attributes=l;for(var o=0;o<l.length;o++){var v=document.createElement("li"),f="",m=document.createElement("span");m.innerText=o+1,m.className+=" rank-position",f=document.createTextNode(l[o]),v.style["list-style"]="none",v.className+=" ranked-element",v.appendChild(f),v.appendChild(m),s.appendChild(v)}}new Sortable(s,{group:"words",onUpdate:function(e){var t=e.oldIndex,n=e.newIndex;r.ChangeUIAfterUpdate(e),null!=r.MovedFromList&&(r.MovedFromList=null);var a=r.SortedList[0][t];r.SortedList[0].splice(t,1),r.SortedList[0].splice(n,0,a);for(var i=0;i<r.SortedList[0].length;i++)c.SaveAnswer(r.SortedList[0][i].Name,4,i+1,!0,!0),c.SaveAnswer(r.RankVariables[0][i].Name,1,r.OriginalIndices[r.SortedList[0][i].Name],!0,!0)},onAdd:function(e){r.qObject.Properties.MaxRankableItems&&r.SortedList[0].length==parseInt(r.qObject.Properties.MaxRankableItems)&&this.option("disabled",!0);var t,n=e.oldIndex,a=e.newIndex;if(r.ChangeUIAfterDrag(e,a),null!=r.MovedFromList)t=r.SortedList[r.MovedFromList][r.IndexInList],c.SaveAnswer(t.Name,4,[],!0,!0),c.SaveAnswer(r.RankVariables[r.MovedFromList][r.IndexInList].Name,1,[],!0,!0),r.SortedList[r.MovedFromList].splice(r.IndexInList,1),r.MovedFromList=null;else{t=r.NumericVariables[0][n];for(var i=0;i<r.NumericVariables.length;i++)r.NumericVariables[i].splice(n,1)}r.SortedList[0].splice(a,0,t);for(var i=0;i<r.SortedList[0].length;i++)c.SaveAnswer(r.SortedList[0][i].Name,4,i+1,!0,!0),c.SaveAnswer(r.RankVariables[0][i].Name,1,r.OriginalIndices[r.SortedList[0][i].Name],!0,!0)},onRemove:function(e){var t=e.oldIndex;r.SortedList[0][t];c.SaveAnswer(r.SortedList[0][t].Name,4,[],!0,!0),c.SaveAnswer(r.RankVariables[0][t].Name,1,[],!0,!0),r.SortedList[0].splice(t,1),u(e,t)},onStart:function(e){r.MovedFromList=0,r.IndexInList=e.oldIndex}})}break;case 2:var O=document.getElementById("rankList2");if(O){var l=[];if(r.AnsweredValues[1].length>0){r.ShowList=!1;for(var o=0;o<r.AnsweredValues[1].length;o++){l.push(r.qObject.Attributes[d[r.AnsweredValues[1][o]-1]].Text["en-us"]);var b=r.qObject.Attributes[d[r.AnsweredValues[1][o]-1]].GroupSequence[0],g=r.qObject.Groups[b].VariableSequence[0];r.SortedList[1].push(r.qObject.Variables[g])}for(var o=0;o<l.length;o++){var v=document.createElement("li"),f="",m=document.createElement("span");m.innerText=o+1,m.className+=" rank-position",f=document.createTextNode(l[o]),v.style["list-style"]="none",v.className+=" ranked-element",v.appendChild(f),v.appendChild(m),O.appendChild(v)}}new Sortable(O,{group:"words",onUpdate:function(e){var t=e.oldIndex,n=e.newIndex;r.ChangeUIAfterUpdate(e),null!=r.MovedFromList&&(r.MovedFromList=null);var a=r.SortedList[1][t];r.SortedList[1].splice(t,1),r.SortedList[1].splice(n,0,a);for(var i=0;i<r.SortedList[1].length;i++)c.SaveAnswer(r.SortedList[1][i].Name,4,i+1,!0,!0),c.SaveAnswer(r.RankVariables[1][i].Name,1,r.OriginalIndices[r.SortedList[1][i].Name],!0,!0)},onAdd:function(e){var t,n=e.oldIndex,a=e.newIndex;if(r.qObject.Properties.MaxRankableItems&&e.target.children.length>=r.qObject.Properties.MaxRankableItems&&this.option("disabled",!0),r.ChangeUIAfterDrag(e,a),null!=r.MovedFromList)t=r.SortedList[r.MovedFromList][r.IndexInList],c.SaveAnswer(t.Name,4,[],!0,!0),c.SaveAnswer(r.RankVariables[r.MovedFromList][r.IndexInList].Name,1,[],!0,!0),r.SortedList[r.MovedFromList].splice(r.IndexInList,1),r.MovedFromList=null;else{t=r.NumericVariables[1][n];for(var i=0;i<r.NumericVariables.length;i++)r.NumericVariables[i].splice(n,1)}r.SortedList[1].splice(a,0,t);for(var i=0;i<r.SortedList[1].length;i++)c.SaveAnswer(r.SortedList[1][i].Name,4,i+1,!0,!0),c.SaveAnswer(r.RankVariables[1][i].Name,1,r.OriginalIndices[r.SortedList[1][i].Name],!0,!0)},onStart:function(e){r.MovedFromList=1,r.IndexInList=e.oldIndex},onRemove:function(e){u(e,e.oldIndex)}})}break;case 3:var T=document.getElementById("rankList3");if(T){var l=[];if(r.AnsweredValues[2].length>0){r.ShowList=!1;for(var o=0;o<r.AnsweredValues[2].length;o++)l.push(r.qObject.Attributes[d[r.AnsweredValues[2][o]-1]].Text["en-us"]);for(var o=0;o<l.length;o++){var v=document.createElement("li"),f=document.createTextNode(o+1+"."+l[o]);v.appendChild(f),T.appendChild(v)}}new Sortable(T,{group:"words",onUpdate:function(e){var t=e.oldIndex,n=e.newIndex;r.ChangeUIAfterUpdate(e);var a=r.SortedList[2][t];r.SortedList[2].splice(t,1),r.SortedList[2].splice(n,0,a);for(var i=0;i<r.SortedList[2].length;i++)c.SaveAnswer(r.SortedList[2][i].Name,4,i+1,!0,!0),c.SaveAnswer(r.RankVariables[2][i].Name,1,r.OriginalIndices[r.SortedList[2][i].Name],!0,!0)},onAdd:function(e){var t,n=e.oldIndex,a=e.newIndex;if(r.qObject.Properties.MaxRankableItems&&e.target.children.length>=r.qObject.Properties.MaxRankableItems&&this.option("disabled",!0),r.ChangeUIAfterDrag(e,a),null!=r.MovedFromList)t=r.SortedList[r.MovedFromList][r.IndexInList],c.SaveAnswer(t.Name,4,[],!0,!0),c.SaveAnswer(r.RankVariables[r.MovedFromList][r.IndexInList].Name,1,[],!0,!0),r.SortedList[r.MovedFromList].splice(r.IndexInList,1),r.MovedFromList=null;else{t=r.NumericVariables[2][n];for(var i=0;i<r.NumericVariables.length;i++)r.NumericVariables[i].splice(n,1)}r.SortedList[2].splice(a,0,t);for(var i=0;i<r.SortedList[2].length;i++)c.SaveAnswer(r.SortedList[2][i].Name,4,i+1,!0,!0),c.SaveAnswer(r.RankVariables[2][i].Name,1,r.OriginalIndices[r.SortedList[2][i].Name],!0,!0)},onStart:function(e){r.MovedFromList=2,r.IndexInList=e.oldIndex},onRemove:function(e){u(e,e.oldIndex)}})}}})},a(function(){o.html(r.GetTemplateUrl()),i(o.contents())(r)})}function s(t){function n(r,n){for(var a,i=0;i<r.target.children.length;i++)"Drag Here"==r.target.children[i].innerText&&("function"==typeof r.target.children[i].remove?r.target.children[i].remove():r.target.children[i].outerHTML="");a=r.target.children.length;for(var i=0;i<a;i++)if(void 0!=t.MovedFromList||i!=n){var o=r.target.children[i].innerText.length;r.target.children[i].innerText=r.target.children[i].innerText.substr(0,o-1)}for(var i=0;i<r.target.children.length;i++)if(r.target.style.listStyle="none",r.target.children[i].childNodes)if(r.target.children[i].innerText.substr(1,1).indexOf(".")>-1)r.target.children[i].innerText=i+1+"."+r.target.children[i].innerText.substr(2);else{e.element(r.target.children[i]).append(e.element("<span class='assigned-rank' style='background-color: grey; padding: 5px; float: right; color: #fff;line-height: 10px;border-radius: 2px;margin-right: 0px;'>"+(i+1)+"</span>"));var s=r.target.children[i].getElementsByClassName("fa-ellipsis-v");s.length>0&&r.target.children[i].removeChild(s[0])}}function a(t){for(var r=0;r<t.target.children.length;r++){var n=t.target.children[r].innerText.length;t.target.children[r].innerText=t.target.children[r].innerText.substr(0,n-1)}for(var r=0;r<t.target.children.length;r++)t.target.children[r].innerText.substr(1,1).indexOf(".")>-1?t.target.children[r].innerText=r+1+"."+t.target.children[r].innerText.substr(2):e.element(t.target.children[r]).append(e.element("<span style='background-color: grey; padding: 5px; float: right; color: #fff;line-height: 10px;border-radius: 2px;margin-right: 0;'>"+(r+1)+"</span>"))}t.OriginalIndices={},t.ShowAs=t.qObject.Properties.ShowAs,t.ShowList=!0,t.ticks=(new Date).getTime(),t.ChangeUIAfterDrag=n,t.ChangeUIAfterUpdate=a;for(var i=0,o=0,s=0;s<t.qObject.QuestionLevelSequence.length;s++){var l=t.qObject.QuestionLevelSequence[s].ID;if(0==i){t.NumberOfLists=t.qObject.Attributes[l].GroupSequence.length,t.RankVariables=new Array(t.NumberOfLists),t.NumericVariables=new Array(t.NumberOfLists),t.SortedList=new Array(t.NumberOfLists),t.AnsweredValues=new Array(t.NumberOfLists),t.GroupNames=[];for(var o=0;o<t.qObject.Attributes[l].GroupSequence.length;o++)t.NumericVariables[o]=[],t.SortedList[o]=[],t.AnsweredValues[o]=[]}o=0;for(var u in t.qObject.Attributes[l].GroupSequence){var c=t.qObject.Attributes[l].GroupSequence[u],d=t.qObject.Groups[c];0==i&&(t.GroupNames[o]=d.Text["en-us"]);for(var p in d.VariableSequence){var b=d.VariableSequence[p];t.NumericVariables[o].push(t.qObject.Variables[b])}o++}i++}for(var l in t.qObject.Attributes)if("rank_holder"==t.qObject.Attributes[l].Text["en-us"]){t.RankVariables=new Array(t.NumberOfLists);var o=0;for(var u in t.qObject.Attributes[l].GroupSequence){t.RankVariables[o]=[];var g=t.qObject.Attributes[l].GroupSequence[u],v=t.qObject.Groups[g];for(var f in v.VariableSequence){var m=v.VariableSequence[f];t.RankVariables[o].push(t.qObject.Variables[m])}o++}}for(var o=0;o<t.RankVariables.length;o++)for(var i=0;i<t.RankVariables[o].length;i++){var S=r.GetVariableAnswers(t.RankVariables[o][i].Name);S&&S.length>0&&(t.AnsweredValues[o][i]=S[0])}for(var o=0;o<t.NumericVariables.length;o++)for(var i=0;i<t.NumericVariables[o].length;i++)t.OriginalIndices[t.NumericVariables[o][i].Name]=i+1}return{link:o,controller:["$scope",s],require:["surveyRank","^surveyQuestion"],restrict:"E"}}e.module("SurveyEngine").directive("surveyRank",["SurveyEngine.Enums","SurveyEngine.RespondentService","$templateCache","$timeout","$compile",t])}(angular),function(e){"use strict";function t(e){function t(t,r,n){if(t.OptionId=parseInt(n.optionId),t.ExclusiveId=parseInt(n.exclusiveId),t.smileyPath=t.variable.Options[t.OptionId].Media["en-us"],e(function(){var e=t.variable.Name+"-"+t.OptionId;document.getElementById(e)&&document.getElementById(e).setAttribute("d",t.smileyPath)}),!n.exclusiveId&&t.variable){var a=t.variable.VariableLevelSequence.filter(function(e){return t.variable.Options[e.ID].IsExclusive});a.length&&(t.ExclusiveId=a[0].ID)}r[0].style}function r(e){}return{link:t,controller:["$scope",r],restrict:"E",scope:!0,templateUrl:"app/ui/views/surveyRatingTemplate.html"}}e.module("SurveyEngine").directive("surveyStars",["$timeout",t])}(angular),function(e){"use strict";function t(e,t,r){function n(n,a,i){function o(t){t.e.preventDefault(),w++;var r,a,i=document.getElementById("mainCanvas"+n.qObject.Name),o=i.getBoundingClientRect();t.e.clientX?(r=t.e.clientX-o.left,a=t.e.clientY-o.top):(r=t.e.touches[0].clientX-o.left,a=t.e.touches[0].clientY-o.top);var u=w%parseInt(D.MaxClicks);if(0==u&&(u=parseInt(D.MaxClicks)),n.qObject.QuestionType==e.QuestionType.HeatMap){v(r,a,w);var c=u+"_X",d=u+"_Y";n.SaveAnswer(I[c],e.VariableType.Numeric,r,!0,!1),n.SaveAnswer(I[d],e.VariableType.Numeric,a,!0,!1)}O.getActiveObject()?(n.qObject.QuestionType==e.QuestionType.HeatZone?(l(),s()):O.getActiveObject().setFill("green"),P[u]=O.getActiveObject().ID,p()):P[u]&&b(u)}function s(){var e=0;for(var t in C)C[t]&&e++;e>parseInt(D.MaxClicks)&&(C[q[0]]=!1,u(q[0],"red"),q.splice(0,1))}function l(){var e=O.getActiveObject(),t=e.ID;if(C[t]=!C[t],C[t])e.setFill("green"),q.push(t);else{e.setFill("red");var r=q.indexOf(t);q.splice(r,1)}O.renderAll()}function u(e,t){var r=O.getObjects();for(var n in r)if(r[n].ID==e){r[n].set({fill:t,opacity:.3});break}}function c(t){t.target&&"circle"!=t.target.type&&D.Visibility==e.HeatmapProperties.HiddenUntilHover&&t.target&&t.target.ID&&(n.qObject.QuestionType==e.QuestionType.HeatZone&&C[t.target.ID]?t.target.setFill("green"):t.target.setFill("red"),t.target.setStroke("black"),O.renderAll())}function d(t){t.target&&"circle"==t.target.type||D.Visibility==e.HeatmapProperties.HiddenUntilHover&&t.target&&(t.target.setFill("transparent"),t.target.setStroke("transparent"),O.renderAll())}function p(){if(n.qObject.QuestionType==e.QuestionType.HeatZone){var r=[];for(var a in C)C[a]&&r.push(parseInt(a));n.SaveAnswer(T.Name,e.VariableType.MultipleChoice,r,!0,!0)}else{for(var r=t.GetVariableAnswers(T.Name),i=parseInt(O.getActiveObject().ID),o=0;o<r.length;o++)r[o]=parseInt(r[o]);-1==r.indexOf(i)&&(r.push(i),n.SaveAnswer(T.Name,e.VariableType.MultipleChoice,r,!0,!0))}}function b(r){var a=t.GetVariableAnswers(T.Name),i=parseInt(P[r]);a.indexOf(i)>-1&&(a.splice(a.indexOf(P[r]),1),n.SaveAnswer(T.Name,e.VariableType.MultipleChoice,a,!0,!0)),D.Visibility==e.HeatmapProperties.AlwaysHidden||D.Visibility==e.HeatmapProperties.HiddenUntilHover?u(P[r],"transparent"):u(P[r],"red")}function g(){var t;for(var r in T.Options){var n=T.Options[r].heatMapConfig;n.hoverCursor="default",n.lockMovementY=!0,n.lockMovementX=!0,n.hasControls=!1,D.Visibility!=e.HeatmapProperties.AlwaysHidden&&D.Visibility!=e.HeatmapProperties.HiddenUntilHover||(n.fill="transparent",n.borderColor="transparent",n.stroke="transparent"),t=n.radius?new fabric.Circle(n):new fabric.Rect(n),x.indexOf(r)>-1||x.indexOf(parseInt(r))>-1?(C[r]=!0,D.Visibility==e.HeatmapProperties.AlwaysVisible&&(t.setFill("green"),t.setStroke("black"))):C[r]=!1,O.add(t)}}function v(t,r,a){if(n.qObject.QuestionType!=e.QuestionType.HeatZone||O.getActiveObject()){var i=(O.getActiveObject(),parseInt(D.MaxClicks)),o=a%i;if(0==o&&(o=i),A[o-1])O.remove(A[o-1]),A[o-1].left=t,A[o-1].top=r;else{var s=new fabric.Circle({radius:5,stroke:"#0000cd",strokeWidth:1,fill:"transparent",top:r,left:t,hoverCursor:"default",type:"circle",lockMovementX:!0,lockMovementY:!0,hasControls:!1});A[o-1]=s}for(var l=0;l<A.length;l++)O.add(A[l])}}function f(e){var t=new Image;t.addEventListener("load",function(){O.setHeight(this.naturalHeight),O.setWidth(this.naturalWidth)}),t.src=e}function m(){for(var e=0;e<n.qObject.QuestionLevelSequence.length;e++){var t=n.qObject.Variables[n.qObject.QuestionLevelSequence[e].ID];if(t.AnalysisText[n.language].indexOf("_")>-1){var r=t.AnalysisText[n.language].split("_")[1]+"_"+t.AnalysisText[n.language].split("_")[2];I[r]=t.Name}}}function S(){for(var e=1;e<n.qObject.QuestionLevelSequence.length;e++){var r=n.qObject.Variables[n.qObject.QuestionLevelSequence[e].ID].Name,a=n.qObject.Variables[n.qObject.QuestionLevelSequence[e].ID].AnalysisText[n.language],i=a.split("_");V[i[1]]||(V[i[1]]={}),V[i[1]][i[2]]=t.GetVariableAnswers(r)[0]}y()}function h(){x=t.GetVariableAnswers(T.Name),q=x}function y(){var e=new Image;e.src=n.qObject.Properties.MediaPath,e.onload=function(){var e=document.getElementById("mainCanvas"+n.qObject.Name);e.getBoundingClientRect();for(var t in V)if(V[t].Y){var r=parseInt(t),a=parseInt(V[t].Y)+e.offsetTop,i=parseInt(V[t].X)+e.offsetLeft,o=new fabric.Circle({radius:5,stroke:"#0000cd",strokeWidth:1,fill:"transparent",top:a,left:i,type:"circle",lockMovementX:!0,lockMovementY:!0,hasControls:!1});A[r-1]=o}for(var s=0;s<A.length;s++)O.add(A[s])}}var O,T,w=0,I={},A=[],V={},C={},x=[],q=[],P={},D=n.qObject.Properties;!function(){m(),r(function(){O=new fabric.Canvas("mainCanvas"+n.qObject.Name,{preserveObjectStacking:!0}),T=n.qObject.Variables[n.qObject.QuestionLevelSequence[0].ID],S(),h(),n.qObject.Properties.MediaPath&&(f(n.qObject.Properties.MediaPath),O.setBackgroundImage(n.qObject.Properties.MediaPath,O.renderAll.bind(O))),g(),O.on({"mouse:down":o,"mouse:over":c,"mouse:out":d})})}()}function a(e){}return{restrict:"A",link:n,scope:!1,controller:["$scope",a]}}e.module("SurveyEngine").directive("surveyHeatmap",["SurveyEngine.Enums","SurveyEngine.RespondentService","$timeout",t])}(angular),function(e){"use strict";function t(e,t,r,n){function a(t,r,n,a){function i(){for(var e=[],r=0;r<t.Variable.VariableLevelSequence.length;r++)if(1==t.Variable.VariableLevelSequence[r].IsOption)e.push(t.Variable.Options[t.Variable.VariableLevelSequence[r].ID]);else for(var n=t.Variable.OptionGroups[t.Variable.VariableLevelSequence[r].ID],a=0;a<n.OptionSequence.length;a++)e.push(t.Variable.Options[n.OptionSequence[a]]);return e}function o(){0==d&&(c.animation.spins=15,c.startAnimation(),d=!0)}function s(e){u.SaveAnswer(t.Variable.Name,t.Variable.VariableType,e.code,!0),t.ShowPlayButton=!1,t.Answer=e.text,t.$apply()}function l(e){for(var r in t.Options){var n=t.Options[r];if(n.Code==e)return n.Text[t.Language]}}var u=a[0];t.Language=u.Language,t.DefaultLanguage=u.DefaultLanguage,t.Options=[],t.OptionIndex=0,t.ShowPlayButton=!1,t.ShowOptions=!1,t.Answer="",t.Play=o,function(){t.Options=i();var r=e.GetVariableAnswers(t.Variable.Name);0==r.length?t.ShowPlayButton=!0:(t.ShowOptions=!0,t.Answer=l(r[0]))}();var c=new Winwheel({canvasId:"win-canvas",numSegments:t.Options.length,textFontSize:12,segments:function(){var e=["#eae56f","#89f26e","#7de6ef","#e7706f"],r=0,n=[];for(var a in t.Options){var i=t.Options[a],o={fillStyle:e[r++],text:i.Text[t.Language],code:i.Code};r==e.length&&(r=0),n.push(o)}return n}(),animation:{type:"spinToStop",duration:5,spins:8,callbackFinished:s}}),d=!1}return{scope:{Variable:"=variable"},link:a,restrict:"E",require:["^surveyQuestion"],template:n.get("gamifyOptions.html")}}e.module("SurveyEngine").directive("singleChoiceGamify",["SurveyEngine.RespondentService","$timeout","$interval","$templateCache",t])}(angular),function(e){"use strict";function t(t){function r(r,n,a){var i="";i+='<div ng-if="ErrorConfig.ShowError" class="message" ng-style="ErrorConfig.Style"><span>{{ErrorConfig.Message}}</span><div ng-style="ErrorConfig.CaretStyle"></div></div>',n.append(t(e.element(i))(r))}function n(e){}return{restrict:"A",scope:{ErrorConfig:"=errorConfig"},link:r,controller:["$scope",n]}}e.module("SurveyEngineCore").directive("errorToolTip",["$compile",t])}(angular),function(){"use strict";angular.module("SurveyEngineCore").directive("bindHtmlCompile",["$interpolate",function(e){return{restrict:"A",link:function(t,r,n){t.r=window.r;var a=r.html();a||(a=""),a+=t.$eval(n.bindHtmlCompile);var i=t.$watch(function(){return e(a,!1,null,!0)(t)},function(e,t){void 0!=e&&(r.html(e),e==a?i():a=e)})}}}])}(),function(e){"use strict";function t(t,r,n,a,i){function o(e,t,r,n){function o(){var t=!1,r=document.getElementsByClassName("ac-hover")[0],n=document.getElementsByClassName("auto-code-opts");Array.prototype.slice.call(n).map(function(e){var t=e.getElementsByTagName("i")[0];t&&(t.style.display="none")});var a=document.getElementsByClassName("modal-btn-hover")[0];if(a)return void a.click();if(r){var i=r.getAttribute("id");t="ac-other"==i,t?e.SaveAutocodeOtherAnswer(void 0,r):null!=i&&void 0!=i&&""!=i&&e.SaveConflictAnswer(parseInt(i),r),l()}else c()}function s(e){u();var t=document.getElementsByClassName("auto-code-opts"),r=Array.prototype.slice.call(t),n=document.getElementsByClassName("ac-hover")[0],a=r.indexOf(n),o=-1;switch(t.length>0&&e){case i.Direction.UP:case i.Direction.LEFT:o=a>-1?0==a?t.length-1:a-1:t.length-1;break;case i.Direction.DOWN:case i.Direction.RIGHT:o=a>-1?a+1==t.length?0:a+1:0}o>-1&&(n&&n.classList.remove("ac-hover"),t[o].classList.add("ac-hover"))}function l(){var e=document.getElementsByClassName("modal-footer")[0];if(e){var t=document.createElement("span");t.textContent="press Enter OR",t.style.paddingRight="15px",t.style.fontSize="1rem";var r=e.getElementsByTagName("button")[0];e&&e.prepend(t),r&&r.classList.add("modal-btn-hover")}}function u(){var e=document.getElementsByClassName("modal-footer")[0];if(e){var t=e.getElementsByTagName("span")[0];t&&t.remove();var r=e.getElementsByTagName("button")[0];r&&r.classList.remove("modal-btn-hover")}}function c(){a(function(){e.currentInputBox==document.activeElement?e.currentInputBox.blur():document.activeElement&&document.activeElement.blur()})}function d(){for(var t=p.querySelectorAll(".focusableInput:not(.ng-hide)"),r=document.activeElement,n=0;n<t.length;n++)if(t[n]==r){if(!(n>=t.length-1)){e.currentInputBox=t[n+1];break}e.currentInputBox=t[0]}}var p=t[0];i.submit=o,i.focusListener=s,i.tabPressListener=d,e.currentInputBox=null,e.focusInputElement=function(){a(function(){
var t=p.querySelectorAll(".focusableInput:not(.ng-hide)"),r=0;t.length>0&&(e.currentInputBox&&Array.prototype.slice.call(t).map(function(n,a){n==e.currentInputBox&&(r=t.length>a+1?a+1:-1)}),r>-1?(e.currentInputBox=t[r],e.currentInputBox.focus()):(e.currentInputBox.blur(),e.currentInputBox=null))})},window.jsrcb.isMobile||e.focusInputElement()}function s(o){function s(e){for(var t=[],n=0;n<e.VariableLevelSequence.length;n++)if(e.VariableLevelSequence[n].IsOption){var a=e.VariableLevelSequence[n].ID,i=e.Options[a].Code;t.push(i)}r.SetDisplayedValues(e.Name,e.VariableType,o.qObject.ID,t)}function l(r,a){if(r){var i=o.qObject.Variables[o.qObject.QuestionLevelSequence[1].ID],s=o.qObject.Variables[o.qObject.QuestionLevelSequence[0].ID],l=r.toLowerCase().trim(),d=!1,b=!1,g=0,v=o.AutocodeAnswers[a],f={},S=e.copy(o.AutocodeAnswers);o.AliasConflict={},o.EditDistance={},o.SimilarityText={},o.ConflictText=r,o.ConflictIndex=a;for(var h in s.Options)if(s.Options[h].IsOther){f=o.qObject.Variables[s.Options[h].OtherVariableID];break}for(var h in s.Options){var y=p(s.Options[h].Aliases),T=s.Options[h].Text[o.language].toLowerCase().trim();if("other"!=T){if(o.EditDistance[h]=m(r,T),l==T){o.AutocodeAnswers[a]=s.Options[h].Code,d=!0;break}if(0!=y.length){for(var w={},I=0;I<y.length;I++)if(w[I]=m(l,y[I].toLowerCase().trim()),l==y[I].toLowerCase().trim()){o.AliasConflict[s.Options[h].Code]=s.Options[h].Text[o.language],g++,g<=1&&(o.AutocodeAnswers[a]=s.Options[h].Code),d=!0;break}var A=c(w);A<o.EditDistance[h]&&(o.EditDistance[h]=A)}}}if(g>1&&(b=!0,n.RunPostValidation(t.ValidationType.AutoCodeConflict,O)),b||d||(o.SimilarityText=u(o.EditDistance),n.RunPostValidation(t.ValidationType.AutoCodeSimilarity,O)),d&&2==v){for(var V=o.AutocodeOtherAnswer.split(","),C=0,x=0;x<=o.ConflictIndex;x++)2==S[x]&&C++;C&&V.splice(C-1,1),o.AutocodeOtherAnswer=V.join(),o.SaveAnswer(f.Name,t.VariableType.Text,o.AutocodeOtherAnswer,!0,!1)}o.AutocodeAnswers.length>0&&(o.SaveAnswer(s.Name,s.VariableType,o.AutocodeAnswers,!0,!1),o.SaveAnswer(i.Name,i.VariableType,o.AutocodeAnswers[0],!0,!0))}}function u(e){return d(e,c(e))}function c(e){var t=999;for(var r in e){var n=parseInt(e[r]);n<t&&(t=n,r)}return t}function d(e,t){var r={},n=o.qObject.Variables[o.qObject.QuestionLevelSequence[0].ID];for(var a in e){e[a]==t&&(r[n.Options[a].Code]=n.Options[a].Text[o.language])}return r}function p(e){var t=[];for(var r in e)for(var n=0;n<e[r].length;n++)t.push(e[r][n]);return t}function b(){for(var e=0;e<o.qObject.Properties.AnswersAllowed;e++){var t={};o.AutocodeTextbox.push(t)}}function g(e,r,n){if(!e)var e=o.ConflictText;var a=o.qObject.Variables[o.qObject.QuestionLevelSequence[0].ID];for(var i in a.Options)if(a.Options[i].IsOther){r?o.ConflictAnswer=a.Options[i].Code:o.AutocodeAnswers[n]=a.Options[i].Code;var s=o.qObject.Variables[a.Options[i].OtherVariableID].Name;if(o.AutocodeOtherAnswer){var l=o.AutocodeOtherAnswer.split(","),u=0;if(Object.keys(o.AutocodeAnswers).indexOf(o.ConflictIndex.toString())>-1)for(var c=0;c<=o.ConflictIndex;c++)o.AutocodeAnswers[c]==a.Options[i].Code&&u++;u?l.splice(u-1,1,e):Object.keys(o.AutocodeAnswers).indexOf(o.ConflictIndex.toString())>-1?l.splice(0,0,e):l.push(e),o.AutocodeOtherAnswer=l.join()}else o.AutocodeOtherAnswer=e;o.SaveAnswer(s,t.VariableType.Text,o.AutocodeOtherAnswer,!0,!1);break}if(r){var c=r.getElementsByTagName("i")[0];c&&(c.style.display="block")}}function v(e,t){o.ConflictAnswer=e;var r=t.getElementsByTagName("i")[0];r&&(r.style.display="block")}function f(){a(function(){var e=o.qObject.Variables[o.qObject.QuestionLevelSequence[0].ID],t=o.qObject.Variables[o.qObject.QuestionLevelSequence[1].ID];o.ConflictAnswer&&(o.AutocodeAnswers[o.ConflictIndex]=o.ConflictAnswer,o.AutocodeTextbox[o.ConflictIndex].value=e.Options[o.ConflictAnswer].Text[o.language]),o.AutocodeAnswers.length>0&&(o.SaveAnswer(e.Name,e.VariableType,o.AutocodeAnswers,!0,!1),o.SaveAnswer(t.Name,t.VariableType,o.AutocodeAnswers[0],!0,!0)),o.focusInputElement()})}function m(e,t){var r=e,n=t;return e.length<t.length&&(r=t,n=e),0==r.length?1:S(r,n)}function S(e,t){e=e.toLowerCase(),t=t.toLowerCase();for(var r=new Array,n=0;n<=e.length;n++){for(var a=n,i=0;i<=t.length;i++)if(0==n)r[i]=i;else if(i>0){var o=r[i-1];e.charAt(n-1)!=t.charAt(i-1)&&(o=Math.min(Math.min(o,a),r[i])+1),r[i-1]=a,a=o}n>0&&(r[t.length]=a)}return r[t.length]}function h(e){e.classList.add("ac-hover")}function y(e){e&&e.classList.remove("ac-hover")}function O(e){document.activeElement.blur(),i.blockNavigation=!0,window.save=o.SaveConflictAnswer,window.saveAutocodeOther=o.SaveAutocodeOtherAnswer,window.onMouseEnter=h,window.onMouseLeave=y;var r="";if(e==t.ValidationType.AutoCodeConflict)for(var n in o.AliasConflict)r+='<span id="'+n+'" class="auto-code-opts conflict-choices clickable option-as-label" onclick="save('+n+', this)" onmouseenter="onMouseEnter(this)" onmouseleave="onMouseLeave(this)">'+o.AliasConflict[n]+'<i class="icon icon-check pos-rel" style="top:4px;display: none;float: right;"></i> </span>';else for(var n in o.SimilarityText)r+='<span id="'+n+'"  class="auto-code-opts conflict-choices clickable font-size-Xlg option-as-label" onclick="save('+n+', this)" onmouseenter="onMouseEnter(this)" onmouseleave="onMouseLeave(this)">'+o.SimilarityText[n]+'<i class="icon icon-check pos-rel" style="top:4px;display: none;float: right;"></i> </span>';return r+='<span id="ac-other"  class="auto-code-opts conflict-choices clickable option-as-label" onclick="saveAutocodeOther(undefined, this)" onmouseenter="onMouseEnter(this)" onmouseleave="onMouseLeave(this)">Other<i class="icon icon-check pos-rel" style="top:4px;display: none;float: right;"></i></span>',window.closeModal=function(){i.blockNavigation=!1,o.SaveAnswerAfterConflictResolved(),o.ConflictPopupBroadcast=!1;var e=document.getElementById("page"),t=document.getElementById("modal");e.removeChild(t),delete window.saveAutocodeOther,delete window.save,delete window.onMouseEnter,delete window.onMouseLeave},r}o.AutocodeTextbox=[],o.AutocodeAnswers=[],o.SaveAutocodeAnswer=l,o.AddTextbox=b,o.SaveAutocodeOtherAnswer=g,o.SaveConflictAnswer=v,o.SaveAnswerAfterConflictResolved=f,o.qObject.QuestionType==t.QuestionType.AutocodeText&&(o.NumberOfTextboxes=parseInt(o.qObject.Properties.AnswersAllowed),function(){var e,t=o.qObject.Variables[o.qObject.QuestionLevelSequence[0].ID],n=r.GetVariableAnswers(t.Name);o.AutocodeAnswers=n,s(t),b();for(var a=0,i=0;i<n.length;i++)if(t.Options[n[i]].IsOther){var l=o.qObject.Variables[t.Options[n[i]].OtherVariableID];e=r.GetVariableAnswers(l.Name),o.AutocodeOtherAnswer=e[0];var u=e[0].split(","),c={value:u[a++]};o.AutocodeTextbox[i]=c}else{e=t.Options[n[i]].Text[o.language];var c={value:e};o.AutocodeTextbox[i]=c}}())}return{link:o,controller:["$scope",s],restrict:"A"}}e.module("SurveyEngine").directive("autoCode",["SurveyEngine.Enums","SurveyEngine.RespondentService","SurveyEngine.PageRouteService","$timeout","SurveyEngine.NavigatorService",t])}(angular),function(e,t){"use strict";function r(){if("pageYOffset"in e)return{scrollTop:pageYOffset,scrollLeft:pageXOffset};var t,r,n=document,a=n.documentElement,i=n.body;return t=a.scrollLeft||i.scrollLeft||0,r=a.scrollTop||i.scrollTop||0,{scrollTop:r,scrollLeft:t}}function n(t,r){return t===e?"clientWidth"===r?e.innerWidth:e.innerHeight:t[r]}function a(t,n){return t===e?r()[n]:t[n]}function i(t,n,a){return t.getBoundingClientRect()[a?"left":"top"]-(n===e?0:n.getBoundingClientRect()[a?"left":"top"])+(n===e?r():n)[a?"scrollLeft":"scrollTop"]}var o=document.documentElement,s=o.matches?"matches":o.matchesSelector?"matchesSelector":o.webkitMatches?"webkitMatches":o.webkitMatchesSelector?"webkitMatchesSelector":o.msMatches?"msMatches":o.msMatchesSelector?"msMatchesSelector":o.mozMatches?"mozMatches":o.mozMatchesSelector?"mozMatchesSelector":null,l=t.element.prototype.closest||function(e){for(var r=this[0].parentNode;r!==document.documentElement&&null!=r&&!r[s](e);)r=r.parentNode;return r&&r[s](e)?t.element(r):t.element()},u=t.module("vs-repeat",[]).directive("vsRepeat",["$compile","$parse",function(r,o){return{restrict:"A",scope:!0,compile:function(s,u){var c,d,p,b,g,v,f=t.isDefined(u.vsRepeatContainer)?t.element(s[0].querySelector(u.vsRepeatContainer)):s,m=f.children().eq(0),S=m[0].outerHTML,h="$vs_collection",y=!1,O={vsRepeat:"elementSize",vsOffsetBefore:"offsetBefore",vsOffsetAfter:"offsetAfter",vsScrolledToEndOffset:"scrolledToEndOffset",vsScrolledToBeginningOffset:"scrolledToBeginningOffset",vsExcess:"excess"};if(m.attr("ng-repeat"))v="ng-repeat",c=m.attr("ng-repeat");else if(m.attr("data-ng-repeat"))v="data-ng-repeat",c=m.attr("data-ng-repeat");else if(m.attr("ng-repeat-start"))y=!0,v="ng-repeat-start",c=m.attr("ng-repeat-start");else{if(!m.attr("data-ng-repeat-start"))throw new Error("angular-vs-repeat: no ng-repeat directive on a child element");y=!0,v="data-ng-repeat-start",c=m.attr("data-ng-repeat-start")}if(d=/^\s*(\S+)\s+in\s+([\S\s]+?)(track\s+by\s+\S+)?$/.exec(c),p=d[1],b=d[2],g=d[3],y)for(var T=0,w=f.children().eq(0);null==w.attr("ng-repeat-end")&&null==w.attr("data-ng-repeat-end");)T++,w=f.children().eq(T),S+=w[0].outerHTML;return f.empty(),{pre:function(s,u,c){function d(){if(!L||L.length<1)s[h]=[],x=0,s.sizesCumulative=[0];else if(x=L.length,N){s.sizes=L.map(function(e){var r=s.$new(!1);t.extend(r,e),r[p]=e;var n=c.vsSize||c.vsSizeProperty?r.$eval(c.vsSize||c.vsSizeProperty):s.elementSize;return r.$destroy(),n});var e=0;s.sizesCumulative=s.sizes.map(function(t){var r=e;return e+=t,r}),s.sizesCumulative.push(e)}else f();I()}function f(){M&&s.$$postDigest(function(){if(q[0].offsetHeight||q[0].offsetWidth){for(var e=q.children(),t=0,r=!1,n=!1;t<e.length;){if(null!=e[t].attributes[v]||n){if(r||(s.elementSize=0),r=!0,e[t][B]&&(s.elementSize+=e[t][B]),!y)break;if(null!=e[t].attributes["ng-repeat-end"]||null!=e[t].attributes["data-ng-repeat-end"])break;n=!0}t++}r&&(I(),M=!1,s.$root&&!s.$root.$$phase&&s.$apply())}else var a=s.$watch(function(){(q[0].offsetHeight||q[0].offsetWidth)&&(a(),f())})})}function m(){var e="tr"===D?"":"min-";return j?e+"width":e+"height"}function T(){C()&&s.$digest()}function w(){void 0!==c.vsAutoresize&&(M=!0,f(),s.$root&&!s.$root.$$phase&&s.$apply()),C()&&s.$apply()}function I(){F=void 0,U=void 0,_=x,z=0,A(N?s.sizesCumulative[x]:s.elementSize*x),C(),s.$emit("vsRepeatReinitialized",s.startIndex,s.endIndex)}function A(e){s.totalSize=s.offsetBefore+e+s.offsetAfter}function V(){var e=n(E[0],R);e!==$&&(I(),s.$root&&!s.$root.$$phase&&s.$apply()),$=e}function C(){var e=a(E[0],H),t=n(E[0],R),r=q[0]===E[0]?0:i(q[0],E[0],j),l=s.startIndex,u=s.endIndex;if(N){for(l=0;s.sizesCumulative[l]<e-s.offsetBefore-r;)l++;for(l>0&&l--,l=Math.max(Math.floor(l-s.excess/2),0),u=l;s.sizesCumulative[u]<e-s.offsetBefore-r+t;)u++;u=Math.min(Math.ceil(u+s.excess/2),x)}else l=Math.max(Math.floor((e-s.offsetBefore-r)/s.elementSize)-s.excess/2,0),u=Math.min(l+Math.ceil(t/s.elementSize)+s.excess,x);_=Math.min(l,_),z=Math.max(u,z),s.startIndex=Q.latch?_:l,s.endIndex=Q.latch?z:u;var d=!1;if(null==F?d=!0:null==U&&(d=!0),d||(Q.hunked?Math.abs(s.startIndex-F)>=s.excess/2||0===s.startIndex&&0!==F?d=!0:(Math.abs(s.endIndex-U)>=s.excess/2||s.endIndex===x&&U!==x)&&(d=!0):d=s.startIndex!==F||s.endIndex!==U),d){s[h]=L.slice(s.startIndex,s.endIndex),s.$emit("vsRepeatInnerCollectionUpdated",s.startIndex,s.endIndex,F,U);var p;c.vsScrolledToEnd&&(p=L.length-(s.scrolledToEndOffset||0),(s.endIndex>=p&&U<p||L.length&&s.endIndex===L.length)&&s.$eval(c.vsScrolledToEnd)),c.vsScrolledToBeginning&&(p=s.scrolledToBeginningOffset||0,s.startIndex<=p&&F>s.startIndex&&s.$eval(c.vsScrolledToBeginning)),F=s.startIndex,U=s.endIndex;var b=N?"(sizesCumulative[$index + startIndex] + offsetBefore)":"(($index + startIndex) * elementSize + offsetBefore)",g=o(b),v=g(s,{$index:0}),f=g(s,{$index:s[h].length}),S=s.totalSize;k.css(m(),v+"px"),G.css(m(),S-f+"px")}return d}var x,q=t.isDefined(c.vsRepeatContainer)?t.element(u[0].querySelector(c.vsRepeatContainer)):u,P=t.element(S),D=P[0].tagName.toLowerCase(),L=[],j=void 0!==c.vsHorizontal,k=t.element("<"+D+' class="vs-repeat-before-content"></'+D+">"),G=t.element("<"+D+' class="vs-repeat-after-content"></'+D+">"),M=!c.vsRepeat,N=!!c.vsSize||!!c.vsSizeProperty,E=c.vsScrollParent?"window"===c.vsScrollParent?t.element(e):l.call(q,c.vsScrollParent):q,Q="vsOptions"in c?s.$eval(c.vsOptions):{},R=j?"clientWidth":"clientHeight",B=j?"offsetWidth":"offsetHeight",H=j?"scrollLeft":"scrollTop";if(s.totalSize=0,!("vsSize"in c)&&"vsSizeProperty"in c&&console.warn("vs-size-property attribute is deprecated. Please use vs-size attribute which also accepts angular expressions."),0===E.length)throw"Specified scroll parent selector did not match any element";s.$scrollParent=E,N&&(s.sizesCumulative=[]),s.elementSize=+c.vsRepeat||n(E[0],R)||50,s.offsetBefore=0,s.offsetAfter=0,s.excess=2,j?(k.css("height","100%"),G.css("height","100%")):(k.css("width","100%"),G.css("width","100%")),Object.keys(O).forEach(function(e){c[e]&&c.$observe(e,function(t){s[O[e]]=+t,I()})}),s.$watchCollection(b,function(e){L=e||[],d()}),P.eq(0).attr(v,p+" in "+h+(g?" "+g:"")),P.addClass("vs-repeat-repeated-element"),q.append(k),q.append(P),r(P)(s),q.append(G),s.startIndex=0,s.endIndex=0,E.on("scroll",T),t.element(e).on("resize",w),s.$on("$destroy",function(){t.element(e).off("resize",w),E.off("scroll",T)}),s.$on("vsRepeatTrigger",d),s.$on("vsRepeatResize",function(){M=!0,f()});var F,U,_,z;s.$on("vsRenderAll",function(){Q.latch&&setTimeout(function(){var e=x;z=Math.max(e,z),s.endIndex=Q.latch?z:e,s[h]=L.slice(s.startIndex,s.endIndex),U=s.endIndex,s.$$postDigest(function(){k.css(m(),0),G.css(m(),0)}),s.$apply(function(){s.$emit("vsRenderAllDone")})})});var $;s.$watch(function(){"function"==typeof e.requestAnimationFrame?e.requestAnimationFrame(V):V()})}}}}}]);"undefined"!=typeof module&&module.exports&&(module.exports=u.name)}(window,window.angular),function(e){"use strict";e.module("SurveyEngineCore").factory("EngineCore.ReviewScrollService",["EngineCore.SurveyTreeService","SurveyEngine.RespondentService",function(t,r){function n(){var e;window.document.createEvent?(e=window.document.createEvent("HTMLEvents"),e.initEvent("PageLoaded",!0,!0)):(e=window.document.createEventObject(),e.eventType="PageLoaded"),e.eventName="PageLoaded",console.log("Preparing to dispatch event."),window.document.createEvent?window.document.dispatchEvent(e):window.document.fireEvent("on"+e.eventType,e)}function a(e){for(var t=e.VariableLevelSequence||[],n=[],a=0;a<t.length;a++)if(t[a].IsOption)r.GetDisplayedValues(e.Name).hasItem(t[a].ID)&&n.push(t[a]);else{for(var i=e.OptionGroups[t[a].ID].OptionSequence,o=[],s=0;s<i.length;s++)r.GetDisplayedValues(e.Name).hasItem(t[a].ID)&&o.push(i[s]);o.length>0&&(e.OptionGroups[t[a].ID].OptionSequence=o,n.push(t[a]))}e.VariableLevelSequence=n}var i=function(){this.items=[],this.busy=!1,this.qids=[],this.index=0,this.keys={},this.displayedStartIndex=0,this.displayedEndIndex=4};return i.prototype.nextQuestion=function(r){if(this.index=r||this.displayedStartIndex,!this.busy&&void 0!=this.index&&null!=this.index&&this.qids[this.index]){if(this.index>this.qids.length)return void n();this.busy=!0;var a,i=this.qids[this.index].split("|"),o=i[0];i.length>1&&(a=i[i.length-1]),t.getQuestion(o).then(function(t){this.addQuestion(e.copy(t),a),this.busy=!1,this.index<this.displayedEndIndex&&(this.index++,this.nextQuestion(this.index))}.bind(this))}},i.prototype.addQuestion=function(e,t){if(t){e.Name+="."+t,e.ID+="|"+t;for(var r in e.Variables)e.Variables[r].Name+="."+t}"true"==e.Properties.MobileFriendly&&(e.Properties.MobileFriendly="false",e.disableInputOnly=!0);for(var n in e.Variables)for(var i=0;i<e.Variables[n].VariableLevelSequence.length;i++)a(e.Variables[n]);this.items.push(e),this.keys[e.ID]=!0},i}])}(angular),function(e){"use strict";e.module("SurveyEngine").directive("imageOnLoad",function(){return{restrict:"A",link:function(e,t,r){t.bind("load",function(){e.$emit("ResourceLoaded",1)}),t.bind("error",function(){e.$emit("ResourceLoaded",0)})}}}).directive("videoOnLoad",function(){return{restrict:"A",link:function(e,t,r){t[0].addEventListener("canplay",function(){e.$emit("VideoLoaded",t[0])})}}}).directive("seekDisable",function(){return{restrict:"A",link:function(e,t,r){var n=t[0],a=0;n.addEventListener("timeupdate",function(){n.seeking||(a=n.currentTime)}),n.addEventListener("seeking",function(){var e=n.currentTime-a;Math.abs(e)>.01&&(n.currentTime=a)}),n.addEventListener("ended",function(){a=0})}}})}(angular);